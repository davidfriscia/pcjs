(function(){/*
 https://www.pcjs.org/machines/modules/v2/message.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/dumpapi.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/reportapi.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/userapi.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/keys.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/message.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/cpudef.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/embed.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/defines.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/format.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/pcfs.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/strlib.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/usrlib.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/weblib.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/component.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/defines.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/panel.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/bus.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/memory.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/cpu.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/cpustate.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/cpuops.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/chipset.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/rom.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/ram.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/keyboard.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/video.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/serial.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/dbglib.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/debugger.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/modules/v2/computer.js (C) 2012-2025 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/state.js (C) 2012-2025 Jeff Parsons
*/
var m,aa=typeof Object.create=="function"?Object.create:function(a){function b(){}b.prototype=a;return new b},ba=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function ca(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var da=ca(this);function ea(a,b){if(b)a:{var c=da;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&b!=null&&ba(c,a,{configurable:!0,writable:!0,value:b})}}var ja;
if(typeof Object.setPrototypeOf=="function")ja=Object.setPrototypeOf;else{var ka;a:{var la={a:!0},na={};try{na.__proto__=la;ka=na.a;break a}catch(a){}ka=!1}ja=ka?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var oa=ja;
function pa(a,b){a.prototype=aa(b.prototype);a.prototype.constructor=a;if(oa)oa(a,b);else for(var c in b)if(c!="prototype")if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.Zf=b.prototype}function qa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}
function ra(a){var b=typeof Symbol!="undefined"&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if(typeof a.length=="number")return{next:qa(a)};throw Error(String(a)+" is not an iterable or ArrayLike");}function sa(a){if(!(a instanceof Array)){a=ra(a);for(var b,c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a}function ua(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b}
ea("String.prototype.replaceAll",function(a){return a?a:function(b,c){if(b instanceof RegExp&&!b.global)throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument.");return b instanceof RegExp?this.replace(b,c):this.replace(new RegExp(String(b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"g"),c)}});
ea("Math.trunc",function(a){return a?a:function(b){b=Number(b);if(isNaN(b)||b===Infinity||b===-Infinity||b===0)return b;var c=Math.floor(Math.abs(b));return b<0?-c:c}});ea("String.prototype.repeat",function(a){return a?a:function(b){if(this==null)throw new TypeError("The 'this' value for String.prototype.repeat must not be null or undefined");var c=this;if(b<0||b>1342177279)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}});
ea("Number.isNaN",function(a){return a?a:function(b){return typeof b==="number"&&isNaN(b)}});ea("Symbol",function(a){function b(f){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(f||"")+"_"+e++,f)}function c(f,g){this.g=f;ba(this,"description",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.g};var d="jscomp_symbol_"+(Math.random()*1E9>>>0)+"_",e=0;return b});
ea("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");ba(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return va(qa(this))}});return a});function va(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}function wa(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}
ea("Array.prototype.keys",function(a){return a?a:function(){return wa(this,function(b){return b})}});var xa=typeof window!="undefined",ya=typeof window!="undefined"?{}:global,n=typeof window!="undefined"?window:global,za=typeof document!="undefined"?document:{},Aa={machines:{},components:[],commands:{},files:null};n.PCjs?Aa=n.PCjs:n.PCjs=Aa;n.LOCALDISKS=!1;var t={log:68719476736,warn:549755813888,halt:70368744177664,buffer:0x800000000000};
function Ba(){this.g={};for(var a=0;a<23;a++)this.g["ACDFGHMNSTWYBbdfjcsoXx%"[a]]=null}function Ca(){var a=ua.apply(0,arguments);if(a[0]===void 0)a=new Date(Date.now());else if(typeof a[0]==="string"){var b=a[0];b.indexOf(":")<0?b+=" "+(a[1]||"00:00:00 UTC"):b.match(/^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9] [0-9][0-9]:[0-9][0-9]:[0-9][0-9]$/)&&(a[1]||(b+=" UTC"));a=new Date(b)}else a=a[1]===void 0?new Date(a[0]):new Date(Date.UTC.apply(Date,sa(a)));return a}
Ba.prototype.i=function(a){var b=ua.apply(1,arguments);if(!b||!b.length)return a;var c="",d=a.split(/%([-+ 0#]*)([0-9]*|\*)(\.[0-9]+|)([bwhlL]?)([A-Za-z%])/),e=0,f;for(f=0;f<d.length-6;f+=6){c+=d[f];var g=d[f+5];if(this.g[g]===void 0)c+="%"+d[f+1]+d[f+2]+d[f+3]+d[f+4]+g;else{if(e<b.length){var h=b[e];g!="%"&&e++}else h=b[b.length-1];var k=!1,l=d[f+1],r=l.indexOf("#")>=0,u=l.indexOf("0")>=0,q=d[f+2];q=="*"?(q=h,h=e<b.length?b[e++]:b[b.length-1]):q=+q||0;var p=d[f+3];p=p?+p.substr(1):-1;var A=d[f+4],
E=null,F=0,G="",z="ACDFGHMNSTWY".indexOf(g)>=0&&typeof h!="object"?Ca(h):h;switch(g){case "C":c+=isNaN(z.getTime())?void 0:this.i("%#W, %#F %#D, %#Y".replaceAll("#",r?"#":""),z);continue;case "D":h=r?z.getUTCDate():z.getDate();g="d";break;case "A":case "G":case "H":h=r?z.getUTCHours():z.getHours();g=="A"?(h=h<12?"am":"pm",g="s"):(g=="G"&&(h=h?h>12?h-12:h:12),g="d");break;case "F":case "M":h=r?z.getUTCMonth():z.getMonth();g=="F"?(h=Da[h],g="s"):(h++,g="d");break;case "N":h=r?z.getUTCMinutes():z.getMinutes();
g="d";break;case "S":h=r?z.getUTCSeconds():z.getSeconds();g="d";break;case "T":c+=isNaN(z.getTime())?void 0:this.i("%#Y-%#02M-%#02D %#02H:%#02N:%#02S".replaceAll("#",r?"#":""),z);continue;case "W":h=Ea[r?z.getUTCDay():z.getDay()];g="s";break;case "Y":h=r?z.getUTCFullYear():z.getFullYear(),p>0&&(h%=Math.pow(10,p)),g="d"}switch(g){case "b":c+=h?"true":"false";break;case "d":h=Math.trunc(h),p>=0&&(u=!0,q<p&&(q=p),p=-1);case "f":h=+h;g=h+"";p>=0&&(g=h.toFixed(p));g.length<q&&(u?(h<0&&(q--,g=g.substr(1)),
g=("0".repeat(q)+g).slice(-q),h<0&&(g="-"+g)):g=(" ".repeat(q)+g).slice(-q));c+=g;break;case "j":c+=JSON.stringify(h,null,q||void 0);break;case "c":h=typeof h=="string"?h[0]:String.fromCharCode(h);case "s":if(h!=void 0)for(typeof h!="string"&&(h=h.toString()),p>=0&&(h=h.substr(0,p));h.length<q;)h=l.indexOf("-")>=0?h+" ":" "+h;c+=h;break;case "B":F=2,r&&(G="0b");case "o":F||(F=8),!G&&r&&(G="0o");case "X":E=Ga;case "x":g="";F||(F=16);!G&&r&&(G="0x");E||(E=Ha);typeof h=="string"&&h[0]=="-"&&(k=!0,h=
h.slice(1));h=Math.trunc(h);k&&(h=-h);h<0&&((h|0)==h?h>>>=0:Math.abs(h)<=9007199254740992&&(h+=9007199254740992));p>=0&&(u=!0,q<p&&(q=p));u&&!q&&(A=="b"?q=2:A=="h"||A=="w"?q=4:A=="l"?q=8:(q=Math.abs(h),q=q<=255?2:q<=65535?4:q<=4294967295?8:9),q+=G.length);q-=G.length;do k=16,Number.isNaN(h)||(k=h&F-1,h=Math.trunc(h/F)),u||!g||k||h?g=E[k]+g:(G&&(g=G+g,G=""),q>0&&(g=" "+g));while(--q>0||h);c+=G+g;break;case "%":c+="%";break;default:c=this.g[g]?c+this.g[g](g,l,q,p,h):c+("(unimplemented sprintf type: %"+
g+")")}}}return c+=d[f]};
var Ea="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Da="January February March April May June July August September October November December".split(" "),Ha="0123456789abcdef?",Ga="0123456789ABCDEF?",v={Ae:0,De:1,Ee:2,Fe:3,Ge:4,He:5,Ie:6,Je:7,Ke:8,Le:9,Me:10,Ne:11,Oe:12,Pe:13,Qe:14,Re:15,Se:16,Te:17,Ue:18,Ve:19,We:20,Xe:21,Ye:22,Ze:23,$e:24,af:25,bf:26,hf:27," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,0:48,
1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,";":59,"<":60,"=":61,">":62,"?":63,"@":64,$a:65,Tb:66,Ub:67,zb:68,E:69,Wb:70,Xb:71,Yb:72,Zb:73,$b:74,bc:75,Db:76,fc:77,hc:78,mc:79,nc:80,Q:81,oc:82,rc:83,sc:84,tc:85,vc:86,wc:87,xc:88,zc:89,tb:90,"[":91,"\\":92,"]":93,"^":94,_:95,"`":96,a:97,b:98,c:99,d:100,e:101,f:102,Bd:103,Dd:104,Fd:105,Od:106,k:107,Pd:108,Rd:109,n:110,Sd:111,p:112,q:113,r:114,s:115,t:116,re:117,se:118,w:119,x:120,y:121,z:122,"{":123,"|":124,"}":125,"~":126,cf:127},Ia={59:186,
61:187,173:189,224:91};function Ja(a){var b=null,c=a.indexOf(Ka)==0?Aa.files:null;if(c){a=a.slice(Ka.length+1).split("/");var d,e;for(d=0;d<a.length;d++){var f=a[d],g=!1;if(!f){b=c;break}for(e=0;e<c.files.length;e++){var h=c.files[e];if(h.name.toLowerCase()==f.toLowerCase()){if(d==a.length-1){b=h;break}if(h.files){c=h;g=!0;break}}}if(b)break;if(!g&&d<a.length-1)break}}return b}var Ka="/pcfs";Aa.files||(Aa.files={name:"",size:0,Vf:16,Wf:new Date,files:[]});function La(){}
function Ma(a,b){if(a){b||(b=10);var c,d=a.indexOf(",")>0;d&&(a=a.replace(/,/g,""));var e=c=a.charAt(0);c=="#"?(b=8,c=""):c=="$"&&(b=16,c="");e!=c?a=a.substr(1):(e=c=a.substr(0,2),c=="0b"&&d||c=="^B"?(b=2,c=""):c=="0o"||c=="^O"?(b=8,c=""):c=="^D"?(b=10,c=""):c=="0x"&&(b=16,c=""),e!=c&&(a=a.substr(2)));e=c=a.slice(-1);c=="Y"||c=="y"?(b=2,c=""):c=="."?(b=10,c=""):c=="H"||c=="h"?(b=16,c=""):c=="K"?c="000":c=="M"?c="000000":c=="G"&&(c="000000000");e!=c&&(a=a.slice(0,-1)+c);var f;e=0;b<=10&&(c=a.match(/(-?[0-9]+)B([0-9]*)/))&&
(a=c[1],e=35-((c[2]||35)&255));if((b&&b!=10?b==16?a.match(/^-?[0-9a-f]+$/i)!==null:b==8?a.match(/^-?[0-7]+$/)!==null:b==2&&a.match(/^-?[01]+$/)!==null:a.match(/^-?[0-9]+$/)!==null)&&!isNaN(f=parseInt(a,b))){e&&(f<0&&(f+=68719476736),f=e>0?f*Math.pow(2,e):Math.trunc(f/Math.pow(2,-e)));var g=f}}return g}
function Na(a,b,c,d,e){e=e===void 0?0:e;var f="";isNaN(a)||typeof a!="number"?a=null:(a<0&&a>-1&&(a=-1),a<0&&(a+=Math.pow(b,c)),a>=Math.pow(b,c)&&(c=Math.ceil(Math.log(a)/Math.log(b))));for(var g=e||-1;c-- >0;){g||(f=","+f,g=e);if(a==null)f="?"+f;else{var h=a%b;h+=h>=0&&h<=9?48:55;f=String.fromCharCode(h)+f;a=Math.trunc(a/b)}g--}return(d===void 0?"":d)+f}function w(a,b,c){b?b>9&&(b=9):(b=Math.abs(a),b=b<=255?2:b<=65535?4:b<=4294967295?8:9);return Na(a,16,b,c?"0x":"")}
function Oa(a){var b=a,c=a.lastIndexOf("/");c>=0&&(b=a.substr(c+1));c=b.indexOf("&");c>0&&(b=b.substr(0,c));return b}function Pa(a){var b="",c=a.lastIndexOf(".");c>=0&&(b=a.substr(c+1).toLowerCase(),b=="json5"&&(b="json"));return b}function Ta(){var a=n.location?n.location.hostname:"localhost";return a.indexOf("pcjs.org",a.length-8)!==-1}function Ua(a){return a.replace(/[&<>"'$]/g,function(b){return Va[b]})}function Wa(a,b){return Xa("%"+b+"."+Math.abs(b)+"s",a)}
function Ya(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}var Va={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;",$:"&dollar;"},Za={0:"NUL",1:"SOH",2:"STX",3:"ETX",4:"EOT",5:"ENQ",6:"ACK",7:"BEL",8:"BS",9:"TAB",10:"LF",11:"VT",12:"FF",13:"CR",14:"SO",15:"SI",16:"DLE",17:"XON",18:"DC2",19:"XOFF",20:"DC4",21:"NAK",22:"SYN",23:"ETB",24:"CAN",25:"EM",26:"SUB",27:"ESC",28:"FS",29:"GS",30:"RS",31:"US",127:"DEL"},$a=new Ba,Xa=$a.i.bind($a);
function ab(a,b,c){var d=0,e=a.length,f=0;for(c===void 0&&(c=function(k,l){return k>l?1:k<l?-1:0});d<e;){var g=d+e>>1,h=void 0;h=c(b,a[g]);h>0?d=g+1:(e=g,f=!h)}return f?d:~d}function bb(a,b){if(Array.prototype.indexOf)return a.indexOf(b,c);var c=c||0;c<0&&(c+=a.length);c<0&&(c=0);for(var d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1}
function cb(a,b,c,d){function e(){if(l.readyState!==4)return null;try{g=r?l.response:l.responseText}catch(p){x(68719476736,"getResource(%s) exception: %s\n",a,p.message)}if(g!=null&&(l.status==200||!l.status&&g.length&&(n.location?n.location.protocol:"file:")=="file:"))x(2267742732288,"getResource(%s): returned %d bytes\n",a,g.length);else if(f=l.status||-1,x(2199023255552,"getResource(%s) error: %d\n",a,f),!l.status&&!gb){var q=a.match(/(^https?:\/\/[^/]+)(.*)/);q&&(gb=!0,hb("PCjs was unable to perform a cross-origin resource request to '"+
q[1]+"'.\n\nIf you're running an ad blocker, try adding '"+ib()+"' to your whitelist (or find a smarter ad blocker)."))}d&&d(a,g,f);return[g,f]}b=b===void 0?"text":b;c=c===void 0?!1:c;var f=0,g=null,h=null,k=n.resources;if(typeof k=="object"&&(g=k[a]))return d&&d(a,g,f),[g,f];if(c&&typeof k=="function")return k(a,function(q,p){d&&d(a,q,p)}),h;a=n.LOCALDISKS&&(n.location?n.location.hostname:"localhost").match(/^(.+\.local|localhost|0\.0\.0\.0|pcjs)$/)?a.replace(/^\/(diskettes|gamedisks|miscdisks|harddisks|decdisks|pcsigdisks|pcsig[0-9a-z]*-disks|private)\//,
"/disks/$1/").replace(/^\/discs\/([^/]*)\//,"/disks/cdroms/$1/"):a.replace(/^\/(disks\/|)(diskettes|gamedisks|miscdisks|harddisks|decdisks|pcsigdisks|pcsig[0-9a-z]*-disks|private)\//,"https://$2.pcjs.org/").replace(/^\/(disks\/cdroms|discs)\/([^/]*)\//,"https://$2.pcjs.org/");x(2199023255552,"getResource(%s)\n",a);if(ya.le&&a.indexOf("http")!=0){try{k=b=="arraybuffer"?null:"utf8",g=ya.le(a,k),k||(g=g.buffer,g.buffer&&(g=g.buffer))}catch(q){f=q.errno}if(g!==void 0)return d&&d(a,g,f),[g,f]}if(a.indexOf(Ka)==
0&&(k=Ja(a)))return g=k.data,d&&d(a,g,f),[g,f];!a.match(/^[A-Z]:/i)&&a.indexOf("?")<0&&(a=encodeURI(a));if(n.XMLHttpRequest)var l=new n.XMLHttpRequest;else if(n.ActiveXObject)l=new n.ActiveXObject("Microsoft.XMLHTTP");else if(n.fetch)return fetch(a).then(function(q){switch(b){case "json":case "text":return q.text();case "arraybuffer":return q.arrayBuffer();default:throw Error("unsupported response type: "+b);}}).then(function(q){x(2267742732288,"getResource(%s): fetched %d bytes\n",a,q.length);d&&
d(a,q,f)}).catch(function(){x(68719476736,"getResource(%s) fetch error: %d\n",a,f);d&&d(a,g,f)}),h;var r=!1;k=typeof l.responseType==="string";c&&(l.onreadystatechange=e);if(b&&typeof b=="object"){k="";for(var u in b)b.hasOwnProperty(u)&&(k&&(k+="&"),k+=u+"="+encodeURIComponent(b[u]));k=k.replace(/%20/g,"+");x(2267742732288,"getResource(%s): posted %d bytes\n",a,k.length);l.open("POST",a,c);l.setRequestHeader("Content-type","application/x-www-form-urlencoded");l.send(k)}else l.open("GET",a,c),b==
"arraybuffer"&&(k?(r=!0,l.responseType=b):l.overrideMimeType("text/plain; charset=x-user-defined")),l.send();c||(l.readyState=4,h=e());return h}
function jb(a,b){var c,d={oa:null,sa:null,Oa:null,Fa:null};if(b.charAt(0)=="["||b.charAt(0)=="{")try{var e,f;if(b.charAt(0)=="<")throw Error(b);if(b.indexOf("0x")<0&&b.indexOf("0o")<0&&b.substr(0,2)!='["'){b.indexOf('"values"')<0&&(b=b.replace(/([a-z]+):/gm,'"$1":').replace(/\/\/[^\n]*/gm,""));var g=JSON.parse(b)}else g=eval("("+b+")");d.Oa=g.load;d.Fa=g.exec;var h=g.width,k=g.values;h&&k&&(h==8?g.bytes=k:h==16?g.words=k:h==32?g.longs=k:g.data=k);if(e=g.bytes)d.oa=e;else if(e=g.words)for(d.oa=Array(e.length*
2),f=c=0;c<e.length;c++)d.oa[f++]=e[c]&255,d.oa[f++]=e[c]>>8&255;else if(e=g.longs)for(d.oa=Array(e.length*4),f=c=0;c<e.length;c++)d.oa[f++]=e[c]&255,d.oa[f++]=e[c]>>8&255,d.oa[f++]=e[c]>>16&255,d.oa[f++]=e[c]>>24&255;else(e=g.data)?d.Uf=e:d.oa=g;d.oa&&(d.oa.length?d.oa.length==1&&(kb(d.oa[0]),d=null):(kb("Empty resource: "+a),d=null));d.sa=g.symbols}catch(l){kb("Resource data error ("+a+"): "+l.message),d=null}else{e=[];b=b.replace(/\n/gm," ").replace(/ +$/,"").split(" ");for(c=0;c<b.length;c++){f=
parseInt(b[c],16);if(isNaN(f)){kb("Resource data error ("+a+"): invalid hex byte ("+b[c]+")");break}e.push(f&255)}c==b.length&&(d.oa=e)}return d}function ib(){return n.location?n.location.protocol+"//"+n.location.host:"https://www.pcjs.org"}function lb(){return n.navigator?n.navigator.userAgent:""}
function mb(){if(nb==null){var a=!1;if(n.localStorage)try{n.localStorage.setItem("PCjs.localStorage","PCjs.localStorage"),a=n.localStorage.getItem("PCjs.localStorage")=="PCjs.localStorage",n.localStorage.removeItem("PCjs.localStorage")}catch(b){ob(b),a=!1}nb=a}return nb}function ob(a){x(1099511627776,"Local storage error: %s\n",a.message)}function pb(a){if(mb())try{var b=n.localStorage.getItem(a)}catch(c){ob(c)}return b}
function qb(a,b){if(mb())try{return n.localStorage.setItem(a,b),!0}catch(c){ob(c)}return!1}function rb(a){if(n.navigator){var b=lb();return a=="iOS"&&(!!b.match(/(iPod|iPhone|iPad)/)||n.navigator.platform==="MacIntel"&&n.navigator.maxTouchPoints>1)||a=="MSIE"&&!!b.match(/(MSIE|Trident)/)||b.indexOf(a)>=0}return!1}function sb(a,b,c){if(a)for(var d=0;d<tb.length;d++){var e=tb[d];if(c){if(e+=c,b+e in a)return e}else if(e=e?e+b[0].toUpperCase():b[0],e+=b.substr(1),e in a)return e}return null}
function ub(a){if(!vb){var b,c={};if(n.location){b||(b=n.location.search.substr(1));for(var d,e=/\+/g,f=/([^&=]+)=?([^&]*)/g;d=f.exec(b);)c[decodeURIComponent(d[1].replace(e," "))]=decodeURIComponent(d[2].replace(e," "))}vb=c}return vb[a]||vb[a.toLowerCase()]}function wb(a,b,c){function d(){--a;a>=0&&(b()||(a=0));a>0?setTimeout(d,0):c()}d()}
function xb(a,b){function c(){b(d===100)&&(e=setTimeout(c,d),d=100)}var d=0,e=null,f=!1;a.onmousedown=function(){f||e||(d=500,c())};a.ontouchstart=function(){e||(d=500,c())};a.onmouseup=a.onmouseout=function(){e&&(clearTimeout(e),e=null)};a.ontouchend=a.ontouchcancel=function(){e&&(clearTimeout(e),e=null);f=!0}}function yb(a,b){n.addEventListener&&n.addEventListener(a,b)}function zb(a){Ab.init.push(a)}
function Bb(a){x(274877906944,"%s\n\nIf it happens again, please send the URL to support@pcjs.org. Thanks.\n",a)}function Cb(a){if((a=Ab[a])&&Db)try{for(var b=0;b<a.length;b++)a[b]()}catch(c){Bb("An unexpected error occurred: "+c.message)}}function Hb(a){!Db&&a?(Db=!0,Ib&&Cb("init"),Jb&&Cb("show")):Db=a}var vb=null,Ab={init:[],show:[],exit:[]},tb=["","moz","ms","webkit"],Ib=!1,Jb=!1,Db=!0,gb=!1,nb=null;yb("load",function(){Ib=!0;Cb("init",!0)});yb("pageshow",function(){Jb=!0;Cb("show",!0)});
yb(rb("iOS")?"pagehide":rb("Opera")?"unload":"beforeunload",function(){Cb("exit",!0)});
function y(a,b,c){this.type=a;b||(b={id:"",name:""});this.name=b.name;this.yc=b.comment;this.Cd=b;++Kb;this.id=this.id=b.id||"";this.exports={};this.R=this.bindings={};a=this.id.indexOf(".");a<0?(this.Qa="PCjs",this.Fb=this.id):(this.Qa=this.id.substr(0,a),this.Fb=this.id.substr(a+1));this.flags={ready:!1,ib:!1,Gb:!1,Xf:!1,ca:!1,Mc:!1,error:!1};this.xb=null;this.flags.error=!1;this.ja=c||0;this.K=this.A=this.J=this.S=null;Aa.components.push(this)}
function Lb(a,b,c){Aa.machines[a]&&b&&(Aa.machines[a][b]=c,b=="parms"&&typeof c=="string"&&(Aa.machines[a].config=eval("("+c+")")))}function Mb(){return Date.now()||+new Date}function x(a){var b=ua.apply(1,arguments),c=0;typeof a=="number"&&(c=a,a=b.shift());if(c>=68719476736&&c<=1099511627776){var d=!1;c==1099511627776?(d=!0,a="Error: "+a):c==549755813888?(d=!0,a="Warning: "+a):c==274877906944&&(d=!0);b=Xa.apply(La,[a].concat(sa(b))).trim();d?hb(b):console.log(b)}}
function kb(a){x(1099511627776,a)}function hb(a){n.alert&&n.alert(a);console.log(a)}function Nb(a){var b=!1;n.confirm&&(b=n.confirm(a));return b}
function Ob(a,b){b=Pb("pcx80-control","",b.parentNode);for(var c=0;c<b.length;c++)for(var d=b[c].childNodes,e=0;e<d.length;e++){var f=d[e];if(f.nodeType===1){var g=f.getAttribute("class");if(g)for(var h=g.split(" "),k=0;k<h.length;k++)switch(g=h[k],g){case "pcx80-binding":(g=Qb(f))&&g.binding!==void 0?a.ea(g.type,g.binding,f,g.value):g&&g.type=="description"||x(549755813888,'Component "%s" missing binding%s\n',a.toString(),g?" for "+g.type:""),k=h.length}}}}
function Rb(a){var b,c=[];a&&(b=a.indexOf("."))>0&&(a=a.substr(0,b+1));var d=Aa.components;for(b=0;b<d.length;b++){var e=d[b];a&&e.id.indexOf(a)!=0||c.push(e)}return c}function Sb(a){if(a!==void 0){var b,c=Aa.components;for(b=0;b<c.length;b++)if(c[b].id===a)return c[b]}return null}
function Tb(a,b){var c=c===void 0?null:c;if(a!==void 0){var d;b&&(b=(d=b.indexOf("."))>0?b.substr(0,d+1):"");var e=Aa.components;for(d=0;d<e.length;d++)if(c)c==e[d]&&(c=null);else if(!(a!=e[d].type||b&&e[d].id.indexOf(b)))return e[d]}return null}function Qb(a){var b=null;if(a.getAttribute){if(a=a.getAttribute("data-value"))try{b=eval("("+a+")")}catch(d){kb(d.message+" ("+a+")")}}else if(b=a.config||null){a=a.id;var c=b.id;a&&c&&c.indexOf(".")<0&&(b.id=a+"."+c)}return b}
function Pb(a,b,c){b=b===void 0?"":b;c=c===void 0?za:c;var d=[];b&&(a+="-"+b,b!="machine"&&(a+="-object"));if(xa)if(c.getElementsByClassName)d=c.getElementsByClassName(a);else{if(c.getElementsByTagName){b=c.getElementsByTagName("*");var e=new RegExp("(^| )"+a+"( |$)");a=0;for(c=b.length;a<c;a++)e.test(b[a].className)&&d.push(b[a])}}else for(a=Object.keys(Aa.machines),c=0;c<a.length;c++){e=a[c];var f=Aa.machines[e].config;if(f&&(f=f[b])){Array.isArray(f)||(f=[f]);f=ra(f);for(var g=f.next();!g.done;g=
f.next())d.push({id:e,config:g.value})}}return d}
function Ub(a){for(var b=!0,c=Aa.commands[a];c&&c.length;){var d=c.splice(0,1)[0],e=d[0];x(8796093022208,d.join(" "));var f=null;Vb.indexOf(e)>=0&&(f=function(){return function(){Ub(a)}}());var g=Wb[e];if(g)if(!f)b=g(d[1],d[2],d[3]);else{if(!g(f,d[1],d[2],d[3]))break}else{b=!1;var h=Tb(d[1],a);if(h)if(g=Xb[e])b=g(h,d[2],d[3]);else{var k=h.exports;if(k&&(g=k[e]))if(b=!0,!f)b=g.call(h,d[2],d[3]);else if(!g.call(h,f,d[2],d[3]))break}}if(!b){hb("Script error: '"+e+"' command "+(g?" failed":" not recognized"));
break}}c&&!c.length&&delete Aa.commands[a];return b}m=y.prototype;m.toString=function(){return this.name?this.name:this.id||this.type};
m.ea=function(a,b,c){switch(b){case "clear":return this.R[b]||(this.R[b]=c,c.onclick=function(d){return function(){d.R.print&&(d.R.print.value="")}}(this)),!0;case "print":return this.R[b]||(this.R[b]=c,c.value="",this.print=function(d,e){return function(f,g){f||(f="");if((g===void 0?0:g)==4398046511104&&f.slice(-4)=="...\n"){g=f.slice(0,-1);var h=e.value,k=h.lastIndexOf(g);h=k<0?h+(g+"\n"):h.substr(0,k)+(f.slice(0,-1)+".")+h.substr(k+g.length);h.length>8192&&(h=h.substr(h.length-4096));e.value=h}else e.value+=
f,f=e.value,f.length>8192&&(e.value=f.substr(f.length-4096));e.scrollTop=e.scrollHeight}}(this,c)),!0;default:return!1}};m.print=function(a,b){x(b===void 0?0:b,a)};function Yb(a,b){a.flags.error=!0;a.j(274877906944,"%s\n",b)}function Zb(a,b){b&&(a.flags.ready?b():a.xb=b);return a.flags.ready}function $b(a){if(!a.flags.error&&(a.flags.ready=!0,a.flags.ready)){var b=a.xb;a.xb=null;b&&b()}}function ac(a,b){a.flags.ib&&(b?a.flags.Gb=!0:b===void 0&&a.print(a.toString()+" busy\n"));return a.flags.ib}
function hc(a,b){if(a.flags.Gb)return a.flags.ib=!1,a.flags.Gb=!1;if(a.flags.error)return a.print(a.toString()+" error\n"),!1;a.flags.ib=b;return a.flags.ib}m.va=function(){return this.flags.ca=!0};m.ua=function(a,b){b&&(this.flags.ca=!1);return!0};function ic(a,b){var c=b/4294967296|0;return(a&b)==(b|0)&&((a/4294967296|0)&c)==c}function jc(a,b){b=b===void 0?0:b;b&1&&--b;b=b||a.ja;return!ic(b,2199023255552)&&(ic(0xff000000000-(a.K?618475290624:0),b)||a.K&&ic(a.K.ja,b))?!0:!1}
m.j=function(a){var b=ua.apply(1,arguments),c=0;typeof a=="number"&&(c=a||4398046511104,a=b.shift(),ic(c,68719476736)?a=(this.id||this.type||"log")+": "+a:ic(c,137438953472)&&(a=this.type+": "+a));jc(this,c)&&(b=Xa.apply(La,[a].concat(sa(b))),this.K&&this.K.message?this.K.message(b,c):this.print(b,c))};function B(a,b,c,d,e,f,g){g=g===void 0?a.ja:g;a.K&&(g===!0&&(g=0),kc(a.K,a,b,c,d,e,f,g))}
var Vb=["hold","sleep","wait"],Wb={alert:function(a){hb(a);return!0},sleep:function(a,b){setTimeout(a,+b);return!1}},Xb={select:function(a,b,c){var d=!1;if(a=a.bindings[b])for(b=0;b<a.options.length;b++)if(a.options[b].textContent==c){a.selectedIndex!=b&&(a.selectedIndex=b);d=!0;break}return d}},Kb=0;Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){b=b||0;for(var c=this.length;b<c;b++)if(this[b]===a)return b;return-1});
Array.isArray||(Array.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"});Function.prototype.bind||(Function.prototype.bind=function(a){function b(){return e.apply(this instanceof c&&a?this:a,d.concat(Array.prototype.slice.call(arguments)))}function c(){}if(typeof this!="function")throw new TypeError("Function.prototype.bind: non-callable object");var d=Array.prototype.slice.call(arguments,1),e=this;c.prototype=this.prototype;b.prototype=new c;return b});t.cpu=2;
t.bus=4;t.mem=8;t.port=16;t.nvr=32;t.chipset=64;t.kbd=128;t.key=256;t.video=512;t.fdc=1024;t.disk=2048;t.serial=4096;t.speaker=8192;t.computer=16384;
var lc=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,
0,0,1,1,0,1,0,0,1];function mc(a){y.call(this,"Panel",a)}pa(mc,y);mc.prototype.ea=function(a,b,c,d){return this.S&&this.S.ea(a,b,c,d)||this.A&&this.A.ea(a,b,c,d)||this.D&&this.D.ea(a,b,c,d)||this.K&&this.K.ea(a,b,c,d)?!0:y.prototype.ea.call(this,a,b,c,d)};mc.prototype.Ca=function(a,b,c,d){this.S=a;this.J=b;this.A=c;this.K=d;this.D=nc(a,"Keyboard")};mc.prototype.va=function(a,b){b||oc();return!0};mc.prototype.ua=function(){return!0};
function oc(){for(var a=!1,b=Pb("pcx80","panel"),c=0;c<b.length;c++){var d=b[c],e=Qb(d),f=Sb(e.id);f||(a=!0,f=new mc(e));Ob(f,d);a&&$b(f)}}zb(oc);
function pc(a,b,c){y.call(this,"Bus",a);this.A=b;this.K=c;this.N=a.busWidth||16;this.O=Math.pow(2,this.N);this.F=this.O-1|0;this.i=(this.N>>1)+2;this.i<10&&(this.i=10);this.i>15&&(this.i=15);this.B=1<<this.i;this.P=this.B>>2;this.u=this.B-1;this.L=this.O/this.B|0;this.I=this.L-1;this.C=[];this.D=[];this.G=this.H=!1;this.T=[];this.U=[];a=new qc;rc(a,this.K);this.g=Array(this.L);for(b=0;b<this.L;b++)this.g[b]=a;$b(this)}pa(pc,y);pc.prototype.reset=function(){};
pc.prototype.va=function(a,b){b||this.reset();return!0};function sc(a,b,c,d){for(var e=b,f=c,g=e>>>a.i;f>0&&g<a.g.length;){var h=a.g[g],k=g*a.B,l=a.B-(e-k);l>f&&(l=f);if(h&&h.size){if(h.type==d){if(e+f<=h.M)return h.mb+=h.M-e,h.M=e,!0;if(e>=h.M+h.mb){l=h.size-(e-k);l>f&&(l=f);h.mb=e-h.M+l;e=k+a.B;f-=l;g++;continue}}return tc(a,uc,e,f)}e=new qc(e,l,a.B,d);rc(e,a.K,h);a.g[g++]=e;e=k+a.B;f-=l}return f<=0?(a.j(137438953472,"%dKb %s at 0x%04X\n",Math.floor(c/1024),vc[d],b),!0):tc(a,wc,b,c)}
function xc(a,b){return a.g[(b&a.F)>>>a.i].lb(b&a.u,b)}function yc(a,b){var c=b&a.u,d=(b&a.F)>>>a.i;return c!=a.u?a.g[d].Jc(c,b):a.g[d++].Xa(c,b)|a.g[d&a.I].Xa(0,b+1)<<8}function zc(a,b){var c=b&a.u,d=(b&a.F)>>>a.i;return c!=a.u?a.g[d].Lb(c,b):a.g[d++].lb(c,b)|a.g[d&a.I].lb(0,b+1)<<8}function Jc(a,b,c){a.g[(b&a.F)>>>a.i].nb(b&a.u,c&255,b)}function Kc(a,b,c){var d=b&a.u,e=(b&a.F)>>>a.i;d!=a.u?a.g[e].Nc(d,c&65535,b):(a.g[e++].Za(d,c&255,b),a.g[e&a.I].Za(0,c>>8&255,b+1))}
function Lc(a,b,c,d){d===void 0&&(d=0);if(c)for(var e in c){var f=a,g=+e+d,h=+e+d,k=c[e].bind(b);if(k!==void 0)for(;g<=h;g++)f.C[g]!==void 0?x(549755813888,"Input port "+w(g,4,!0)+" already registered"):f.C[g]=[k,!1]}}function Mc(a,b,c){for(var d=1,e=0,f=0;d>0;){var g=a.C[b],h=a.T[b]||1,k=h==1?255:h==2?65535:-1,l=k;g!==void 0?(g[0]&&(l=g[0](b,c),l===void 0?l=k:l&=k),a.K&&a.G!=g[1]&&Nc(a.K,b,l)):a.K&&(kc(a.K,a,b,null,c),a.G&&Nc(a.K,b,l));e|=l<<f;f+=h<<3;b+=h;d-=h}return e}
function Oc(a,b,c,d){d===void 0&&(d=0);if(c)for(var e in c){var f=a,g=+e+d,h=+e+d,k=c[e].bind(b);if(k!==void 0)for(;g<=h;g++)f.D[g]!==void 0?x(549755813888,"Output port "+w(g,4,!0)+" already registered"):f.D[g]=[k,!1]}}function Pc(a,b,c,d){for(var e=1,f=0;e>0;){var g=a.D[b],h=a.U[b]||1,k=h==1?255:h==2?65535:-1,l=(c>>>=f)&k;if(g!==void 0){if(g[0])g[0](b,l,d);a.K&&a.H!=g[1]&&Qc(a.K,b,l)}else a.K&&(kc(a.K,a,b,l,d),a.H&&Qc(a.K,b,l));f+=h<<3;b+=h;e-=h}}
function tc(a,b,c,d){a.j(1099511627776,"Memory block error (%d: %#x,%#x)\n",b,c,d);return!1}var uc=1,wc=2,Rc,Sc=new ArrayBuffer(2);(new DataView(Sc)).setUint16(0,256,!0);Rc=(new Uint16Array(Sc))[0]===256;
function qc(a,b,c,d){this.id=Tc+=2;this.offset=0;this.M=a;this.mb=b;this.size=c||0;this.type=d||Uc;this.i=d==Vc;rc(this);this.Ga=this.Fc=!1;c?(this.buffer=new ArrayBuffer(c),this.R=new DataView(this.buffer,0,c),this.g=new Uint8Array(this.buffer,0,c),this.S=new Uint16Array(this.buffer,0,c>>1),new Int32Array(this.buffer,0,c>>2),(a=Rc?Wc:Xc)||(a=Yc),Zc(this,a),$c(this,a)):(a=Yc,Zc(this,a),$c(this,a))}m=qc.prototype;m.init=function(a){this.M=a};
m.save=function(){var a;var b=Array(this.size>>2);for(a=0;a<b.length;a++)b[a]=this.R.getInt32(a<<2,!0);return b};m.restore=function(a){if(a&&this.size==a.length<<2){var b;for(b=0;b<a.length;b++)this.R.setInt32(b<<2,a[b],!0);return this.Ga=!0}return!1};function Zc(a,b,c){c&&a.A||(a.Xa=b[0]||a.Ic,a.Jc=b[2]||a.Kc);if(c||c===void 0)a.lb=b[0]||a.Ic,a.Lb=b[2]||a.Kc}function $c(a,b,c){c&&a.J||(a.Za=!a.i&&b[1]||a.ob,a.Nc=!a.i&&b[3]||a.Pb);if(c||c===void 0)a.nb=b[1]||a.ob,a.Qb=b[3]||a.Pb}
m.Na=function(a,b){b?this.J++===0&&$c(this,ad,!1):this.A++===0&&Zc(this,ad,!1)};function bd(a,b){b?--a.J===0&&(a.Za=a.i?a.ob:a.nb,a.Nc=a.i?a.Pb:a.Qb):--a.A===0&&(a.Xa=a.lb,a.Jc=a.Lb)}function rc(a,b,c){a.K=b;a.A=a.J=0;c&&((a.A=c.A)&&Zc(a,ad,!1),(a.J=c.J)&&$c(a,ad,!1))}m.Ic=function(){this.K&&this.K.j(11,"attempt to read invalid block %#x\n",this.M);return 255};m.ob=function(a,b){this.K&&this.K.j(11,"attempt to write %#06x to invalid block %#x\n",b,this.M)};
m.Kc=function(a,b){return this.Xa(a++,b++)|this.Xa(a,b)<<8};m.Pb=function(a,b,c){this.Za(a++,b&255,c++);this.Za(a,b>>8,c)};m.je=function(a,b){if(this.K&&this.M!=null){var c=this.K;cd(c,this.M+a,1,c.O)&&dd(c,!0)}return this.lb(a,b)};m.ne=function(a,b){if(this.K&&this.M!=null){var c=this.K;cd(c,this.M+a,2,c.O)&&dd(c,!0)}return this.Lb(a,b)};m.ue=function(a,b,c){if(this.K&&this.M!=null){var d=this.K;cd(d,this.M+a,1,d.D)&&dd(d,!0)}this.i?this.ob(a,b,c):this.nb(a,b,c)};
m.xe=function(a,b,c){if(this.K&&this.M!=null){var d=this.K;cd(d,this.M+a,2,d.D)&&dd(d,!0)}this.i?this.ob(a,b,c):this.Qb(a,b,c)};m.ie=function(a){return this.g[a]};m.ke=function(a){return this.g[a]};m.me=function(a){return this.R.getUint16(a,!0)};m.oe=function(a){return a&1?this.g[a]|this.g[a+1]<<8:this.S[a>>1]};m.te=function(a,b){this.g[a]=b;this.Ga=!0};m.ve=function(a,b){this.g[a]=b;this.Ga=!0};m.we=function(a,b){this.R.setUint16(a,b,!0);this.Ga=!0};
m.ye=function(a,b){a&1?(this.g[a]=b,this.g[a+1]=b>>8):this.S[a>>1]=b;this.Ga=!0};var Uc=0,Vc=2,vc=["NONE","RAM","ROM","VID","H/W"],Tc=0,Yc=[],ad=[qc.prototype.je,qc.prototype.ue,qc.prototype.ne,qc.prototype.xe],Xc=[qc.prototype.ie,qc.prototype.te,qc.prototype.me,qc.prototype.we],Wc=[qc.prototype.ke,qc.prototype.ve,qc.prototype.oe,qc.prototype.ye];
function ed(a,b){y.call(this,"CPU",a,2);var c=a.multiplier||1;this.xa=a.cycles||b;this.U=c;this.Sa=Math.round(this.xa/1E4)/100;this.aa=this.Sa*this.U;this.flags.ma=!1;this.flags.Ob=!1;this.flags.hb=a.autoStart;this.flags.Dc=!1;this.flags.Wa=!1;this.ra=this.na=0;this.ta=a.csStart;this.ka=a.csInterval;this.pa=a.csStop;this.V=[];this.ub=this.rb.bind(this);$b(this)}pa(ed,y);m=ed.prototype;
m.Ca=function(a,b,c,d){this.S=a;this.J=b;this.K=d;for(b=0;b<fd.length;b++)(c=this.R[fd[b]])&&this.S.ea("",fd[b],c);this.X=nc(a,"ChipSet");a=gd(a,"autoStart");a!=null&&(this.flags.hb=a=="true"?!0:a=="false"?!1:!!a);$b(this)};m.reset=function(){};m.save=function(){return null};m.restore=function(){return!1};m.va=function(a,b){if(!b){if(a&&this.restore){hd(this);if(!this.restore(a))return!1;id(this)}else this.reset();this.K?this.K.init():this.j("No debugger detected\n")}jd(this);return!0};
m.ua=function(a){return a?this.save():!0};m.hb=function(){return this.flags.hb||!this.K&&this.R.run===void 0?(this.rb(),!0):!1};m.Gc=function(){return 0};function id(a){a.ta===void 0&&(a.ta=0);a.ka===void 0&&(a.ka=-1);a.pa===void 0&&(a.pa=-1);a.flags.Wa=a.ta>=0&&a.ka>0;a.flags.Wa&&(a.ra=0,a.na=a.ta-a.ia)}
function kd(a,b){if(a.flags.Wa){var c=!1;a.ra=a.ra+a.Gc()|0;a.na-=b;a.na<=0&&(a.na+=a.ka,c=!0);a.pa>=0&&a.pa<=ld(a)&&(a.ka=a.pa=-1,id(a),md(a),c=!0);c&&a.j("%d cycles: checksum=%x\n",ld(a),a.ra)}}
m.ea=function(a,b,c){var d=this;a=!1;switch(b){case "power":case "reset":this.R[b]=c;a=!0;break;case "run":this.R[b]=c;c.onclick=function(){var e;if(e=d.S)if(e=d.S,e.flags.ca)e=!0;else{var f=null,g,h=Rb(e.id);for(g=0;g<h.length&&(f=h[g],f===e||f.flags.ready);g++);if(g==h.length)for(g=0;g<h.length&&(f=h[g],f===e||f.flags.ca);g++);g==h.length&&(f=e);hb("The "+f.type+" component ("+f.id+") is not "+(f.flags.ready?"powered yet":"ready yet"+(f.xb?" (waiting for notification)":""))+".");e=!1}e&&(d.flags.ma?
md(d):d.rb())};a=!0;break;case "speed":this.R[b]=c;a=!0;break;case "setSpeed":this.R[b]=c,c.onclick=function(){nd(d,d.U<<1,!0)},c.textContent=this.aa.toFixed(2)+"Mhz",a=!0}return a};function od(a,b,c){a.ia+=b;c&&(a.ga=a.g=0)}function pd(a,b){var c=1;b&&a.U>1&&a.Z&&(c=a.Z/a.Sa);a.Ua=Math.round(1E3/qd);a.Ba=Math.floor(a.xa/qd*c);b||(a.qa=a.Ba);a.Va=0}function ld(a){return a.ia+a.Y+a.ga-a.g}function hd(a){a.Z=0;a.gb=0;a.ia=a.Y=a.ga=a.g=0;id(a);nd(a,1)}
function nd(a,b,c){var d=!1;if(b!==void 0){a.Z/a.aa<.8?b=1:d=!0;a.U=b;b=a.Sa*a.U;if(a.aa!=b){a.aa=b;b=a.aa.toFixed(2)+"Mhz";var e=a.R.setSpeed;e&&(e.textContent=b);a.j("target speed: %s\n",b)}c&&a.S&&a.S.Ya()}od(a,a.Y);a.Y=0;a.W=Mb();a.fa=0;pd(a);return d}function rd(a,b,c){var d=d===void 0?-1:d;var e=a.V.length;a.V.push([b,-1,d,c]);d>=0&&Cd(a,e,d);return e}function Cd(a,b,c){b>=0&&b<a.V.length&&(b=a.V[b],b[1]<0&&(c=a.xa*a.U/1E3*c|0,a.flags.ma&&(c+=Dd(a)),b[1]=c))}
function Dd(a,b){var c=a.ga-=a.g;a.g=0;b&&(a.ga=0);return c}
m.rb=function(a){if(hc(this,!0)){if(!this.flags.ma){nd(this);this.S&&this.S.start(this.W,ld(this));this.flags.ma=!0;this.flags.Ob=!0;this.X&&this.X.start();var b=this.R.run;b&&(b.textContent="Halt");this.S&&(Ed(this.S,!0),a&&this.S.Ya(!0))}this.Va>=this.xa&&pd(this,!0);this.Ea=0;this.La=Mb();this.fa&&(a=this.La-this.fa,a>this.Ua&&(this.W+=a,this.W>this.La&&(this.W=this.La)));try{do{for(var c,d=this.flags.Wa?1:this.Ba,e=this.V.length-1;e>=0;e--){var f=this.V[e];f[1]<0||d>f[1]&&(d=f[1])}c=d;this.Bb(c);
c=Dd(this,!0);this.Ea+=c;this.Y+=c;kd(this,c);a=c;for(var g=this.V.length-1;g>=0;g--){var h=this.V[g];h[1]<0||(h[1]-=a,h[1]<=0&&(this.j(2199023255554,"updateTimer(%d): firing %s with only %d cycles left\n",a,h[0],h[1]+a),h[1]=-1,h[3](),h[2]>=0&&(Cd(this,g,h[2]),this.j(2199023255554,"updateTimer(%d): rearming %s for %dms (%d cycles)\n",a,h[0],h[2],h[1]))))}this.qa-=c;if(this.qa<=0){this.qa+=this.Ba;++this.gb>=Fd&&(this.S&&Ed(this.S),this.gb=0);break}}while(this.flags.ma)}catch(k){md(this);jd(this);
this.S&&this.S.stop(Mb(),ld(this));hc(this,!1);Yb(this,k.stack||k.message);return}c=setTimeout;d=this.ub;this.fa=Mb();e=this.Ua;this.Ea&&(e=Math.round(e*this.Ea/this.Ba));e-=this.fa-this.La;f=this.Y;if(g=this.fa-this.W)this.Z=Math.round(f/(g*10))/100,g>=864E5&&(this.ia=0,nd(this));if(e<0||this.Z<this.aa)e<-1E3&&(this.W-=e),e=0;this.Va+=this.Ea;this.fa+=e;c(d,e)}else jd(this),this.S&&this.S.stop(Mb(),ld(this))};m.Bb=function(){return 0};
function md(a,b){ac(a,!0);Dd(a);od(a,a.Y);a.Y=0;if(a.flags.ma){a.flags.ma=!1;a.X&&a.X.stop();var c=a.R.run;c&&(c.textContent="Run")}a.flags.complete=b}function jd(a,b){if(a.S){for(var c=a.S,d=0;d<c.C.length;d++)Gd(c.C[d],b);Ed(a.S,b)}}var qd=30,Fd=15,fd=["power","reset"];function Hd(a){var b=+a.model||8080;ed.call(this,a,1E6);this.model=b;this.cb=Id;hd(this);this.flags.complete=this.flags.yd=!1;this.fb=0;this.Ka=[];this.eb=0;Jd(this)}pa(Hd,ed);function Kd(a,b){a.Ka.push(b)}m=Hd.prototype;
m.reset=function(){this.flags.ma&&md(this);Jd(this);hd(this);this.flags.error=!1;ed.prototype.reset.call(this)};function Jd(a){a.i=0;a.B=0;a.C=0;a.D=0;a.F=0;a.G=0;a.H=0;a.N=0;C(a,a.eb);Ld(a,0);a.T=0}function Md(a,b){a.eb=b;C(a,b)}m.Gc=function(){var a=this.i+this.B+this.C+this.D+this.F+this.G+this.H|0;return a=a+this.N+this.u+Nd(this)|0};
m.save=function(){var a=new Od(this);a.set(0,[this.i,this.B,this.C,this.D,this.F,this.G,this.H,this.N,this.u,Nd(this)]);a.set(1,[this.T,this.ia,this.U]);for(var b=a.set,c=this.J,d=0,e=[],f=0;f<c.L;f++){var g=c.g[f];if(g.Ga||g.Fc){e[d++]=f;var h=d++;a:if(g=g.save()){for(var k=0,l=0,r=[];k<g.length;){for(var u=g[k],q=k+1;q<g.length&&g[q]===u;)q++;r[l++]=q-k;r[l++]=u;k=q}if(r.length<g.length){g=r;break a}}e[h]=g}}b.call(a,2,e);return a.data()};
m.restore=function(a){var b=a[0];this.i=b[0];this.B=b[1];this.C=b[2];this.D=b[3];this.F=b[4];this.G=b[5];this.H=b[6];this.N=b[7]&65535;C(this,b[8]);Ld(this,b[9]);b=a[1];this.T=b[0];this.ia=b[1];nd(this,b[3]);a:{b=this.J;a=a[2];for(var c=0;c<a.length-1;c+=2){var d=a[c],e=a[c+1];if(e&&e.length<b.P){var f=b.P,g=0;f=f?Array(f):[];for(var h=0;h<e.length-1;)for(var k=e[h++],l=e[h++];k--;)f[g++]=l;e=f}g=b.g[d];if(!g||!g.restore(e)){kb("Unable to restore memory block "+d);b=!1;break a}}b=!0}return b};
m.ea=function(a,b,c){switch(b){case "A":case "B":case "C":case "BC":case "D":case "E":case "DE":case "H":case "L":case "HL":case "SP":case "PC":case "PS":case "IF":case "SF":case "ZF":case "AF":case "PF":case "CF":this.R[b]=c;this.fb++;a=!0;break;default:a=ed.prototype.ea.call(this,a,b,c)}return a};function Pd(a){return a.B<<8|a.C}function Qd(a,b){a.B=b>>8&255;a.C=b&255}function Rd(a){return a.D<<8|a.F}function Sd(a,b){a.D=b>>8&255;a.F=b&255}function D(a){return a.G<<8|a.H}
function Td(a,b){a.G=b>>8&255;a.H=b&255}function C(a,b){a.u=b&65535}function Ud(a){return a.I&256?1:0}function Vd(a,b){a.I=a.I&255|b}function Wd(a){return lc[a.L&255]?4:0}function Xd(a){return(a.L^a.P)&16?16:0}function Yd(a){return a.I&255?0:64}function Zd(a){return a.L&128?128:0}function Nd(a){return a.O&-214|Zd(a)|Yd(a)|Xd(a)|Wd(a)|Ud(a)}function Ld(a,b){a.I=a.L=a.P=0;b&1&&(a.I|=256);b&4||(a.L|=1);b&16&&(a.P|=16);b&64||(a.I|=255);b&128&&(a.L^=192);a.O=a.O&-726|b&512|2}
function $d(a,b){a.P=a.i^b;return a.L=(a.I=a.i+b)&255}function ae(a,b){a.P=a.i^b;return a.L=(a.I=a.i+b+(a.I&256?1:0))&255}function be(a,b){a.I=a.L=a.P=a.i&b;(a.i|b)&8&&(a.P^=16);return a.I}function ce(a,b){a.P=b^255;b=a.L=b+255&255;a.I=a.I&-256|b;return b}function de(a,b){a.P=b;b=a.L=b+1&255;a.I=a.I&-256|b;return b}function ee(a,b){return a.L=a.I=a.P=a.i|b}function fe(a,b){b^=255;a.P=a.i^b;return a.L=(a.I=a.i+b+1^256)&255}
function ge(a,b){b^=255;a.P=a.i^b;return a.L=(a.I=a.i+b+(a.I&256?0:1)^256)&255}function he(a,b){return a.L=a.I=a.P=a.i^b}function H(a,b){a=a.J;return a.g[(b&a.F)>>>a.i].Xa(b&a.u,b)}function ie(a,b,c){a=a.J;a.g[(b&a.F)>>>a.i].Za(b&a.u,c&255,b)}function I(a){var b=H(a,a.u);C(a,a.u+1);return b}function J(a){var b=yc(a.J,a.u);C(a,a.u+2);return b}function je(a){var b=yc(a.J,a.N);a.N=a.N+2&65535;return b}function K(a,b){a.N=a.N-2&65535;Kc(a.J,a.N,b)}
function ke(a){if(a.g&&a.T&255&&a.O&512){var b;for(b=0;b<8&&!(a.T&1<<b);b++);a.T&=~(b<0?255:1<<b);a.O&=-513;a.T&=-257;a.cb[199|b<<3].call(a)}return a.T&256?(Dd(a),!1):!0}function le(a,b){a.T|=1<<b;a.O&512&&Dd(a)}function me(a,b,c,d){d=d||2;a.R[b]&&(c===void 0&&(Yb(a,"Value for "+b+" is invalid"),md(a)),c=!a.flags.ma||a.flags.Dc?w(c,d):"--------".substr(0,d),a.R[b].textContent!=c&&(a.R[b].textContent=c))}
m.Bb=function(a){this.flags.complete=!0;var b=this.flags.yd=this.K&&ne(this.K),c=a?this.flags.Ob?0:1:-1;this.flags.Ob=!1;this.ga=this.g=a;if(ke(this)){do{if(b){if(oe(this.K,this.u,c)){md(this);break}c=1}this.cb[I(this)].call(this)}while(this.g>0)}return this.flags.complete?this.ga-this.g:this.flags.complete===void 0?0:-1};zb(function(){for(var a=Pb("pcx80","cpu"),b=0;b<a.length;b++){var c=a[b],d=Qb(c);d=new Hd(d);Ob(d,c)}});function pe(){this.g-=4}function qe(){C(this,J(this));this.g-=10}
function re(){C(this,je(this));this.g-=10}function se(){var a=J(this);K(this,this.u);C(this,a);this.g-=17}
var Id=[pe,function(){Qd(this,J(this));this.g-=10},function(){ie(this,Pd(this),this.i);this.g-=7},function(){Qd(this,Pd(this)+1);this.g-=5},function(){this.B=de(this,this.B);this.g-=5},function(){this.B=ce(this,this.B);this.g-=5},function(){this.B=I(this);this.g-=7},function(){var a=this.i<<1;this.i=a&255|a>>8;Vd(this,a&256);this.g-=4},pe,function(){var a;Td(this,a=D(this)+Pd(this));Vd(this,a>>8&256);this.g-=10},function(){this.i=H(this,Pd(this));this.g-=7},function(){Qd(this,Pd(this)-1);this.g-=
5},function(){this.C=de(this,this.C);this.g-=5},function(){this.C=ce(this,this.C);this.g-=5},function(){this.C=I(this);this.g-=7},function(){var a=this.i<<8&256;this.i=(a|this.i)>>1;Vd(this,a);this.g-=4},pe,function(){Sd(this,J(this));this.g-=10},function(){ie(this,Rd(this),this.i);this.g-=7},function(){Sd(this,Rd(this)+1);this.g-=5},function(){this.D=de(this,this.D);this.g-=5},function(){this.D=ce(this,this.D);this.g-=5},function(){this.D=I(this);this.g-=7},function(){var a=this.i<<1;this.i=a&255|
Ud(this);Vd(this,a&256);this.g-=4},pe,function(){var a;Td(this,a=D(this)+Rd(this));Vd(this,a>>8&256);this.g-=10},function(){this.i=H(this,Rd(this));this.g-=7},function(){Sd(this,Rd(this)-1);this.g-=5},function(){this.F=de(this,this.F);this.g-=5},function(){this.F=ce(this,this.F);this.g-=5},function(){this.F=I(this);this.g-=7},function(){var a=this.i<<8;this.i=(Ud(this)<<8|this.i)>>1;Vd(this,a&256);this.g-=4},pe,function(){Td(this,J(this));this.g-=10},function(){var a=J(this);Kc(this.J,a,D(this));
this.g-=16},function(){Td(this,D(this)+1);this.g-=5},function(){this.G=de(this,this.G);this.g-=5},function(){this.G=ce(this,this.G);this.g-=5},function(){this.G=I(this);this.g-=7},function(){var a=0,b=Ud(this);if(Xd(this)||(this.i&15)>9)a|=6;if(b||this.i>=154)a|=96,b=1;this.i=$d(this,a);Vd(this,b?256:0);this.g-=4},pe,function(){var a;Td(this,a=D(this)+D(this));Vd(this,a>>8&256);this.g-=10},function(){var a=J(this);a=yc(this.J,a);Td(this,a);this.g-=16},function(){Td(this,D(this)-1);this.g-=5},function(){this.H=
de(this,this.H);this.g-=5},function(){this.H=ce(this,this.H);this.g-=5},function(){this.H=I(this);this.g-=7},function(){this.i=~this.i&255;this.g-=4},pe,function(){this.N=J(this)&65535;this.g-=10},function(){ie(this,J(this),this.i);this.g-=13},function(){this.N=this.N+1&65535;this.g-=5},function(){var a=D(this);ie(this,a,de(this,H(this,a)));this.g-=10},function(){var a=D(this);ie(this,a,ce(this,H(this,a)));this.g-=10},function(){ie(this,D(this),I(this));this.g-=10},function(){this.I|=256;this.g-=
4},pe,function(){var a;Td(this,a=D(this)+this.N);Vd(this,a>>8&256);this.g-=10},function(){this.i=H(this,J(this));this.g-=13},function(){this.N=this.N-1&65535;this.g-=5},function(){this.i=de(this,this.i);this.g-=5},function(){this.i=ce(this,this.i);this.g-=5},function(){this.i=I(this);this.g-=7},function(){Vd(this,Ud(this)?0:256);this.g-=4},function(){this.g-=5},function(){this.B=this.C;this.g-=5},function(){this.B=this.D;this.g-=5},function(){this.B=this.F;this.g-=5},function(){this.B=this.G;this.g-=
5},function(){this.B=this.H;this.g-=5},function(){this.B=H(this,D(this));this.g-=7},function(){this.B=this.i;this.g-=5},function(){this.C=this.B;this.g-=5},function(){this.g-=5},function(){this.C=this.D;this.g-=5},function(){this.C=this.F;this.g-=5},function(){this.C=this.G;this.g-=5},function(){this.C=this.H;this.g-=5},function(){this.C=H(this,D(this));this.g-=7},function(){this.C=this.i;this.g-=5},function(){this.D=this.B;this.g-=5},function(){this.D=this.C;this.g-=5},function(){this.g-=5},function(){this.D=
this.F;this.g-=5},function(){this.D=this.G;this.g-=5},function(){this.D=this.H;this.g-=5},function(){this.D=H(this,D(this));this.g-=7},function(){this.D=this.i;this.g-=5},function(){this.F=this.B;this.g-=5},function(){this.F=this.C;this.g-=5},function(){this.F=this.D;this.g-=5},function(){this.g-=5},function(){this.F=this.G;this.g-=5},function(){this.F=this.H;this.g-=5},function(){this.F=H(this,D(this));this.g-=7},function(){this.F=this.i;this.g-=5},function(){this.G=this.B;this.g-=5},function(){this.G=
this.C;this.g-=5},function(){this.G=this.D;this.g-=5},function(){this.G=this.F;this.g-=5},function(){this.g-=5},function(){this.G=this.H;this.g-=5},function(){this.G=H(this,D(this));this.g-=7},function(){this.G=this.i;this.g-=5},function(){this.H=this.B;this.g-=5},function(){this.H=this.C;this.g-=5},function(){this.H=this.D;this.g-=5},function(){this.H=this.F;this.g-=5},function(){this.H=this.G;this.g-=5},function(){this.g-=5},function(){this.H=H(this,D(this));this.g-=7},function(){this.H=this.i;
this.g-=5},function(){ie(this,D(this),this.B);this.g-=7},function(){ie(this,D(this),this.C);this.g-=7},function(){ie(this,D(this),this.D);this.g-=7},function(){ie(this,D(this),this.F);this.g-=7},function(){ie(this,D(this),this.G);this.g-=7},function(){ie(this,D(this),this.H);this.g-=7},function(){var a=this.u-1;if(this.Ka.length)for(var b=0;b<this.Ka.length;b++)if(this.Ka[b](a))return;this.g-=7;this.T|=256;Dd(this);this.K&&jc(this,70368744177664)?(C(this,a),dd(this.K)):this.O&512||(this.K&&C(this,
a),md(this))},function(){ie(this,D(this),this.i);this.g-=7},function(){this.i=this.B;this.g-=5},function(){this.i=this.C;this.g-=5},function(){this.i=this.D;this.g-=5},function(){this.i=this.F;this.g-=5},function(){this.i=this.G;this.g-=5},function(){this.i=this.H;this.g-=5},function(){this.i=H(this,D(this));this.g-=7},function(){this.g-=5},function(){this.i=$d(this,this.B);this.g-=4},function(){this.i=$d(this,this.C);this.g-=4},function(){this.i=$d(this,this.D);this.g-=4},function(){this.i=$d(this,
this.F);this.g-=4},function(){this.i=$d(this,this.G);this.g-=4},function(){this.i=$d(this,this.H);this.g-=4},function(){this.i=$d(this,H(this,D(this)));this.g-=7},function(){this.i=$d(this,this.i);this.g-=4},function(){this.i=ae(this,this.B);this.g-=4},function(){this.i=ae(this,this.C);this.g-=4},function(){this.i=ae(this,this.D);this.g-=4},function(){this.i=ae(this,this.F);this.g-=4},function(){this.i=ae(this,this.G);this.g-=4},function(){this.i=ae(this,this.H);this.g-=4},function(){this.i=ae(this,
H(this,D(this)));this.g-=7},function(){this.i=ae(this,this.i);this.g-=4},function(){this.i=fe(this,this.B);this.g-=4},function(){this.i=fe(this,this.C);this.g-=4},function(){this.i=fe(this,this.D);this.g-=4},function(){this.i=fe(this,this.F);this.g-=4},function(){this.i=fe(this,this.G);this.g-=4},function(){this.i=fe(this,this.H);this.g-=4},function(){this.i=fe(this,H(this,D(this)));this.g-=7},function(){this.i=fe(this,this.i);this.g-=4},function(){this.i=ge(this,this.B);this.g-=4},function(){this.i=
ge(this,this.C);this.g-=4},function(){this.i=ge(this,this.D);this.g-=4},function(){this.i=ge(this,this.F);this.g-=4},function(){this.i=ge(this,this.G);this.g-=4},function(){this.i=ge(this,this.H);this.g-=4},function(){this.i=ge(this,H(this,D(this)));this.g-=7},function(){this.i=ge(this,this.i);this.g-=4},function(){this.i=be(this,this.B);this.g-=4},function(){this.i=be(this,this.C);this.g-=4},function(){this.i=be(this,this.D);this.g-=4},function(){this.i=be(this,this.F);this.g-=4},function(){this.i=
be(this,this.G);this.g-=4},function(){this.i=be(this,this.H);this.g-=4},function(){this.i=be(this,H(this,D(this)));this.g-=7},function(){this.i=be(this,this.i);this.g-=4},function(){this.i=he(this,this.B);this.g-=4},function(){this.i=he(this,this.C);this.g-=4},function(){this.i=he(this,this.D);this.g-=4},function(){this.i=he(this,this.F);this.g-=4},function(){this.i=he(this,this.G);this.g-=4},function(){this.i=he(this,this.H);this.g-=4},function(){this.i=he(this,H(this,D(this)));this.g-=7},function(){this.i=
he(this,this.i);this.g-=4},function(){this.i=ee(this,this.B);this.g-=4},function(){this.i=ee(this,this.C);this.g-=4},function(){this.i=ee(this,this.D);this.g-=4},function(){this.i=ee(this,this.F);this.g-=4},function(){this.i=ee(this,this.G);this.g-=4},function(){this.i=ee(this,this.H);this.g-=4},function(){this.i=ee(this,H(this,D(this)));this.g-=7},function(){this.i=ee(this,this.i);this.g-=4},function(){fe(this,this.B);this.g-=4},function(){fe(this,this.C);this.g-=4},function(){fe(this,this.D);this.g-=
4},function(){fe(this,this.F);this.g-=4},function(){fe(this,this.G);this.g-=4},function(){fe(this,this.H);this.g-=4},function(){fe(this,H(this,D(this)));this.g-=7},function(){fe(this,this.i);this.g-=4},function(){Yd(this)||(C(this,je(this)),this.g-=6);this.g-=5},function(){Qd(this,je(this));this.g-=10},function(){var a=J(this);Yd(this)||C(this,a);this.g-=10},qe,function(){var a=J(this);Yd(this)||(K(this,this.u),C(this,a),this.g-=6);this.g-=11},function(){K(this,Pd(this));this.g-=11},function(){this.i=
$d(this,I(this));this.g-=7},function(){K(this,this.u);C(this,0);this.g-=11},function(){Yd(this)&&(C(this,je(this)),this.g-=6);this.g-=5},re,function(){var a=J(this);Yd(this)&&C(this,a);this.g-=10},qe,function(){var a=J(this);Yd(this)&&(K(this,this.u),C(this,a),this.g-=6);this.g-=11},se,function(){this.i=ae(this,I(this));this.g-=7},function(){K(this,this.u);C(this,8);this.g-=11},function(){Ud(this)||(C(this,je(this)),this.g-=6);this.g-=5},function(){Sd(this,je(this));this.g-=10},function(){var a=J(this);
Ud(this)||C(this,a);this.g-=10},function(){var a=I(this);Pc(this.J,a,this.i,this.u+-2&65535);this.g-=10},function(){var a=J(this);Ud(this)||(K(this,this.u),C(this,a),this.g-=6);this.g-=11},function(){K(this,Rd(this));this.g-=11},function(){this.i=fe(this,I(this));this.g-=7},function(){K(this,this.u);C(this,16);this.g-=11},function(){Ud(this)&&(C(this,je(this)),this.g-=6);this.g-=5},re,function(){var a=J(this);Ud(this)&&C(this,a);this.g-=10},function(){var a=I(this);this.i=Mc(this.J,a,this.u+-2&65535)&
255;this.g-=10},function(){var a=J(this);Ud(this)&&(K(this,this.u),C(this,a),this.g-=6);this.g-=11},se,function(){this.i=ge(this,I(this));this.g-=7},function(){K(this,this.u);C(this,24);this.g-=11},function(){Wd(this)||(C(this,je(this)),this.g-=6);this.g-=5},function(){Td(this,je(this));this.g-=10},function(){var a=J(this);Wd(this)||C(this,a);this.g-=10},function(){var a=je(this);K(this,D(this));Td(this,a);this.g-=18},function(){var a=J(this);Wd(this)||(K(this,this.u),C(this,a),this.g-=6);this.g-=
11},function(){K(this,D(this));this.g-=11},function(){this.i=be(this,I(this));this.g-=7},function(){K(this,this.u);C(this,32);this.g-=11},function(){Wd(this)&&(C(this,je(this)),this.g-=6);this.g-=5},function(){C(this,D(this));this.g-=5},function(){var a=J(this);Wd(this)&&C(this,a);this.g-=10},function(){var a=D(this);Td(this,Rd(this));Sd(this,a);this.g-=5},function(){var a=J(this);Wd(this)&&(K(this,this.u),C(this,a),this.g-=6);this.g-=11},se,function(){this.i=he(this,I(this));this.g-=7},function(){K(this,
this.u);C(this,40);this.g-=11},function(){Zd(this)||(C(this,je(this)),this.g-=6);this.g-=5},function(){var a=je(this);Ld(this,a&255|this.O&-256);this.i=a>>8;this.g-=10},function(){var a=J(this);Zd(this)||C(this,a);this.g-=10},function(){this.O&=-513;this.g-=4},function(){var a=J(this);Zd(this)||(K(this,this.u),C(this,a),this.g-=6);this.g-=11},function(){K(this,Nd(this)&255|this.i<<8);this.g-=11},function(){this.i=ee(this,I(this));this.g-=7},function(){K(this,this.u);C(this,48);this.g-=11},function(){Zd(this)&&
(C(this,je(this)),this.g-=6);this.g-=5},function(){this.N=D(this)&65535;this.g-=5},function(){var a=J(this);Zd(this)&&C(this,a);this.g-=10},function(){this.O|=512;this.g-=4;ke(this)},function(){var a=J(this);Zd(this)&&(K(this,this.u),C(this,a),this.g-=6);this.g-=11},se,function(){fe(this,I(this));this.g-=7},function(){K(this,this.u);C(this,56);this.g-=11}];
function te(a){y.call(this,"ChipSet",a,64);var b=a.model;b&&!ue[b]&&x(274877906944,"Unrecognized ChipSet model: %s\n",b);this.config=ue[b]||{};a.sound&&(this.U=null,(this.U=n.AudioContext||n.webkitAudioContext)?new this.U:this.j(2267742732288,"AudioContext not available\n"));$b(this)}pa(te,y);m=te.prototype;m.ea=function(){return!1};
m.Ca=function(a,b,c,d){this.J=b;this.A=c;this.K=d;this.S=a;this.D=nc(a,"Keyboard");this.C=nc(a,"SerialPort");this.video=nc(a,"Video");Lc(b,this,this.config.Ab);Oc(b,this,this.config.Eb);if(d){var e=this;ve(d,32,function(){for(var f="",g=0;g<e.i.length;g++)f&&(f+=g&&g%10?", ":",\n"),f+=w(e.i[g],4,!0);e.K.j("%s\n",f)})}};m.va=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};m.ua=function(a){return a?this.save():!0};
m.reset=function(){this.config.INIT&&!this.restore(this.config.INIT)&&this.j(274877906944,"reset error\n")};m.save=function(){var a=new Od(this);switch(this.config.VERSION){case we.VERSION:a.set(0,[this.ia,this.ka,this.na,this.pa,this.qa,this.ra,this.ta,this.Y]);break;case xe.VERSION:a.set(0,[this.fa,this.B,this.ga,this.N,this.T,this.Z,this.aa]);break;case L.VERSION:a.set(0,[this.V,this.F]),a.set(1,[this.G,this.H]),a.set(2,[this.u,this.O,this.W,this.X]),a.set(3,[this.L,this.g,this.I,this.P,this.i])}return a.data()};
m.restore=function(a){if(a&&a[0]&&a[0].length)switch(this.config.VERSION){case we.VERSION:return a=ra(a[0]),this.ia=a.next().value,this.ka=a.next().value,this.na=a.next().value,this.pa=a.next().value,this.qa=a.next().value,this.ra=a.next().value,this.ta=a.next().value,this.Y=a.next().value,!0;case xe.VERSION:return a=ra(a[0]),this.fa=a.next().value,this.B=a.next().value,this.ga=a.next().value,this.N=a.next().value,this.T=a.next().value,this.Z=a.next().value,this.aa=a.next().value,!0;case L.VERSION:var b=
ra(a[0]);this.V=b.next().value;this.F=b.next().value;b=ra(a[1]);this.G=b.next().value;this.H=b.next().value;b=ra(a[2]);this.u=b.next().value;this.O=b.next().value;this.W=b.next().value;this.X=b.next().value;a=ra(a[3]);this.L=a.next().value;this.g=a.next().value;this.I=a.next().value;this.P=a.next().value;this.i=a.next().value;return!0}return!1};m.start=function(){};m.stop=function(){};m.Wd=function(a,b,c){B(this,a,b,c,"PPI2CTRL",void 0,!0);this.Y=b};
m.Jd=function(a,b){var c=this.fa;B(this,a,void 0,b,"STATUS0",c,!0);return c};m.Kd=function(a,b){var c=this.B;B(this,a,void 0,b,"STATUS1",c,!0);return c};m.Ld=function(a,b){var c=this.ga;B(this,a,void 0,b,"STATUS2",c,!0);return c};m.Id=function(a,b){var c=this.N>>8-this.T&255;B(this,a,void 0,b,"SHIFT.RESULT",c,!0);return c};m.Xd=function(a,b,c){B(this,a,b,c,"SHIFT.COUNT",void 0,!0);this.T=b};m.Zd=function(a,b,c){B(this,a,b,c,"SOUND1",void 0,!0);this.Z=b};
m.Yd=function(a,b,c){B(this,a,b,c,"SHIFT.DATA",void 0,!0);this.N=b<<8|this.N>>8};m.$d=function(a,b,c){B(this,a,b,c,"SOUND2",void 0,!0);this.aa=b};m.ae=function(a,b,c){B(this,a,b,c,"WATCHDOG",void 0,!0)};function ye(a){var b=0,c=0,d=~a.L;for(a=0;a<10;a++)d&1&&(b=9-a),d>>=1;for(a=0;a<10;a++)d&1&&(c=9-a),d>>=1;return b*10+c}
m.Md=function(a,b){var c=this.F;c&=~L.wa.kc;if((ld(this.A)&64)<<1&&(c|=L.wa.kc,c!=this.F)){var d=this.I&1;var e=this.I>>1&7;switch(e){case L.ya.Ha.qd:break;case L.ya.Ha.Oc:this.L=this.L<<1|d;break;case L.ya.Ha.Tc:d=ye(this);this.i[d]=L.ya.sb;this.j("doNVRCommand(): erase data at addr %#06x\n",d);break;case L.ya.Ha.Pc:this.g=this.g<<1|d;break;case L.ya.Ha.ud:d=ye(this);e=this.g&L.ya.sb;this.i[d]=e;this.j("doNVRCommand(): write data %#06x to addr %#06x\n",e,d);break;case L.ya.Ha.od:d=ye(this);e=this.i[d];
e==null&&(e=L.ya.sb);this.g=e;this.j("doNVRCommand():  read data %#06x from addr %#06x\n",e,d);break;case L.ya.Ha.pd:this.g<<=1;this.P=this.g&L.ya.sb+1;break;default:this.j("doNVRCommand(): unrecognized command %#04x\n",e)}}c&=~L.wa.lc;this.P&&(c|=L.wa.lc);c&=~L.wa.cc;if(d=this.D){d=this.D;if(e=d.B)e=d.A,e=ld(d.A)>=d.G+(e.xa*e.U/1E3*1.2731488|0);e&&(d.B=!1);d=!d.B}d&&(c|=L.wa.cc);c&=~L.wa.uc;this.C&&this.C.la&ze&&(c|=L.wa.uc);this.F=c;B(this,a,void 0,b,"FLAGS",c);return c};
m.be=function(a,b,c){B(this,a,b,c,"BRIGHTNESS");this.V=b};m.ee=function(a,b,c){B(this,a,b,c,"NVR.LATCH");this.I=b};m.de=function(a,b,c){B(this,a,b,c,"DC012");a=b&3;switch(b>>2&3){case 0:this.u=this.u&-4|a;break;case 1:this.u=this.u&-13|a<<2;this.video&&(b=this.video,a=this.u,b.j("updateScrollOffset(%s)\n",a),b.pa!==a&&((b.pa=a)?Gd(b,!0):b.ra=!0));break;case 2:switch(a){case 0:this.O=~this.O;break;case 2:case 3:this.W=3-a}break;case 3:this.X=a}};
m.ce=function(a,b,c){B(this,a,b,c,"DC011");b&L.Ia.nd?(b&=L.Ia.qc,this.H!=b&&(this.H=b,this.video&&(a=this.video,b=this.H==L.Ia.qc?50:60,a.j("updateRate(%d)\n",b),a.gb=b))):(b&=L.Ia.Vb,this.G!=b&&(this.G=b,this.video&&(a=this.G==L.Ia.Vb?132:80,b=this.video,b.j("updateDimensions(%d,%d)\n",a,a>80&&this.F&L.wa.jc?14:24),b.P=a,b.ha=b.Ba,a>80&&b.ha--,Ve(b)&&We(b))))};
var we={VERSION:5104,Bf:{ba:4},Cf:{ba:5},Df:{ba:6},Ef:{ba:7},Ff:{ba:12},Gf:{ba:13},Hf:{ba:14},If:{ba:15},Ab:{},Eb:{15:te.prototype.Wd}},xe={VERSION:1978.1,sd:{ba:0,ef:1,kf:16,sf:32,Jf:64,Af:128,ab:14},Ma:{ba:1,Sc:1,md:2,hd:4,jd:16,kd:32,ld:64,ab:8},td:{ba:2,df:3,Rf:4,ff:8,wf:16,xf:32,yf:64,gf:128,ab:0},Nf:{ba:3},Lf:{ba:2,tf:7},Pf:{ba:3,Sf:1,Of:2,zf:4,qf:8,jf:16,ze:32},Mf:{ba:4},Qf:{ba:5,lf:1,mf:2,nf:4,pf:8,Tf:16},Ab:{0:te.prototype.Jd,1:te.prototype.Kd,2:te.prototype.Ld,3:te.prototype.Id},Eb:{2:te.prototype.Xd,
3:te.prototype.Zd,4:te.prototype.Yd,5:te.prototype.$d,6:te.prototype.ae}},L={VERSION:100,wa:{ba:66,uc:1,jc:2,gd:4,vf:8,uf:16,lc:32,kc:64,cc:128},Rc:{ba:66,INIT:0},Ia:{ba:194,Ce:0,Vb:16,nd:32,qc:48,Wc:0,Xc:32},qb:{ba:162,Kf:0,Zc:0,Vc:0,Yc:0,Uc:0},ya:{rf:{ba:98},Ha:{Pc:0,Oc:1,pd:2,ud:4,Tc:5,od:6,qd:7},sb:16383},Ab:{66:te.prototype.Md},Eb:{66:te.prototype.be,98:te.prototype.ee,162:te.prototype.de,194:te.prototype.ce}},ue={Juku:we,SI1978:xe,VT100:L};we.INIT=[[0,0,0,0,0,0,0,0]];
xe.INIT=[[xe.sd.ab,xe.Ma.ab,xe.td.ab,0,0,0,0]];
L.INIT=[[L.Rc.INIT,L.wa.jc|L.wa.gd],[L.Ia.Wc,L.Ia.Xc],[L.qb.Zc,L.qb.Vc,L.qb.Yc,L.qb.Uc],[0,0,0,0,[11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11776,11784,11918,11776,11984,11888,11776,11808,11776,12E3,12E3,11901,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11776,11784,11918,11808,11984,11856,11776,11808,11776,12E3,12E3,11881,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]];
zb(function(){for(var a=Pb("pcx80","chipset"),b=0;b<a.length;b++){var c=a[b],d=Qb(c);d=new te(d);Ob(d,c)}});function Xe(a){y.call(this,"ROM",a);this.g=null;this.C=a.addr;this.i=a.size;this.B=a.alias;this.u=a.file;this.D=Oa(this.u);if(this.u){a=this.u;this.j(2267742732288,'load("%s"\n',a);var b=Pa(this.D);b!="json"&&b!="hex"&&(a=ib()+"/api/v1/dump?file="+this.u+"&format=bytes&decimal=true");var c=this;cb(a,null,!0,function(d,e,f){Ye(c,d,e,f)})}}pa(Xe,y);
Xe.prototype.Ca=function(a,b,c,d){this.J=b;this.A=c;this.K=d;Ze(this)};Xe.prototype.va=function(){if(this.sa){if(this.K){var a=this.K,b=this.id,c=this.C,d=this.i,e=this.sa,f=[],g;for(g in e){var h=e[g];typeof h=="number"&&(e[g]=h={o:h});var k=h.o,l=h.a;if(k!==void 0){var r=f;k=[k>>>0,g];var u=ab(r,k,a.Cc);u<0&&r.splice(-(u+1),0,k)}l&&(h.a=l.replace(/''/g,'"'))}a.F.push({Yf:b,M:c,Qd:d,sa:e,Ac:f})}delete this.sa}return!0};Xe.prototype.ua=function(){return!0};
function Ye(a,b,c,d){if(d)a.j(274877906944,"Unable to load system ROM (error %d: %s)\n",d,b);else{Lb(a.Qa,b,c);if(c.charAt(0)=="["||c.charAt(0)=="{")try{var e=eval("("+c+")"),f=e.width,g=e.values,h=e.littleEndian!==!1;if(!f||!g)if(f=0,g=e.bytes)f=8;else if(g=e.longs||e.data)f=32;if(f)if(f==8)a.g=g;else for(c=f>>>3,a.g=Array(g.length*c),f=d=0;d<g.length;d++){var k=g[d];if(h)for(var l=0;l<c;l++)a.g[f+l]=k&255,k>>>=8;else for(l=c-1;l>=0;l--)a.g[f+l]=k&255,k>>>=8;f+=c}else a.g=e;a.sa=e.symbols;if(!a.g.length){kb("Empty ROM: "+
b);return}if(a.g.length==1){kb(a.g[0]);return}}catch(r){a.j(274877906944,"ROM data error: %s\n",r.message);return}else for(b=c.replace(/\n/gm," ").replace(/ +$/,"").split(" "),a.g=Array(b.length),e=0;e<b.length;e++)a.g[e]=Ma(b[e],16);Ze(a)}}
function Ze(a){if(!Zb(a))if(!a.u)$b(a);else if(a.g&&a.J){a.i||(a.i=a.g.length);if(a.g.length!=a.i)Yb(a,"ROM size ("+w(a.g.length,8,!0)+") does not match specified size ("+w(a.i,8,!0)+")");else{var b=a.C;if(sc(a.J,b,a.i,Vc)){a.j(2267742732288,"addROM(%#010x): %#010x bytes\n",b,a.g.length);for(var c=0;c<a.g.length;c++)Jc(a.J,b+c,a.g[c]);b=!0}else b=!1;if(b){b=[];typeof a.B=="number"?b.push(a.B):a.B!=null&&a.B.length&&(b=a.B);for(c=0;c<b.length;c++){for(var d=a,e=b[c],f=d.J,g=d.i,h=[],k=d.C>>>f.i;g>
0&&k<f.g.length;)h.push(f.g[k++]),g-=f.B;f=d.J;d=d.i;g=0;for(e>>>=f.i;d>0&&e<f.g.length;){k=h[g++];if(!k)break;f.g[e++]=k;d-=f.B}}delete a.g}}$b(a)}}zb(function(){for(var a=Pb("pcx80","rom"),b=0;b<a.length;b++){var c=a[b],d=Qb(c);d=new Xe(d);Ob(d,c)}});
function $e(a){y.call(this,"RAM",a);this.sa=this.i=null;this.B=a.addr;this.C=a.size;this.Oa=a.load;this.Fa=a.exec;this.u=!1;this.g=a.file;this.D=Oa(this.g);if(this.g){a=this.g;this.j(2267742732288,'load("%s")\n',a);var b=Pa(this.D);b!="json"&&b!="hex"&&(a=ib()+"/api/v1/dump?file="+this.g+"&format=bytes&decimal=true");var c=this;cb(a,null,!0,function(d,e,f){f?c.j(274877906944,"Unable to load RAM resource (error %d: %s)\n",f,d):(Lb(c.Qa,d,e),(d=jb(d,e))?(c.i=d.oa,c.sa=d.sa,c.Oa==null&&(c.Oa=d.Oa),c.Fa==
null&&(c.Fa=d.Fa)):c.g=null,af(c))})}}pa($e,y);$e.prototype.Ca=function(a,b,c,d){this.J=b;this.A=c;this.K=d;af(this)};$e.prototype.va=function(){return!0};$e.prototype.ua=function(){return!0};
function af(a){!a.u&&a.C&&sc(a.J,a.B,a.C,1)&&(a.u=!0);if(!Zb(a)){if(!a.u)kb("No RAM allocated");else if(a.g){if(!a.i||!a.J)return;var b=a.B;a.Oa!==null&&(b=a.Oa);for(var c=0;c<a.i.length;c++)Jc(a.J,b+c,a.i[c]);if(a.Fa!==null){if(a.Fa==bf){for(b=0;b<cf.length;b++)Jc(a.J,cf[b],118);Kd(a.A,function(d){return function(e){if(cf.indexOf(e)>=0){var f=!1,g=d.A,h=d.K;if(e==df)switch(f=!0,g.C){case ef:d.print(String.fromCharCode(g.F).replace(/\r/g,""));break;case ff:for(var k=Rd(g),l="",r=255;r--;){var u=H(d.A,
k++);if(u==36)break;l+=String.fromCharCode(u)}d.print(l.replace(/\r/g,""));break;default:f=!1}f?re.call(g):h&&(d.print("\nCP/M vector %#06x\n",e),C(g,e),dd(h));e=!0}else e=!1;return e}}(a))}Md(a.A,a.Fa)}delete a.i}$b(a)}}$e.prototype.reset=function(){};var df=5,ef=2,ff=9,bf=256,cf=[0,df];zb(function(){for(var a=Pb("pcx80","ram"),b=0;b<a.length;b++){var c=a[b],d=Qb(c);d=new $e(d);Ob(d,c)}});
function gf(a){y.call(this,"Keyboard",a,128);(a=a.model)&&!hf[a]&&x(274877906944,"Unrecognized KeyboardX80 model: %s\n",a);this.config=hf[a]||{};this.reset();$b(this)}pa(gf,y);m=gf.prototype;
m.ea=function(a,b,c){var d=this,e=a+"-"+b;if(this.R[e]===void 0){if(a=="led"&&this.config.bb[b])return this.R[e]=c,!0;switch(b){case "kbd":case "screen":return rb("iOS")?(c.onkeypress=function(f){f=f.keyCode||f.charCode;var g=!1,h=d.config.pb[f];if(h){h&128&&(h&=127,g=!0);a:{for(k in d.config.Ra)if(d.config.Ra[k]==h){var k=+k;break a}k=0}k&&(g?jf(d,16,!0,!0):jf(d,16,!1),jf(d,k,!0,!0))}d.j(256,"oniOSKeyPress(%d)\n",f);return!0},c.onkeydown=function(f){return kf(d,f,!0)},c.onkeyup=function(f){return kf(d,
f,!1)}):(c.onkeydown=function(f){return lf(d,f,!0)},c.onkeyup=function(f){return lf(d,f,!1)},c.onkeypress=function(f){f=f.keyCode||f.charCode;f>=v.$a&&f<=v.tb?d.g&(mf|nf)||(d.g|=nf,jf(d,20,!0),of(d)):f>=v.a&&f<=v.z&&d.g&nf&&(d.g&=~nf,jf(d,20,!1),of(d));d.j(256,"onKeyPress(%d)\n",f);return!0}),c.onpaste=function(f){a:{if(d.C&&d.C.Pa&&(f.stopPropagation&&f.stopPropagation(),f.preventDefault&&f.preventDefault(),f=f.clipboardData||n.clipboardData)){pf(d.C,f.getData("Text"));f=!1;break a}f=!0}return f},
!0;default:if(this.config.Ta&&this.config.Ta[b]!==void 0)return this.R[e]=c,c.onclick=function(f,g){return function(h){h.preventDefault&&h.preventDefault();h=!0;var k=0;g==17?k=qf:g==20&&(k=nf);if(k){c.style.fontWeight="normal";if(h=!(f.g&k))c.style.fontWeight="bold";rf(f,g,h)}jf(f,g,h,!k);f.S&&f.S.Ya()}}(this,this.config.Ta[b]),!0}}return!1};
m.Ca=function(a,b,c,d){this.S=a;this.A=c;this.K=d;var e=this;this.I=rd(this.A,this.id,function(){sf(e)});this.X=nc(a,"ChipSet");this.C=nc(a,"SerialPort");Lc(b,this,this.config.ge);Oc(b,this,this.config.he)};m.va=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};m.ua=function(a){return a?this.save():!0};m.reset=function(){this.i=[];this.g=0;this.config.INIT&&!this.restore(this.config.INIT)&&this.j(274877906944,"reset error\n")};
m.save=function(){var a=new Od(this);switch(this.config.Ja){case tf.Ja:break;case M.Ja:a.set(0,[this.F,this.D,this.B,this.G,-1])}return a.data()};m.restore=function(a){var b;if(a&&(b=a[0])&&b.length)switch(this.config.Ja){case tf.Ja:return!0;case M.Ja:return this.F=b[0],of(this,this.F&M.za.dc),this.D=b[1],this.B=b[2],this.G=b[3],this.u=b[4],!0}return!1};
function of(a,b){b!=null?a.H=b:b=a.H;for(var c in a.config.bb){var d="led-"+c;if(d=a.R[d]){var e=a.config.bb[c],f=!!(b&e);e&e-1&&(f=!(b&~e));d.style.backgroundColor=f?"#"+w(16711680,6):"#000000"}}if(d=a.R["led-caps-lock"])d.style.backgroundColor=a.g&nf?"#"+w(65280,6):"#000000"}function rf(a,b,c,d){var e=0;switch(b){case 16:e=d?uf:vf;break;case 17:e=d?wf:qf;break;case 18:e=d?xf:yf;break;case 91:e=d?zf:Af;break;case 20:e=nf,c=!(a.g&e)}e&&(a.g=c?a.g|e:a.g&~e);return c}
function lf(a,b,c){var d=!0,e=b.keyCode;a.j(256,"onKey%s(%d)\n",c?"Down":"Up",e);e=Ia[e]||e;c=rf(a,e,c,b.location==2);a:{var f=e;f=a.config.Sb[f]||f;if(!a.config.Ra[f]){for(var g in a.config.Ta)if(a.config.Ta[g]===f){f=g;break a}f=null}}f&&!b.metaKey&&(d=!1,a.g&(Bf|Cf)&&(f==13?(f=118,d=!0):f==8&&(f=46,d=!0),d&&(a.g=c?a.g|Cf:a.g&~Cf)),d=jf(a,f,c),(!(f>=v.$a&&f<=v.tb)||a.g|Df)&&b.preventDefault&&b.preventDefault());a.j(256,"onKey%s(%d): softCode=%s, pass=%b\n",c?"Down":"Up",e,f,d);return d}
function kf(a,b,c){var d=!0;if(c){var e=b.keyCode,f=a.config.Ra[e],g;if(g=f){a:{for(var h in a.config.pb)if(a.config.pb[h]==f){f=+h;break a}f=0}g=!f}g&&(d=jf(a,e,c,!0),b.preventDefault&&b.preventDefault(),a.j(256,"oniOSKey%s(%d): pass=%b\n",c?"Down":"Up",e,d))}return d}
function jf(a,b,c,d){var e;a:{for(e=0;e<a.i.length;e++)if(a.i[e].Nb==b)break a;e=-1}if(c)e<0?a.i.push({Nb:b,Kb:Date.now(),wb:d||!1}):(a.i[e].Kb=Date.now(),a.i[e].wb=d||!1),d&&sf(a);else if(e>=0){if(!a.i[e].wb&&(d=a.i[e].Kb)&&Date.now()-d<Ef)return a.i[e].wb=!0,sf(a),!0;a.i.splice(e,1)}if(a.X){d=0;switch(b){case "1p":d=xe.Ma.hd;break;case "2p":d=xe.Ma.md;break;case "coin":d=xe.Ma.Sc;break;case "left":d=xe.Ma.kd;break;case "right":d=xe.Ma.ld;break;case "fire":d=xe.Ma.jd}d&&(a=a.X,b=d,a.B&=~b,c&&(a.B|=
b))}return!0}function sf(a){for(var b=0,c=-1;b<a.i.length;){if(a.i[b].wb){var d=a.i[b].Nb,e=Ef-(Date.now()-a.i[b].Kb);if(e>0){if(c<0||c>e)c=e}else{jf(a,d,!1);b=0;continue}}b++}c>=0&&Cd(a.A,a.I,c)}m.Nd=function(a,b){var c=this.D;this.u>=0&&(this.u<this.i.length?(c=this.i[this.u],this.u++,c=M.Ra[c.Nb],c&128&&(c&=127)):(this.u=-1,c=M.ad),this.D=c,le(this.A,1));B(this,a,void 0,b,"KBDUART.ADDRESS",c);return c};
m.fe=function(a,b,c){B(this,a,b,c,"KBDUART.STATUS");this.F=b;this.B=!0;this.G=ld(this.A);of(this,b&M.za.dc);b&M.za.rd&&(this.u=0,le(this.A,1))};var uf=1,vf=2,mf=3,wf=4,qf=8,Df=12,xf=16,yf=32,Bf=48,zf=64,Af=128,nf=512,Cf=4096,Ef=50,Ff={};Ff[v.$a]=37;Ff[v.zb]=39;Ff[v.Db]=32;
var tf={Ja:1978.1,Ra:{},pb:{},Sb:Ff,bb:{},Ta:{"1p":49,"2p":50,coin:51,left:37,right:39,fire:32}},N={},O={},M={Ja:100,Ra:(N[8]=3,N[v.nc]=5,N[v.mc]=6,N[v.zc]=7,N[v.sc]=8,N[v.wc]=9,N[v.Q]=10,N[39]=16,N[221]=20,N[219]=21,N[v.Zb]=22,N[v.tc]=23,N[v.oc]=24,N[v.E]=25,N[49]=26,N[37]=32,N[40]=34,N[117]=35,N[19]=35,N[192]=36,N[189]=37,N[57]=38,N[55]=39,N[52]=40,N[51]=41,N[27]=42,N[38]=48,N[114]=49,N[112]=50,N[46]=51,N[187]=52,N[48]=53,N[56]=54,N[54]=55,N[53]=56,N[50]=57,N[9]=58,N[103]=64,N[115]=65,N[113]=66,
N[96]=67,N[118]=68,N[220]=69,N[v.Db]=70,N[v.bc]=71,N[v.Xb]=72,N[v.Wb]=73,N[v.$a]=74,N[104]=80,N[2013]=81,N[98]=82,N[97]=83,N[222]=85,N[186]=86,N[v.$b]=87,N[v.Yb]=88,N[v.zb]=89,N[v.rc]=90,N[110]=96,N[116]=97,N[101]=98,N[100]=99,N[13]=100,N[190]=101,N[188]=102,N[v.hc]=103,N[v.Tb]=104,N[v.xc]=105,N[119]=106,N[105]=112,N[99]=113,N[102]=114,N[109]=115,N[191]=117,N[v.fc]=118,N[v[" "]]=119,N[v.vc]=120,N[v.Ub]=121,N[v.tb]=122,N[120]=123,N[17]=124,N[16]=125,N[20]=126,N),pb:(O[v.p]=5,O[v.Sd]=6,O[v.y]=7,O[v.t]=
8,O[v.w]=9,O[v.q]=10,O[v["]"]]=20,O[v["["]]=21,O[v.Fd]=22,O[v.re]=23,O[v.r]=24,O[v.e]=25,O[v["1"]]=26,O[v["`"]]=36,O[v["-"]]=37,O[v["9"]]=38,O[v["7"]]=39,O[v["4"]]=40,O[v["3"]]=41,O[v["="]]=52,O[v["0"]]=53,O[v["8"]]=54,O[v["6"]]=55,O[v["5"]]=56,O[v["2"]]=57,O[v["\\"]]=69,O[v.Pd]=70,O[v.k]=71,O[v.Bd]=72,O[v.f]=73,O[v.a]=74,O[v["'"]]=85,O[v[";"]]=86,O[v.Od]=87,O[v.Dd]=88,O[v.d]=89,O[v.s]=90,O[13]=100,O[v["."]]=101,O[v[","]]=102,O[v.n]=103,O[v.b]=104,O[v.x]=105,O[v["/"]]=117,O[v.Rd]=118,O[v.se]=120,
O[v.c]=121,O[v.z]=122,O[v.nc]=133,O[v.mc]=134,O[v.zc]=135,O[v.sc]=136,O[v.wc]=137,O[v.Q]=138,O[v["}"]]=148,O[v["{"]]=149,O[v.Zb]=150,O[v.tc]=151,O[v.oc]=152,O[v.E]=153,O[v["!"]]=154,O[v["~"]]=164,O[v._]=165,O[v["("]]=166,O[v["&"]]=167,O[v.$]=168,O[v["#"]]=169,O[v["+"]]=180,O[v[")"]]=181,O[v["*"]]=182,O[v["^"]]=183,O[v["%"]]=184,O[v["@"]]=185,O[v["|"]]=197,O[v.Db]=198,O[v.bc]=199,O[v.Xb]=200,O[v.Wb]=201,O[v.$a]=202,O[v['"']]=213,O[v[":"]]=214,O[v.$b]=215,O[v.Yb]=216,O[v.zb]=217,O[v.rc]=218,O[v[">"]]=
229,O[v["<"]]=230,O[v.hc]=231,O[v.Tb]=232,O[v.xc]=233,O[v["?"]]=245,O[v.fc]=246,O[v.vc]=248,O[v.Ub]=249,O[v.tb]=250,O),Sb:{},bb:{},Ta:{"caps-lock":20,ctrl:17,esc:27,tab:9,"num-comma":116,"break":117,"line-feed":118,"no-scroll":119,setup:120},Qc:{ba:130,INIT:127},za:{ba:130,ed:1,dd:2,cd:4,bd:8,fd:16,ec:32,dc:63,rd:64,Be:128,INIT:0},ad:127};M.bb={l4:M.za.ed,l3:M.za.dd,l2:M.za.cd,l1:M.za.bd,locked:M.za.fd,local:M.za.ec,online:~M.za.ec,"caps-lock":nf};var hf={SI1978:tf,VT100:M};
M.INIT=[[M.za.INIT,M.Qc.INIT,!1,0,-1]];M.ge={130:gf.prototype.Nd};M.he={130:gf.prototype.fe};zb(function(){for(var a=Pb("pcx80","keyboard"),b=0;b<a.length;b++){var c=a[b],d=Qb(c);d=new gf(d);Ob(d,c)}});
function Gf(a,b,c,d,e){y.call(this,"Video",a,512);var f=this;this.Sa=rb("Gecko/");this.N=a.screenWidth;this.I=a.screenHeight;this.ia=a.bufferAddr;this.zd=a.bufferRAM;var g=a.bufferFormat;this.Z=g&&Hf[g.toUpperCase()]||If;this.P=a.bufferCols;this.aa=a.bufferRows;this.Ba=this.ha=a.cellWidth||1;this.da=a.cellHeight||1;this.fa=null;this.La=!1;this.ka=a.bufferBits||1;this.Ad=a.bufferLeft||0;if(this.i=a.bufferRotate)this.i=this.i%360,this.i>0&&(this.i-=360),this.i!=-90&&(this.j(274877906944,"unsupported buffer rotation: %d\n",
this.i),this.i=0);this.na=a.interruptRate;this.ub=a.refreshRate||60;this.H=b;this.u=c;this.W=(this.Ed=d)||b||null;this.wd=this.N;this.xd=this.I;this.Ea=this.N/this.P|0;this.Ka=this.I/this.aa|0;this.da>1&&(this.aa++,this.pa=0,this.ra=!1);b=a.smoothing;(c=ub("smoothing"))&&(b=c=="true");this.Ua=b;this.Rb=sb(this.u,"imageSmoothingEnabled");if(this.B=a.screenRotate)this.B=this.B%360,this.B>0&&(this.B-=360),this.B!=-90?(this.j(274877906944,"unsupported screen rotation: %d\n",this.B),this.B=0):(this.u.translate(0,
this.I),this.u.rotate(this.B*Math.PI/180),this.u.scale(this.I/this.N,this.N/this.I));if(this.g=e)if(b=sb(e,"requestFullscreen")||sb(e,"requestFullScreen")){this.g.jb=e[b];if(e=sb(document,"on","fullscreenchange")){var h=sb(document,"fullscreenElement")||sb(document,"fullScreenElement");document.addEventListener(e,function(){Jf(f,document[h]!=null)},!1)}(e=sb(document,"on","fullscreenerror"))&&document.addEventListener(e,function(){Jf(f)},!1)}if(this.T=a.fontROM)Pa(this.T)!="json"&&(this.T=ib()+"/api/v1/dump?file="+
this.T+"&format=bytes"),cb(this.T,null,!0,function(k,l,r){Kf(f,k,l,r)});this.xa={}}pa(Gf,y);
function Ve(a){a.F=a.P*a.ha;a.O=a.aa*a.da;var b=a.F,c=a.O;a.i&&(b=a.O,c=a.F);a.L=0;if(!a.zd&&(a.L=(a.F*a.ka>>3)*a.O,!sc(a.J,a.ia,a.L,3)))return!1;a.L?(a.Va=a.u.createImageData(b,c),a.eb=16/a.ka|0,Lf(a,a.L>>1)):Lf(a,(a.P+1)*a.aa);a.G=document.createElement("canvas");a.G.width=b;a.G.height=c;a.qa=a.G.getContext("2d");a.U={};a.Y=1<<a.ka;a.V=Array(a.Y+Mf);a.V[0]=[0,0,0,255];a.V[1]=[255,255,255,255];a.Z==Nf&&(a.V[a.Y+Of]=[255,255,0,255],a.V[a.Y+Pf]=[0,255,0,255]);a.Z==Qf&&(a.gb=60,a.ta=!1,a.ga=Array(a.P));
a.Rb&&(a.u[a.Rb]=a.Ua==null?!1:a.Ua);return!0}m=Gf.prototype;m.ea=function(a,b,c){var d=this;if(a=="led"||a=="rled")return this.xa[b]=c,!0;switch(b){case "fullScreen":return this.R[b]=c,this.g&&this.g.jb?c.onclick=function(){d.j(2199023255552,"fullScreen()\n");d.jb()}:(this.j(2267742732288,"FullScreen API not available\n"),c.parentNode.removeChild(c)),!0}return!1};
m.Ca=function(a,b,c,d){this.S=a;this.J=b;this.A=c;this.K=d;Ve(this);if(this.D=nc(a,"Keyboard")){for(var e in this.xa)this.D.ea("led",e,this.xa[e]);this.H&&this.D.ea(this.Ed?"textarea":"canvas","screen",this.W)}var f=this;this.Bc=rd(this.A,this.id,function(){Gd(f)});Cd(this.A,this.Bc,1E3/Math.max(this.ub,this.na));this.fb=0;this.T||$b(this)};
function Kf(a,b,c,d){if(d)a.j(274877906944,"Unable to load font ROM (error %d: %s)\n",d,b);else{Lb(a.Qa,b,c);try{var e=eval("("+c+")"),f=e.bytes||e;if(!f||!f.length){kb("Empty font ROM: "+b);return}if(f.length==1){kb(f[0]);return}if(f.length==2048)a.fa=f,We(a);else{a.j(274877906944,"Unrecognized font data length (%d)\n",f.length);return}}catch(g){a.j(274877906944,"Font ROM data error: %s\n",g.message);return}(a.u||a.K)&&$b(a)}}
function We(a){a.fa&&(a.La=a.Z==Qf,a.U[Rf]=[Sf(a,a.ha,a.da),Sf(a,a.ha,a.da,a.ta)],a.U[Tf]=[Sf(a,a.ha*2,a.da),Sf(a,a.ha*2,a.da,a.ta)],a.U[Uf]=a.U[Vf]=[Sf(a,a.ha*2,a.da*2),Sf(a,a.ha*2,a.da*2,a.ta)])}
function Sf(a,b,c,d){var e=a.Ba<=8?8:16,f=e>8?15:0,g=a.fa.length/e,h=d===!1,k={ha:b,da:c};k.canvas=document.createElement("canvas");k.canvas.width=b*16;k.canvas.height=g/16*c;k.context=k.canvas.getContext("2d");for(var l=k.context.createImageData(b,c),r=0;r<g;r++){for(var u=0,q=u;u<a.da;u++){var p=r*e+(f+u&e-1);p=d&&u==8?255:a.fa[p];for(var A=0;A<c/a.da;A++){for(var E=0,F=0,G=F;F<a.ha;F++){var z=p&128>>(F>7?7:F);E=a.La&&!z&&E?E:z;for(var fa=0;fa<b/a.ha;fa++)h&&(E=!E),Wf(a,l,G,q,E?1:0),G++;E=z}q++}}k.context.putImageData(l,
(r&15)*b,(r>>4)*c)}return k}m.va=function(a,b){return b||!a||this.restore(a)?!0:!1};m.ua=function(a){return!a||this.save()};m.save=function(){var a=new Od(this);a.set(0,[]);return a.data()};m.restore=function(){return!0};
m.jb=function(){var a=!1;if(this.g){if(this.g.jb){a="100%";if(screen&&screen.width&&screen.height){var b=screen.width/screen.height,c=this.N/this.I;b>c&&(a=Math.round(c/b*100)+"%")}this.Sa?(this.H.style.width=a,this.H.style.width=a,this.H.style.display="block",this.H.style.margin="auto"):(this.g.style.width=a,this.g.style.height="auto");this.g.style.backgroundColor="black";this.g.jb();a=!0}this.W&&this.W.focus()}return a};
function Jf(a,b){!b&&a.g&&(a.Sa?a.H.style.width=a.H.style.height="":a.g.style.width=a.g.style.height="");a.j("notifyFullScreen(%s)\n",b)}function Lf(a,b){a.cb=b;a.X=!1;if(a.C===void 0||a.C.length!=a.cb)a.C=Array(a.cb)}function Wf(a,b,c,d,e){d=a.i?(b.height-c-1)*b.width+d:c+d*b.width;e&&a.Z==Nf&&(c>=208&&c<236?e=a.Y+Of:c>=28&&c<72&&(e=a.Y+Pf));a=a.V[e];d*=a.length;b.data[d]=a[0];b.data[d+1]=a[1];b.data[d+2]=a[2];b.data[d+3]=a[3]}
function Gd(a,b){var c=!0;if(!b){a.na&&(a.na==120?a.fb&1?(le(a.A,2),c=!1):le(a.A,1):le(a.A,4));if(c&&a.X&&a.L){var d=a.J,e=a.ia,f=a.L,g=!0,h=e>>>d.i;for(e=d.B-(e&d.u);f>0&&h<d.g.length;)d.g[h].Ga&&(d.g[h].Ga=g=!1,d.g[h].Fc=!0),f-=e,e=d.B,h++;g&&(c=!1)}Cd(a.A,a.Bc,1E3/Math.max(a.ub,a.na));a.fb++}if(c)if(a.ha>1)switch(a.Z){case Qf:c=a.ia;d=-1;g=0;h=a.gb==60?2:5;for(var k=e=0,l=-1;g<a.aa;){var r=0,u=c,q=a.P;f=d;for(f!=Rf&&(q>>=1);;){var p=xc(a.J,u++);if((p&Xf)==Xf){p=xc(a.J,u++);d=p&Yf;c=(p&Zf)<<8|xc(a.J,
u);c+=p&$f?ag:bg;break}if(r<q)a.ga[r++]=p;else break}if(h)h--;else{for(;r<a.ga.length;)a.ga[r++]=0;if(f>=0)for(u=a.X&&a.C[e]==q,a.C[e++]=q,q=0;q<r;q++){var A=a.ga[q];if(!u||A!==a.C[e]){a.C[l=e]=A;p=a;var E=f;var F=q;var G=g;var z=A;A=a.qa;var fa=z&127;if(z=p.U[E][z&128?1:0]){var Y=(fa&15)*z.ha;fa=(fa>>4)*z.da;var ha=z.ha,ma=z.da;if(A){F*=p.ha;var Qa=G*p.da;var ia=p.ha;G=p.da}else F*=p.Ea,Qa=G*p.Ka,ia=p.Ea,G=p.Ka;z.ha>p.ha&&(F*=2,ia*=2);z.da>p.da&&(E==Vf&&(fa+=p.da),ma=p.da);A?A.drawImage(z.canvas,
Y,fa,ha,ma,F,Qa,ia,G):p.u.drawImage(z.canvas,Y,fa,ha,ma,F,Qa,ia,G)}k++}e++}g++}}a.X=!0;!b&&a.ra&&k==1&&(a.C[l]=-1,k=0);a.ra=!1;(k||b)&&a.qa&&a.u.drawImage(a.G,0,a.pa,a.F,a.O-a.da,0,0,a.wd,a.xd)}else{f=a.ia;g=f+a.L;k=e=h=0;b=a.F;l=0;c=a.O;r=d=0;u=a.ka;q=(1<<u)-1;a.Ad&&(u=-u,r=16+u);for(;f<g;){p=zc(a.J,f);if(a.X&&p===a.C[h])e+=a.eb;else{a.C[h]=p;(E=r)&&(p=p>>8|(p&255)<<8);e<b&&(b=e);for(A=a.eb;A--;)z=p>>E&q,Wf(a,a.Va,e++,k,z),E+=u;e>l&&(l=e);k<c&&(c=k);k>=d&&(d=k+1)}f+=2;h++;if(e>=a.F&&(e=0,k++,k>a.O))break}a.X=
!0;b<a.F&&(f=l-b,d-=c,a.i&&(g=b,h=f,b=c,f=d,c=a.F-(g+h),d=h),a.qa.putImageData(a.Va,0,0,b,c,f,d),a.u.drawImage(a.G,0,0,a.G.width,a.G.height,0,0,a.N,a.I))}}var Of=0,Pf=1,Mf=2,If=0,Nf=1,Qf=2,Hf={SI1978:Nf,VT100:Qf},Rf=96,Tf=64,Uf=32,Vf=0,Xf=127,Zf=15,$f=16,Yf=96,ag=8192,bg=16384;
zb(function(){for(var a=Pb("pcx80","video"),b=0;b<a.length;b++){var c=a[b],d=Qb(c),e=void 0,f=void 0,g=Pb("pcjs-canvas","",c);g&&g.length&&g[0].getContext?(e=g[0],e.style.backgroundColor=d.screenColor,f=e.getContext("2d")):c.innerHTML="<br>Missing &lt;canvas&gt; support. Please try a newer web browser.";lb().indexOf("MSIE")>=0&&(c.onresize=function(h,k,l,r){return function(){k.style.height=(h.clientWidth*r/l|0)+"px"}}(c,e,d.screenWidth,d.screenHeight),c.onresize());(g=+(d.aspect||ub("aspect")))&&
g>=.3&&g<=3.33&&(yb("resize",function(h,k,l){return function(){k.style.height=(h.clientWidth/l|0)+"px"}}(c,e,g)),window.onresize());g=void 0;xa&&(g=document.createElement("textarea"),rb("iOS")&&(g.setAttribute("autocapitalize","off"),g.setAttribute("autocorrect","off"),g.setAttribute("spellcheck","false"),g.style.fontSize="16px"),c.appendChild(g));d=new Gf(d,e,f,g,c);Ob(d,c)}});
function cg(a){y.call(this,"SerialPort",a,4096);this.V=+a.adapter;switch(this.V){case 0:this.W=0;this.Y=2;break;default:x(549755813888,"Unrecognized serial adapter #"+this.V);return}this.i=this.u=null;this.P=a.tabSize;this.U=a.charBOL;this.B=0;this.O=!1;this.G=!0;a=a.binding;if(a=="console")this.u="";else if(a){var b=Tb("Panel",this.id);b&&(b=b.R[a])&&this.ea("",a,b)}this.C="";this.g=this.Pa=this.I=null;this.exports={connect:this.Hc,receiveData:this.Mb,receiveStatus:this.pe}}pa(cg,y);m=cg.prototype;
m.ea=function(a,b,c,d){var e=this;return a&&a!="textarea"?d?(this.R[b]=c,c.onclick=function(){e.Mb(d);return!0},!0):!1:(this.R[b]=this.i=c,c.onkeydown=function(f){f=f||n.event;var g=f.keyCode;if(g===8||f.ctrlKey&&g>=65&&g<=90)f.preventDefault&&f.preventDefault(),g>64&&(g-=64),dg(e,g);return!0},c.onkeypress=function(f){f=f||n.event;dg(e,f.which||f.keyCode);f.preventDefault&&f.preventDefault();return!0},c.removeAttribute("readonly"),!0)};
m.Ca=function(a,b,c,d){this.S=a;this.J=b;this.A=c;this.K=d;var e=this;this.Z=rd(this.A,this.id+".receive",function(){e.Mb()});this.aa=rd(this.A,this.id+".transmit",function(){pf(e)});this.X=nc(a,"ChipSet");Lc(b,this,eg,this.W);Oc(b,this,fg,this.W);$b(this)};
m.Hc=function(a){if(!this.g){var b=gd(this.S,"connection");if(b){var c=b.split("->");if(c.length==2){var d=Ya(c[0]);if(d!=this.Fb)return;c=Ya(c[1]);if(this.g=Sb(c)){var e=this.g.exports;if(e){var f=e.connect;f&&f.call(this.g,this.G);if(this.Pa=e.receiveData){this.G=a;this.I=e.receiveStatus;this.j(137438953472,"Connected %s.%s to %s\n",this.Qa,d,c);return}}}}this.j(137438953472,"Unable to establish connection: %s\n",b)}}};
m.va=function(a,b){if(!b)if(this.Hc(this.G),!a||!this.restore)this.reset();else if(!this.restore(a))return!1;return!0};m.ua=function(a){return a?this.save():!0};m.reset=function(){gg(this)};m.save=function(){var a=new Od(this),b=0,c=[];c[b++]=this.H;c[b++]=this.N;c[b++]=this.T;c[b++]=this.la;c[b++]=this.D;c[b++]=this.F;c[b]=this.L;a.set(0,c);return a.data()};m.restore=function(a){return gg(this,a[0])};
function gg(a,b){var c=0;b===void 0&&(b=hg);a.H=b[c++];a.N=b[c++];a.T=b[c++];a.la=b[c++];a.D=b[c++];a.F=b[c++];a.L=b[c];return!0}function ig(a,b){var c=a.L&b;b&15||(c>>=4);b=jg[c];c=((a.D&kg)>>2)+6;a.D&lg&&c++;c+=((a.D&mg)>>6)+1>>1;return 1E3/(b/c)|0}function dg(a,b){a.j("receiveByte(%#04x), status=%#04x\n",b,a.la);return a.O||a.la&ng?!1:(a.N=b,a.la|=ng,le(a.A,a.Y),!0)}
m.Mb=function(a){a!=null&&(this.C=typeof a!="number"?a:this.C+String.fromCharCode(a));this.C&&(dg(this,this.C.charCodeAt(0))&&(this.C=this.C.substr(1)),this.C&&this.A&&Cd(this.A,this.Z,ig(this,og)));return!0};m.pe=function(a){this.la&=~pg;a&64&&(this.la|=pg)};function pf(a,b){a.la|=ze|qg;b&&a.Pa&&a.Pa.call(a.g,b)}m.Hd=function(a,b){var c=this.N;B(this,a,void 0,b,"DATA",c);this.la&=~ng;return c};m.Gd=function(a,b){var c=this.la;B(this,a,void 0,b,"STATUS",c);return c};
m.Vd=function(a,b,c){B(this,a,b,c,"DATA");this.T=b;this.la&=~(ze|qg);this.j("transmitByte(%#04x)\n",b);if(b==19)this.O=!0;else if(b==17)this.O=!1;else if(this.Pa&&this.Pa.call(this.g,b),this.i)if(b==8)this.i.value=this.i.value.slice(0,-1),this.B>0&&this.B--;else{var d;b!=13&&b!=10&&(d=Za[b]);a=d=d?"<"+d+">":String.fromCharCode(b);c=a.length;b==9?(b=this.P||8,c=b-this.B%b,this.P&&(a=Wa("",-c))):b==13&&(this.B=c=0,a="\n");this.U&&!this.B&&c&&(a=String.fromCharCode(this.U)+a);this.i.value+=a;this.i.scrollTop=
this.i.scrollHeight;this.B+=c}else if(this.u!=null){if(b==10||this.u.length>=1024)this.print(this.u),this.u="";b!=10&&(this.u+=String.fromCharCode(b))}this.A&&Cd(this.A,this.aa,ig(this,rg))};m.Ud=function(a,b,c){B(this,a,b,c,"CONTROL");this.H?(this.I&&(b^this.F)&(sg|tg)&&(a=0,this.G?(a|=b&sg?32:0,a|=b&tg?320:0):(a|=b&sg?16:0,a|=b&tg?1048576:0),this.I.call(this.g,a)),this.F=b,this.F&ug&&(this.H=!1)):(this.D=b,this.H=!0)};m.Td=function(a,b,c){B(this,a,b,c,"BAUDRATES");this.L=b};
var kg=12,lg=16,mg=192,tg=2,sg=32,ug=64,ze=1,ng=2,qg=4,pg=128,og=15,rg=240,jg=[50,75,110,134.5,150,200,300,600,1200,1800,2E3,2400,3600,4800,9600,19200],hg=[!1,0,0,133,142,39,238],eg={0:cg.prototype.Hd,1:cg.prototype.Gd},fg={0:cg.prototype.Vd,1:cg.prototype.Ud,2:cg.prototype.Td};zb(function(){for(var a=Pb("pcx80","serial"),b=0;b<a.length;b++){var c=a[b],d=Qb(c);d=new cg(d);Ob(d,c)}});
function vg(a,b,c){y.call(this,a,b,c);this.B=+b.base||16;this.X=["{","}"];this.ga=["[","]"];this.U=this.aa=this.H=0;this.P=!1;this.g=-1;this.i=[];this.C={}}pa(vg,y);vg.prototype.Ib=function(){return-1};vg.prototype.Jb=function(){};
vg.prototype.yb=function(a,b,c){if(b)if(a){this.g<0&&this.i.length&&(this.g=0);if(this.g<0||a!=this.i[this.g])this.i.splice(0,0,a),this.g=0;this.g--}else this.P?a="end":a=this.i[this.g+1];b=[];if(a){a=a.replace(/""/g,"'");var d=0,e=null;c=c||";";for(var f=0;f<=a.length;f++){var g=a.charAt(f);if(g=='"'||g=="'")e?g==e&&(e=null):e=g;else if(g==c&&!e||!g)b.push(Ya(a.substring(d,f))),d=f+1}}return b};
function wg(a,b,c){var d=a;b=b||32;if(c)if(b==32)d=a>>>0;else if(b<32)d=a&(1<<b)-1;else{if(b=Math.pow(2,b),a<0||a>=b)d=a%b,d<0&&(d+=b)}else b<=32?d=a<<32-b>>32-b:(b=Math.pow(2,b-1),a>=b?(d=a%b,(a/b|0)&1&&(d-=b)):a<-b&&(d=a%b,((-a-1)/b|0)&1?d&&(d+=b):d||(d-=b)));a!=d&&(a=d);return a}
function xg(a,b,c){for(c=c===void 0?-1:c;c--&&b.length;){var d=b.pop();if(a.length<2)return!1;var e=a.pop();var f=a.pop();switch(d){case "*":f*=e;break;case "/":if(!e)return!1;f=Math.trunc(f/e);break;case "^/":if(!e)return!1;f%=e;break;case "+":f+=e;break;case "-":f-=e;break;case "<<":f<<=e;break;case ">>":f>>=e;break;case ">>>":f>>>=e;break;case "<":f=f<e?1:0;break;case "<=":f=f<=e?1:0;break;case ">":f=f>e?1:0;break;case ">=":f=f>=e?1:0;break;case "==":f=f==e?1:0;break;case "!=":f=f!=e?1:0;break;
case "&":f&=e;break;case "!":case "|":f|=e;break;case "^!":f^=e;break;case "&&":f=f&&e?1:0;break;case "||":f=f||e?1:0;break;case ",,":f=wg(f,18,!0)*262144+wg(e,18,!0);break;case "^_":d=="^_"&&(e=35-(e&255));e&&(f=wg(f,0,!0),f=e>0?f*Math.pow(2,e):Math.trunc(f/Math.pow(2,-e)));break;default:return!1}a.push(wg(f))}return!0}
function yg(a,b,c,d,e,f){var g,h=!1,k=0,l=[],r=[],u=a.B;for(a.B=e;c<d;){var q=b[c++].trim();var p=c<d?b[c++]:"";if(q)var A=zg(a,q,void 0,f,k);else if(p=="{"){q=1;for(A=c;c<d;)if(c++,p=c<b.length?b[c++]:"",p=="{")q++;else if(p=="}"&&!--q)break;A=yg(a,b,A,c-1,a.B,f);A!=null&&k&&(A=Ag(A,k));q=c<d?b[c++].trim():"";p=c<d?b[c++]:""}else{if(p==" ")continue;if(p=="^B"){a.B=2;continue}if(p=="^O"){a.B=8;continue}if(p=="^D"){a.B=10;continue}if(!(k&-1073741824)){if(p=="+")continue;if(p=="-"){k=k<<2|1;continue}if(p==
"~"||p=="^-"){k=k<<2|2;continue}if(p=="^L"){k=k<<2|3;continue}}h=!0;break}if(A===void 0)if(f)f.push(q),A=0;else{h=!0;f=[];break}l.push(wg(A));if(p==" ")if(c<b.length-1&&!b[c])c++,p=b[c++];else{h=!0;break}if(!p)break;k=a.X[0]=="<"?Bg:Cg;if(!k[p]){h=!0;break}r.length&&k[p]<=k[r[r.length-1]]&&xg(l,r,1);r.push(p);a.B=p=="^_"?10:e;k=0}if(h||!xg(l,r)||l.length!=1)h=!0;h?f||a.j("parse error (%s)\n",q||p):g=l.pop();a.B=u;return g}
function Dg(a,b,c,d,e){for(var f;(f=b.indexOf(c))>=0;){for(var g=0,h=f+1,k=e;h<b.length;){var l=b[h++];if(l==c){k=-1;break}if(!k)break;k--;l=l.charCodeAt(0);d==7?l&=127:l=l-32&63;g=wg(g*Math.pow(2,d)+l,d*e,!0)}if(k>=0){a.j("parse error (%s%s%s)\n",c,b,c);return}b=b.substr(0,f)+Eg(a,g,-1)+b.substr(h)}return b}
function Fg(a,b,c){var d=void 0,e=c===!1;c=Array.isArray(c)?c:void 0;if(b){a.X[0]!="{"&&(b=b.split(a.X[0]).join("{").split(a.X[1]).join("}"));b=Dg(a,b,'"',7,5);if(!b)return d;b=Dg(a,b,"'",6,6);if(!b)return d;a.B!=16&&(b=b.replace(/(^|[^A-Z0-9$%.])([0-9]+)B/,"$1$2^_").replace(/\s+/g," "));b=b.split(/({|}|\|\||&&|\||\^!|\^B|\^O|\^D|\^L|\^-|~|\^_|&|!=|!|==|>=|>>>|>>|>|<=|<<|<|-|\+|\^\/|\/|\*|,,| )/);d=yg(a,b,0,b.length,a.B,c);d!==void 0&&e&&Gg(a,null,d)}return d}
function Hg(a,b){var c,d=a.X[0],e=a.X[1],f=d=="("||d=="{"||d=="["?"\\":"",g=d=="["?"\\":"";for(f=new RegExp(f+d+"([^"+g+d+g+e+"]+)"+f+e);c=b.match(f);){g=Fg(a,c[1]);if(g===void 0)return;c=d+c[1]+e;g=g!=null?Eg(a,g):"undefined";b=b.replace(c,g)}if(a.ga.length)for(d=a.ga[0],e=a.ga[1],f=d=="("||d=="{"||d=="["?"\\":"",g=d=="["?"\\":"",f=new RegExp(f+d+"([^"+g+d+g+e+"]+)"+f+e);c=b.match(f);)b=b.replace("["+c[1]+"]","unimplemented");for(;d=b.match(/\$([a-z]+)/i);){e=null;switch(d[1].toLowerCase()){case "ops":e=
a.U-a.aa}if(e==null)break;b=b.replace(d[0],e.toString())}return b}function Ag(a,b){for(;b;){var c;switch(b&3){case 1:a=-wg(a);break;case 2:a^=-1;break;case 3:for(c=35;c>=0&&!(a&Math.pow(2,c));)c--;a=35-c}b>>>=2}return a}
function zg(a,b,c,d,e){e=e===void 0?0:e;var f=Array.isArray(d)?d:void 0;if(b!=void 0){var g=a.Ib(b);if(g>=0)g=a.Jb(g);else if(g=b,a.C[g]?g=a.C[g].value:(g=g.substr(0,6),g=a.C[g]&&a.C[g].value),g!=void 0){var h=a.C[b]&&a.C[b].qe;h&&(f?f.push(h):(f=Fg(a,h,d),f!==void 0?g+=f:(d||a.j("undefined %s: %s (%s)\n",c||"value",b,h),g=void 0)))}else g=Ma(b,b.length>1||a.B>10?a.B:10);g!=void 0?g=wg(Ag(g,e)):d||a.j("invalid %s: %s\n",c||"value",b)}else d||a.j("missing %s\n",c||"value");return g}
function Gg(a,b,c){var d=!1;if(c!==void 0){d=!0;var e=a.B==8?Eg(a,c,32,8,1)+"  "+c+".":Eg(a,c,32,16,1)+"  "+Eg(a,c,32,8,1)+"  "+Eg(a,c,32,2,8)+"  "+c+".";c>=32&&c<127&&(e+=" '"+String.fromCharCode(c)+"'")}a.j("%s%s\n",b!=null?b+": ":"",e);return d}function Ig(a,b){var c=0;if(a.C){if(b)return Gg(a,b,a.C[b]&&a.C[b].value);b=Object.keys(a.C);b.sort();for(var d=0;d<b.length;d++)Gg(a,b[d],a.C[b[d]].value),c++}return c>0}
function Eg(a,b,c,d,e){c=c===void 0?0:c;e=e===void 0?0:e;switch((d===void 0?0:d)||a.B){case 2:(a=c>0?c:0)?a>36&&(a=36):(a=Math.abs(b),a=a<=255?8:a<=262143?18:36);b=Na(b,2,a,"",e);break;case 8:(a=c>0?(c+2)/3|0:0)?a>12&&(a=12):(a=Math.abs(b),a=a<=262143?6:a<=16777215?8:12);b=Na(b,8,a,e?"0o":"");break;case 10:(e=c>0?Math.ceil(c*.3):0)?e>11&&(e=11):e=Math.abs(b)<=99999?5:11;b=Na(b,10,e);break;default:b=w(b,c>0?c+3>>2:0,!!e)}return c=c<0?b.replace(/^0+([0-9A-F]+)$/i,"$1"):b}
var Cg={"||":5,"&&":6,"!":7,"|":7,"^!":8,"&":9,"!=":10,"==":10,">=":11,">":11,"<=":11,"<":11,">>>":12,">>":12,"<<":12,"-":13,"+":13,"^/":14,"/":14,"*":14,"^_":19,"{":20,"}":20},Bg={",,":1,"||":5,"&&":6,"!=":10,"==":10,">=":11,">":11,"<=":11,"<":11,">>>":12,">>":12,"<<":12,"-":13,"+":13,"^/":14,"/":14,"*":14,"!":15,"|":15,"^!":15,"&":15,"^_":19,"{":20,"}":20};
function Jg(a){vg.call(this,"Debugger",a,-1);this.style=Kg;this.N=Lg();this.pa=Lg();this.V=Lg();this.F=[];this.u=this.O=this.D=[];ph(this);this.Y=0;rh(this);this.ia={};sh(this,a.messages);this.ka=a.commands;var b=this;n.pcx80===void 0&&(n.pcx80=function(c){return th(b,c)})}pa(Jg,vg);m=Jg.prototype;
m.Ca=function(a,b,c,d){this.J=b;this.A=c;this.S=a;(a=gd(a,"messages"))&&sh(this,a);this.na=uh;ve(this,4,function(e){a:{var f=d.J.g,g=e[0],h=e=0,k=f.length;if(g){e=vh(wh(d,g));if(e===-1){d.j("invalid address: %s\n",g);break a}h=e>>>d.J.i;k=1}d.j("blockid   physical   blockaddr   used    size    type\n");d.j("--------  ---------  ----------  ------  ------  ----\n");g=-1;for(var l=0;k--;){var r=f[h];r.type==g?l++||d.j("...\n"):(g=r.type,l=vc[g],r&&d.j("%x  %%%x  %%%%%x  %#06x  %#06x  %s\n",r.id,h<<
d.J.i,r.M,r.mb,r.size,l),g!=Uc&&(g=-1),l=0);e+=d.J.B;h++}}});$b(this)};
m.ea=function(a,b,c){var d=this;switch(b){case "debugInput":return this.L=this.R[b]=c,c.onkeydown=function(e){if(e.keyCode==13){var f=d.L.value;d.L.value="";th(d,f,!0)}else if(e.keyCode==27)d.L.value=f="";else if(e.keyCode==38?(f=null,d.g<d.i.length-1&&(f=d.i[++d.g])):e.keyCode==40&&(d.g>0?f=d.i[--d.g]:(f="",d.g=-1)),f!=null){var g=f.length;d.L.value=f;d.L.setSelectionRange(g,g)}f!=null&&e.preventDefault&&e.preventDefault()},!0;case "debugEnter":return this.R[b]=c,xb(c,function(){if(d.L){var e=d.L.value;
d.L.value="";th(d,e,!0);return!0}d.j(2267742732288,"no debugger input buffer\n");return!1}),!0;case "step":return this.R[b]=c,xb(c,function(e){var f=!1;ac(d,!0)||(hc(d,!0),f=xh(d,e?1:0),hc(d,!1));return f}),!0}return!1};m.Ya=function(){this.L&&this.L.focus()};function vh(a){a=a&&a.M;a==null&&(a=-1);return a}m.Da=function(a,b){var c=255,d=vh(a);d!==-1&&(c=xc(this.J,d),b&&yh(a,b));return c};m.Cb=function(a,b){var c=65535,d=vh(a);d!==-1&&(c=zc(this.J,d),b&&yh(a,b));return c};
m.ac=function(a,b,c){var d=vh(a);d!==-1&&(Jc(this.J,d,b),c&&yh(a,c),jd(this.A,!0))};m.$c=function(a,b,c){var d=vh(a);if(d!==-1){var e=this.J,f=d&e.u,g=(d&e.F)>>>e.i;f!=e.u?e.g[g].Qb(f,b&65535,d):(e.g[g++].nb(f,b&255,d),e.g[g&e.I].nb(0,b>>8&255,d+1));c&&yh(a,c);jd(this.A,!0)}};function Lg(a){return{M:a,Aa:!1}}function zh(a){return{M:a[0],Aa:a[1]}}
function wh(a,b,c){c=(c?a.N:a.pa).M;if(b!==void 0){b=Hg(a,b)||b;var d;if(b.match(/^[a-z_][a-z0-9_]*$/i)){var e=b.toUpperCase();for(c=0;c<a.F.length;c++){var f=a.F[c].sa[e];if(f!==void 0){e=f.o;e!==void 0&&(d=Lg(e));break}}}if(e=d)return e;c=Fg(a,b)}c!=null&&(e=Lg(c));return e}function Ah(a,b,c){c&&(c=c.match(/(['"])(.*?)\1/))&&(b.vd=a.yb(b.Lc=c[2]))}function yh(a,b){a.M!=null&&(a.M+=b||1)}function Bh(a){return w(a.M,4)}
function Ch(a,b,c){var d="";for(c=c||256;d.length<c;){var e=a.Da(b,1);if(!e||e==36||e>=127)break;d+=e>=32?String.fromCharCode(e):"."}return d}function sh(a,b){a.K=a;a.ja=549755813888;a.Z=null;a.fa=[];b=a.yb(b.replace("keys","key").replace("kbd","keyboard"),!1,",");if(b.length)for(var c in t)bb(b,c)>=0&&(a.ja|=t[c],a.j("%s messages enabled\n",c))}function ve(a,b,c){for(var d in t)if(b==t[d]){a.ia[d]=c;break}}
m.Ib=function(a,b){a=a.toUpperCase();if(b==null)var c=bb(Dh,a);else c=bb(Dh,a.substr(b,2)),c<0&&(c=bb(Dh,a.substr(b,1)));return c};function Eh(a,b){var c=0;a=a.Jb(b);if(a!==void 0)switch(b){case Fh:case Gh:case Hh:case Ih:case Jh:case Kh:case Lh:case Mh:c=2;break;case Nh:case Oh:case Ph:case Qh:case Rh:case Sh:case Th:c=4}return c?w(a,c):"??"}
m.Jb=function(a){if(a>=0){var b=this.A;switch(a){case Fh:var c=b.i;break;case Gh:c=b.B;break;case Hh:c=b.C;break;case Nh:c=Pd(b);break;case Ih:c=b.D;break;case Jh:c=b.F;break;case Oh:c=Rd(b);break;case Kh:c=b.G;break;case Lh:c=b.H;break;case Ph:c=D(b);break;case Mh:c=H(b,D(b));break;case Qh:c=b.N;break;case Rh:c=b.u;break;case Sh:c=Nd(b);break;case Th:c=Nd(b)&255|b.i<<8}}return c};
m.message=function(a,b){b&1&&this.A&&(a=a.replace(/(\n?)$/," @"+Bh(Lg(this.A.u))));this.ja&0x800000000000?this.fa.push(a):this.Z&&a==this.Z||(this.Z=a,this.ja&70368744177664&&(a=a.replace(/(\n?)$/," (cpu halted)$1"),dd(this)),this.print(a,b),this.A&&(a=this.A,Dd(a),a.qa=0,jd(a)))};function kc(a,b,c,d,e,f,g,h){h|=16;f!=null&&(a.ja&h)!=h||a.j("%s.%s(%#06x,%s=%#04x): %#04x @%#06x\n",b.Fb,d!=null?"outPort":"inPort",c,f||"unknown",d,g,e)}
m.init=function(){this.j("Type ? for help with PCx80 Debugger commands\n");Uh(this);if(this.ka){var a=this.ka;this.ka=null;th(this,a)}};function rh(a){var b;if(ne(a)){if(!a.I||!a.I.length){a.I=Array(Vh);for(b=0;b<a.I.length;b++)a.I[b]=Lg();a.W=0;a.j("instruction history buffer allocated\n")}if(!a.G||!a.G.length)for(a.G=Array(256),b=0;b<a.G.length;b++)a.G[b]=[b,0]}else a.I&&a.I.length&&a.j("instruction history buffer freed\n"),a.W=0,a.I=[],a.G=[]}
function Wh(a,b){if(!Xh(a))return!1;a.A.rb(b);return!0}function xh(a,b,c,d){if(!Xh(a))return!1;a.H=0;b||ne(a)&&oe(a,a.A.u,0);try{var e=a.A.Bb(b);e>0&&(a.H+=e,od(a.A,e,!0),kd(a.A,e),a.U++)}catch(f){typeof f!="number"&&(b=f,a.H=0,Yb(a.A,b.stack||b.message))}d!==!1&&jd(a.A);Uh(a,c||!1);return a.H>0}function dd(a,b){a.A&&md(a.A,b)}function Uh(a,b){b===void 0&&(b=!0);a.N=Lg(a.A.u);b&&a.T!=1?Yh(a):Zh(a)}
function Xh(a){var b;if(b=a.A&&Zb(a.A))b=a.A,b.flags.ca?b=!0:(b.j("%s not powered\n",b.toString()),b=!1);b&&!ac(a.A)?(a=a.A,a.flags.error?(a.print(a.toString()+" error\n"),a=!0):a=!1,a=!a):a=!1;return a}m.va=function(a,b){return!b&&(this.reset(!0),a&&this.restore&&!this.restore(a))?!1:!0};m.ua=function(a,b){b&&this.j("%s\n",a?"suspending":"shutting down");return a?this.save():!0};m.reset=function(a){rh(this);this.U=this.aa=0;this.Z=null;this.H=0;this.N=Lg(this.A.u);this.flags.ma=!1;$h(this);a||Uh(this)};
m.save=function(){var a=new Od(this),b=this.N;a.set(0,[b.M,b.Aa]);b=this.V;a.set(1,[b.M,b.Aa]);a.set(2,[this.i,this.P,this.ja]);a.set(3,this.F);return a.data()};m.restore=function(a){var b=0;a[2]!==void 0&&(this.N=zh(a[b++]),this.V=zh(a[b++]),this.i=a[b][0],typeof this.i=="string"&&(this.i=[this.i]),this.P=a[b][1],this.ja|=a[b][2]);a[3]&&(this.F=a[3]);return!0};m.start=function(a,b){this.T||this.j("running\n");this.flags.ma=!0;this.ta=a;this.xa=b};
m.stop=function(a,b){if(this.flags.ma){this.flags.ma=!1;this.H=b-this.xa;if(!this.T){b="stopped";if(this.H){a-=this.ta;var c=a>0?Math.round(this.H*1E3/a):0;b+=" (";ne(this)&&(b+=this.U+" opcodes, ",this.aa-=this.U,this.U=0);b+=this.H+" cycles, "+a+" ms, "+c+" hz)"}else jc(this,70368744177664)&&(b+=" (use the 't' command to execute blocked faults)");this.j("%s\n",b)}Uh(this,!0);this.Ya();$h(this,this.A.u)}};function ne(a){return a.u.length>1||!!a.Y}
function oe(a,b,c){var d=a.A;if(c>0&&(a.Y&&!--a.Y||cd(a,b,1,a.u)))return!0;c>=0&&a.G.length&&(a.U++,b=xc(a.J,b),b!=null&&(a.G[b][1]++,b=a.I[a.W],b.M=d.u,b.Aa=!1,++a.W==a.I.length&&(a.W=0)));return!1}function Nc(a,b,c){a.j("break on input from port %#06x: %x\n",b,c);dd(a,!0)}function Qc(a,b,c){a.j("break on output to port %#06x: %x\n",b,c);dd(a,!0)}
function ph(a){var b;a.u=["bp"];if(a.O!==void 0)for(b=1;b<a.O.length;b++){var c=a.O[b];var d=a.J;bd(d.g[vh(c)>>>d.i],!1)}a.O=["br"];if(a.D!==void 0)for(b=1;b<a.D.length;b++)c=a.D[b],d=a.J,bd(d.g[vh(c)>>>d.i],!0);a.D=["bw"];a.qa=0}m.Na=function(a,b,c){var d=!0;c||ai(this,a,b,!1,!0);if(a!=this.u){var e=vh(b);if(e===-1)this.j("invalid address: %s\n",Bh(b)),d=!1;else{var f=this.J;f.g[e>>>f.i].Na(e&f.u,a==this.D)}}d&&(a.push(b),c?b.Aa=!0:(bi(this,a,a.length-1,"set"),rh(this)))};
function ai(a,b,c,d,e){var f=!1;c=vh(c);for(var g=1;g<b.length;g++){var h=b[g];if(c==vh(h)&&(!d||h.Aa)){f=!0;h.Aa||e||bi(a,b,g,"cleared");b.splice(g,1);b!=a.u&&(d=a.J,bd(d.g[c>>>d.i],b==a.D));h.Aa||rh(a);break}}return f}function ci(a,b){for(var c=1;c<b.length;c++)bi(a,b,c);return b.length-1}function bi(a,b,c,d){c=b[c];a.j("%s %s%s\n",b[0],Bh(c),d?" "+d:c.Lc?' "'+c.Lc+'"':"")}
function $h(a,b){if(b!==void 0)cd(a,b,1,a.u,!0),a.T=0;else for(b=1;b<a.u.length;b++){var c=a.u[b];if(c.Aa){if(!ai(a,a.u,c,!0))break;b=0}}}
function cd(a,b,c,d,e){var f=!1;if(!a.qa++)for(var g=1;!f&&g<d.length;g++){var h=d[g];if(!e||h.Aa)for(var k=vh(h),l=0;l<c;l++)if(b+l==k){var r;f=!0;h.Aa&&(ai(a,d,h,!0),e=!0);if(r=h.vd){f=!1;for(var u=0;u<r.length;u++)if(!di(a,r[u],!0)){if(r[u].indexOf("if")){f=!0;break}for(var q=u+1;q<r.length&&r[q].indexOf("else");q++)u++;if(q==r.length){f=!0;break}}a.A.flags.ma||(f=!0)}if(f){e||bi(a,d,g,"hit");break}}}a.qa--;return f}
function ei(a,b,c,d){for(var e=Lg(b.M),f=a.Da(b,1),g=a.na[f],h="",k=(a.style!=fi?gi:hi)[g[0]],l=g.length-1,r=ii,u,q=1;q<=l;q++){var p="";u=g[q];if(u!==void 0&&!(u&P&&a.style==Kg)){var A=u&ji;if(A){var E=u&ki;E?r=E:u|=r;u&li||(u|=q==1?mi:ni);if(A&Q)a:{p=a;A=u;E=b;switch(A&ki){case oi:E=w(p.Da(E,1),2);break;case pi:E=w(p.Da(E,1)<<24>>24,4);break;case qi:E=w(p.Cb(E,2),4);break;default:p="imm("+w(A,4,!0)+")";break a}p.style==fi&&A&ri?E="["+E+"]":A&si||(E=(p.style==Kg?"$":"0x")+E);p=E}else A&si?(p=(u&
ti)>>8,A=Dh[p],a.style==fi&&u&ri&&(p==Mh&&(A="HL"),A="["+A+"]"),p=A):A&ui&&(p=(f>>3&7).toString());if(!p||!p.length){h="INVALID";break}h.length>0&&(h+=",");h+=p||"???"}}}f="";g=Bh(e)+" ";if(e.M!==-1&&b.M!==-1){do if(f+=w(a.Da(e,1),2),e.M==null)break;while(e.M!=b.M)}g+=Wa(f,-10);g+=u&vi?"*":" ";g+=Wa(k,-7);h&&(g+=" "+h);c&&(g=Wa(g,-40)+";"+c,g=a.A.flags.Wa?g+("cycles="+ld(a.A).toString()+" cs="+w(a.A.ra)):g+(d!=null?"="+d.toString():""));return g}
function wi(a,b){switch(b){case "IF":a=a.A.O&512;break;case "SF":a=Zd(a.A);break;case "ZF":a=Yd(a.A);break;case "AF":a=Xd(a.A);break;case "PF":a=Wd(a.A);break;case "CF":a=Ud(a.A);break;default:a=0}return b.charAt(0)+(a?"1":"0")+" "}function xi(a,b){return Dh[b]+"="+Eh(a,b)+" "}m.Cc=function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0};
function yi(a,b,c){var d=[],e=vh(b)>>>0;for(b=0;b<a.F.length;b++){var f=a.F[b],g=f.M>>>0,h=f.Qd;if(e>=g&&e<g+h){e=ab(f.Ac,[e-g],a.Cc);e>=0?zi(a,b,e,d):c&&(e=~e,zi(a,b,e-1,d),zi(a,b,e,d));break}}return d}function zi(a,b,c,d){var e={},f=a.F[b].Ac,g=0,h=null;c>=0&&c<f.length&&(g=f[c][0],h=f[c][1]);h&&(e=a.F[b].sa[h],h=h.charAt(0)=="."?null:e.l||h);d.push(h);d.push(g);d.push(e.a);d.push(e.c)}
function Ai(a,b){if(b=="?")a.j("frequency commands:\n"),a.j("\tclear\tclear all frequency counts\n");else{var c=0;if(a.G)if(b=="clear"){for(b=0;b<a.G.length;b++)a.G[b]=[b,0];a.j("frequency data cleared\n");c++}else if(b!==void 0)a.j("unknown frequency command: %s\n",b),c++;else{b=a.G.slice();b.sort(function(h,k){return k[1]-h[1]});for(var d=a.style!=fi?gi:hi,e=0;e<b.length;e++){var f=b[e][0],g=b[e][1];g&&(a.j("%s (%#04x): %d times\n",(d[a.na[f][0]]+"  ").substr(0,5),f,g),c++)}}c||a.j("no frequency data available\n")}}
function Bi(a,b){var c=b.match(/^\s*([A-Z_]?[A-Z0-9_]*)\s*(=?)\s*(.*)$/i);if(c){if(!c[1])return Ig(a)||a.j("no variables\n"),!0;if(!c[2])return Ig(a,c[1]);if(!c[3])return delete a.C[c[1]],!0;b=Fg(a,c[3]);return b!==void 0?(a.C[c[1]]={value:b,qe:void 0},!0):!1}a.j("invalid assignment: %s\n",b);return!1}
function Ci(a,b,c){var d=null;if(b=wh(a,b,!0)){var e=yi(a,b,!0);if(e.length){var f;if(e[0]){var g="";(f=b.M-e[1])&&(g=" + "+w(f,4,!0));f=e[0]+" ("+w(e[1],4)+")"+g;c&&a.j("%s\n",f);d=f}e.length>4&&e[4]&&(g="",(f=e[5]-b.M)&&(g=" - "+w(f,4,!0)),f=e[4]+" ("+w(e[5],4)+")"+g,c&&a.j("%s\n",f),d||(d=f))}else c&&a.j("no symbols\n")}return d}
function Di(a,b){switch(b[1]){case "8080":a.style=Kg;break;case "8086":a.style=fi;break;case "cs":var c;b[3]!==void 0&&(c=+b[3]);switch(b[2]){case "int":a.A.ka=c;break;case "start":a.A.ta=c;break;case "stop":a.A.pa=c;break;default:a.j("unknown cs option\n");return}c!==void 0&&id(a.A);a.j("checksums %s\n",a.A.flags.Wa?"enabled":"disabled");return;case "sp":b[2]!==void 0&&(nd(a.A,+b[2])||a.j("warning: using 1x multiplier, previous target not reached\n"));a.j("target speed: %s (%dx)\n",a.A.aa.toFixed(2)+
"Mhz",a.A.U);return;case "?":a.j("debugger options:\n");a.j("\tX80\t\tselect 8080-style mnemonics\n");a.j("\t8086\t\tselect 8086-style mnemonics\n");a.j("\tcs int #\tset checksum cycle interval to #\n");a.j("\tcs start #\tset checksum cycle start count to #\n");a.j("\tcs stop #\tset checksum cycle stop count to #\n");a.j("\tsp #\t\tset speed multiplier to #\n");break;default:if(b[1]){a.j("unknown option: %s\n",b[1]);return}}a.j("%s-style mnemonics enabled\n",a.style)}
function Yh(a,b){var c;if(b&&b[1]=="?")a.j("register commands:\n"),a.j("\tr\tdump registers\n"),a.j("\trx [#]\tset flag or register x to [#]\n");else{var d=a.A;c==null&&(c=!0);if(b!=null&&b.length>1){var e=b[1],f=e.indexOf("=");if(f>0)b=e.substr(f+1),e=e.substr(0,f);else if(b.length>2)b=b[2];else{a.j("missing value for %s\n",b[1]);return}f=Fg(a,b);if(f===void 0)return;switch(e.toUpperCase()){case "A":d.i=f&255;break;case "B":d.B=f&255;break;case "BC":d.B=f>>8&255;case "C":d.C=f&255;break;case "D":d.D=
f&255;break;case "DE":d.D=f>>8&255;case "E":d.F=f&255;break;case "H":d.G=f&255;break;case "HL":d.G=f>>8&255;case "L":d.H=f&255;break;case "SP":d.N=f&65535;break;case "PC":C(d,f);a.N=Lg(d.u);break;case "PS":Ld(d,f);break;case "PSW":Ld(d,f&255|d.O&-256);d.i=f>>8;break;case "CF":d.I=f?d.I|256:d.I&255;break;case "PF":f?Wd(d)||(d.L^=1):Wd(d)&&(d.L^=1);break;case "AF":d.P=f?~d.L&16|d.P&-17:d.L&16|d.P&-17;break;case "ZF":d.I=f?d.I&-256:d.I|255;break;case "SF":f?Zd(d)||(d.L^=192):Zd(d)&&(d.L^=192);break;
case "IF":d.O=f?d.O|512:d.O&-513;break;default:a.j("unknown register: %s\n",e);return}jd(d);a.j("updated registers:\n")}e=a.j;f=xi(a,Fh)+xi(a,Nh)+xi(a,Oh)+xi(a,Ph)+xi(a,Qh)+wi(a,"IF")+wi(a,"SF")+wi(a,"ZF")+wi(a,"AF")+wi(a,"PF")+wi(a,"CF");e.call(a,"%s\n",f);c&&(a.N=Lg(d.u),Zh(a,Bh(a.N)))}}
function Ei(a,b){b=Ya(b);var c=b.match(/^(['"])(.*?)\1$/);if(c){b=a.j;c=c[2];c=Hg(a,c)||c;for(var d=0,e,f;(d=c.indexOf("@",d))>=0;)f=a.Ib(c,d+1),f>=0&&(c=c.substr(0,d)+Eh(a,f)+c.substr(d+1+Dh[f].length)),d++;for(d=0;(d=c.indexOf("#",d))>=0;)f=c.substr(d+1,2),e=Ma(f,16),e!=null&&e>=32&&e<127?(e=f+" '"+String.fromCharCode(e)+"'",c=c.replace("#"+f,e),d+=e.length):d++;for(d=0;(d=c.indexOf("$",d))>=0;)f=c.substr(d+1,9),(e=wh(a,f))?(e=f+' "'+Ch(a,e)+'"',c=c.replace("$"+f,e),d+=e.length):d++;for(d=0;(d=
c.indexOf("^",d))>=0;)f=c.substr(d+1,9),(e=wh(a,f))?(yh(e),e=f+' "'+Ch(a,e,11)+'"',c=c.replace("^"+f,e),d+=e.length):d++;b.call(a,"%s\n",c)}else Fg(a,b,!1)}function Fi(a,b,c){var d=b!="t";c=zg(a,c,void 0,!0)||1;var e=c==1?0:1;b=="tc"&&(e=c,c=1);wb(c,function(){return hc(a,!0)&&xh(a,e,d,!1)},function(){jd(a.A);hc(a,!1)})}
function Zh(a,b,c,d){if(b=wh(a,b,!0)){d===void 0&&(d=1);var e=256;if(c!==void 0){d=wh(a,c,!0);if(!d||d.M<b.M)return;e=d.M-b.M;if(e>256){a.j("range too large\n");return}d=-1}c=0;for(var f;e>0&&d--;){f=ac(a,!1)||a.T?a.H:null;var g=f!=null?"cycles":null,h=yi(a,b),k=b.M;if(h[0]&&d&&(!c&&d||h[0].indexOf("+")<0)){var l=h[0]+":";h[2]&&(l+=" "+h[2]);a.j("%s\n",l)}h[3]&&(g=h[3],f=null);f=ei(a,b,g,f);a.j("%s\n",f);a.N=b;e-=b.M-k;c++}}}
m.yb=function(a,b,c){if(b)if(a){this.g<0&&this.i.length&&(this.g=0);if(this.g<0||a!=this.i[this.g])this.i.splice(0,0,a),this.g=0;this.g--}else this.P?a="end":a=this.i[this.g+1];b=[];if(a){a=a.toLowerCase().replace(/""/g,"'");var d=0,e=null;c=c||";";for(var f=0;f<=a.length;f++){var g=a.charAt(f);if(g=='"'||g=="'")e?g==e&&(e=null):e=g;else if(g==c&&!e||!g)b.push(Ya(a.substring(d,f))),d=f+1}}return b};
function di(a,b,c){var d=!0;try{b.length&&b!="end"?c||a.j("%s%s\n",">> ",b):(a.P&&(a.j("ended assemble at %s\n",Bh(a.V)),a.N=a.V,a.P=!1),b="");var e=b.charAt(0);if(e=='"'||e=="'")return!0;a.Z=null;if(Zb(a)&&b.length>0){a.P&&(b="a "+Bh(a.V)+" "+b);var f=b.replace(/ +/g," ").split(" ");if(f&&f.length)for(var g=f[0],h=g.charAt(0),k=1;k<g.length;k++){var l=g.charAt(k);if(h=="?"||h=="r"||l<"a"||l>"z"){f[0]=g.substr(k);f.unshift(g.substr(0,k));break}}switch(f[0].charAt(0)){case "a":var r=wh(a,f[1],!0);
if(r)if(a.V=r,f[2]===void 0)a.j("begin assemble at %s\n",Bh(r)),a.P=!0,jd(a.A);else{a.j("not supported yet\n");var u=[];if(u.length){for(var q=0;q<u.length;q++)a.ac(r,u[q],1);a.j("%s\n",ei(a,a.V))}}break;case "b":a:{var p=f[0],A=f[1],E=b;if(A=="?")a.j("breakpoint commands:\n"),a.j("\tbi [p]\ttoggle break on input port [p]\n"),a.j("\tbo [p]\ttoggle break on output port [p]\n"),a.j("\tbp [a]\tset exec breakpoint at addr [a]\n"),a.j("\tbr [a]\tset read breakpoint at addr [a]\n"),a.j("\tbw [a]\tset write breakpoint at addr [a]\n"),
a.j("\tbc [a]\tclear breakpoint at addr [a]\n"),a.j("\tbl\tlist all breakpoints\n"),a.j("\tbn [n]\tbreak after [n] instruction(s)\n");else{var F=p.charAt(1);if(F=="l"){var G=ci(a,a.u);G+=ci(a,a.O);(G+=ci(a,a.D))||a.j("no breakpoints\n")}else if(F=="n")a.Y=zg(a,A),a.j("break after %d instruction(s)\n",a.Y);else if(A===void 0)a.j("missing breakpoint address\n");else{var z=Lg();if(A!="*"&&(z=wh(a,A,!0),!z))break a;A=w(z.M,4,!0);if(F=="c")z.M==null?(ph(a),a.j("all breakpoints cleared\n")):ai(a,a.u,z)||
ai(a,a.O,z)||ai(a,a.D,z)||a.j("breakpoint missing: %s\n",Bh(z));else if(F=="i"){var fa=a.j;var Y=a.J,ha=z.M;if(ha===void 0){Y.G=!Y.G;var ma=Y.G}else Y.C[ha]===void 0&&(Y.C[ha]=[null,!1]),Y.C[ha][1]=!Y.C[ha][1],ma=Y.C[ha][1];fa.call(a,"breakpoint %s: port %s (input)\n",ma?"enabled":"cleared",A)}else if(F=="o"){var Qa=a.j;var ia=a.J,bc=z.M;if(bc===void 0){ia.H=!ia.H;var Mg=ia.H}else ia.D[bc]===void 0&&(ia.D[bc]=[null,!1]),ia.D[bc][1]=!ia.D[bc][1],Mg=ia.D[bc][1];Qa.call(a,"breakpoint %s: port %s (output)\n",
Mg?"enabled":"cleared",A)}else z.M!=null&&(Ah(a,z,E),F=="p"?a.Na(a.u,z):F=="r"?a.Na(a.O,z):F=="w"?a.Na(a.D,z):a.j("unknown breakpoint command: %s\n",F))}}}break;case "c":var Ng=a.S;Ng.D&&(Ng.D.value="");break;case "d":a:{var cc,dc=f[0],db=f[1],Eb=f[2],ij=f[3];if(db=="?"){var ec="";for(cc in t)a.ia[cc]&&(ec&&(ec+=","),ec+=cc);ec+=",state,symbols";a.j("dump memory commands:\n");a.j("\tdb [a] [#]    dump # bytes at address a\n");a.j("\tdw [a] [#]    dump # words at address a\n");a.j("\tdd [a] [#]    dump # dwords at address a\n");
a.j("\tdh [#] [#]    dump # instructions from history\n");ec.length&&a.j("dump extension commands:\n\t%s\n",ec)}else if(db=="state"){var Ae=Gi(a.S,!0);if(Eb=="console")console.log(Ae);else{var Og=a.S;Og.D&&(Og.D.value="");Ae&&a.j("%s\n",Ae)}}else if(db=="symbols")for(var Be=0;Be<a.F.length;Be++){var Ce=a.F[Be],fc;for(fc in Ce.sa)if(fc.charAt(0)!="."){var Pg=Ce.sa[fc].o;if(Pg!==void 0){var Qg=Ce.sa[fc].l;Qg&&(fc=Qg);a.j("%s %s\n",w(Pg,4),fc)}}}else{if(dc=="d"){for(cc in t)if(f[1]==cc){var Rg=a.ia[cc];
Rg?(f.shift(),f.shift(),Rg(f)):a.j("no dump registered for %s\n",db);break a}db||(dc=a.Ba||"db")}else a.Ba=dc;if(dc=="dh"){var Sg=db,Tg=Eb,Ug="",Vg=0,Ra=a.W,eb=a.I;if(eb.length){var Fa=+Sg||a.ra,Ac=+Tg||10;isNaN(Fa)?Fa=Ac:Ug="more ";Fa>eb.length&&(a.j("note: only %d available\n",eb.length),Fa=eb.length);Ra-=Fa;Ra<0&&(eb[eb.length-1].M==null?(Fa=Ra+Fa,Ra=0):Ra+=eb.length);var De=[];Tg=="call"&&(Ac=1E5,De=["CALL"]);Sg!==void 0&&a.j("%d instructions earlier:\n",Fa);for(var Ee="";Ac>0&&Ra!=a.W;){var Wg=
eb[Ra++];if(Wg.M==null)break;var Bc=Lg(Wg.M),jj=Fa--,Xg=ei(a,Bc,"history",jj);if(!De.length||Xg.indexOf(De[0])>=0)Ee+=Xg+"\n";Bc.Hb&&(Ra+=Bc.Hb,Ac-=Bc.Hb,Fa-=Bc.Hb);Ra>=eb.length&&(Ra=0);a.ra=Fa;Vg++;Ac--}Ee&&a.j("%s\n",Ee)}Vg||(a.j("no %shistory available\n",Ug),a.ra=void 0)}else{var sd=wh(a,db);if(sd){var td=0;Eb&&(Eb.charAt(0)=="l"&&(Eb=Eb.substr(1)||ij),td=zg(a,Eb)>>>0,td>65536&&(td=65536));for(var Cc="",ud=dc=="dd"?4:dc=="dw"?2:1,vd=ud*td||128,kj=vd+15>>4||1;kj--&&vd>0;){var Fe=0,Ge=0,Dc=void 0,
He="",Yg="";db=Bh(sd);for(Dc=16;Dc>0&&vd>0;Dc--){var wd=a.Da(sd,1);Fe|=wd<<(Ge++<<3);Ge==ud&&(He+=w(Fe,ud*2),He+=ud==1?Dc==9?"-":" ":"  ",Fe=Ge=0);Yg+=wd>=32&&wd<127?String.fromCharCode(wd):".";vd--}Cc&&(Cc+="\n");Cc+=db+"  "+He+(Dc==0?" "+Yg:"")}Cc&&a.j("%s\n",Cc);a.pa=sd}}}}break;case "e":if(f[0]=="else")break;var xd=1,Zg=255,$g=a.Da,ah=a.ac;f[0]=="ew"&&(xd=2,Zg=65535,$g=a.Cb,ah=a.$c);var bh=xd<<1,ch=f[1];if(ch==null)a.j("edit memory commands:\n"),a.j("\teb [a] [...]  edit bytes at address a\n"),
a.j("\tew [a] [...]  edit words at address a\n");else{var yd=wh(a,ch);if(yd)for(var zd=2;zd<f.length;zd++){var Ec=Fg(a,f[zd]);if(Ec===void 0){a.j("unrecognized value: %s\n",f[zd]);break}Ec&~Zg&&a.j("warning: %x exceeds %s-byte value\n",Ec,xd);var lj=$g.call(a,yd);a.j("changing %s from %#0*2x to %#0*2x\n",Bh(yd),bh,lj,bh,Ec);ah.call(a,yd,Ec,xd)}}break;case "f":Ai(a,f[1]);break;case "g":a:{var dh=f[1],mj=b;if(dh!==void 0){var Ie=wh(a,dh,!0);if(!Ie)break a;Ah(a,Ie,mj);a.Na(a.u,Ie,!0)}Wh(a,!0)||c||a.j("cpu busy or unavailable, run command ignored\n")}break;
case "h":a:{if(a.flags.ma){var eh="halting";dd(a)}else{if(ac(a,!0))break a;eh="already halted"}c||a.j("%s\n",eh)}break;case "i":if(f[0]=="if"){var Fc=b.substr(2);Fc=Ya(Fc);if(Fg(a,Fc)){c||a.j("true: %s\n",Fc);var fh=!0}else c||a.j("false: %s\n",Fc),fh=!1;fh||(d=!1);break}if(f[0]=="int"){var nj=f[1];if(a.A.O&512){var Je=Fg(a,nj);if(Je==null)var Ke=!1;else a.j("requesting interrupt level %d\n",Je),le(a.A,Je),Ke=!0}else a.j("interrupts disabled (use rif=1 to enable)\n"),Ke=!1;Ke||(d=!1);break}var Le=
f[1];if(Le&&Le!="?"){var Me=zg(a,Le);if(Me!==void 0){var oj=Mc(a.J,Me);a.j("%#06x: %#04x\n",Me,oj)}}else a.j("input commands:\n"),a.j("\ti [p]\tread port [p]\n"),a.j("warning: port accesses can affect hardware state\n");break;case "k":var pj=f[0];if(f[1]=="?")a.j("stack trace commands:\n"),a.j("\tk\tshow frame addresses\n"),a.j("\tks\tshow symbol information\n");else{var Ne=0,gh=Lg(),Gc=Lg(a.A.N);for(a.j("stack trace for %s\n",Bh(Gc));Ne<10;){for(var Fb=null,qj=256;Gc.M>>>0<65536;){gh.M=a.Cb(Gc,2);
if(Gc.M==null||!qj--)break;for(var rj=a,Ad=gh,hh=null,Hc=Ad.M,ih=Hc,Oe=1;Oe<=6&&Hc;Oe++){if(Oe>2){Ad.M=Hc;var Bd=ei(rj,Ad);if(Bd.indexOf("CALL")>=0){var jh=Bd.indexOf(" ");if(Hc+(Bd.indexOf(" ",jh+1)-jh-1)/2==ih){hh=Bd;break}}}Hc--}Ad.M=ih;if(Fb=hh)break}if(!Fb||Fb==null)break;var kh=null;if(pj=="ks"){var lh=Fb.match(/[0-9A-F]+$/);lh&&(kh=Ci(a,lh[0]))}Fb=Wa(Fb,-50)+"  ;"+(kh||"stack="+Bh(Gc));a.j("%s\n",Fb);Ne++}Ne||a.j("no return addresses found\n")}break;case "l":f[0]=="ln"&&Ci(a,f[1],!0);break;
case "m":a:{var Gb,fb=null,ta=f[1];ta=="?"&&(ta=void 0);if(ta!==void 0){var Sa=0;if(ta=="all")Sa=-0xbff000000002,ta=null;else if(ta=="on")fb=!0,ta=null;else if(ta=="off")fb=!1,ta=null;else{for(Gb in t)if(ta==Gb){Sa=t[Gb];fb=ic(a.ja,Sa);break}if(!Sa){a.j("unknown message category: %s\n",ta);break a}}if(Sa)if(f[2]=="on"){var mh=a.ja;a.ja=(mh|Sa)+(mh/4294967296|0|Sa/4294967296|0)*4294967296;fb=!0}else if(f[2]=="off"){var nh=a.ja;a.ja=(nh&~Sa)+((nh/4294967296|0)&~(Sa/4294967296|0))*4294967296;fb=!1;Sa==
0x800000000000&&(a.j("%s\n",a.fa.join("")),a.fa=[])}}var sj=0,Ic="";for(Gb in t)if(!ta||ta==Gb){var tj=ic(a.ja,t[Gb]);if(fb===null||fb==tj)Ic&&(Ic+=","),++sj%10||(Ic+="\n\t"),Ic+=Gb}ta===void 0&&a.j("message commands:\n\tm [category] [on|off]\tturn categories on/off\n");a.j("%s%s\n",fb!==null?fb?"messages on:  ":"messages off: ":"message categories:\n\t",Ic||"none");rh(a)}break;case "o":var Pe=f[1],uj=f[2];if(Pe&&Pe!="?"){var Qe=zg(a,Pe,"port #"),Re=zg(a,uj);Qe!==void 0&&Re!==void 0&&(Pc(a.J,Qe,Re),
a.j("%#06x: %#04x\n",Qe,Re))}else a.j("output commands:\n"),a.j("\to [p] [b]\twrite byte [b] to port [p]\n"),a.j("warning: port accesses can affect hardware state\n");break;case "p":if(f[0]=="print"){Ei(a,b.substr(5));break}var oh=f[0]=="pr"?1:0,vj=1+oh;if(a.T)a.j("step in progress\n");else{var Se=Lg(a.A.u);switch(a.Da(Se)){case 205:a.T=vj,yh(Se,3)}a.T?(a.Na(a.u,Se,!0),Wh(a)||(a.S&&a.S.Ya(),a.T=0)):Fi(a,oh?"tr":"t")}break;case "r":if(b=="reset"){a.S&&a.S.reset();break}Yh(a,f);break;case "s":Di(a,
f);break;case "t":Fi(a,f[0],f[1]);break;case "u":Zh(a,f[1],f[2],8);break;case "v":if(f[0]=="var"){Bi(a,b.substr(3))||(d=!1);break}a.j("%s version %s (%s%s%s)\n","PCx80","2.21",a.A.model,",RELEASE",",TYPEDARRAYS");a.j("%s\n",lb());break;case "?":if(f[1]){Ei(a,b.substr(1));break}var Te="commands:",Ue;for(Ue in Hi)Te+="\n"+Wa(Ue,-9)+Hi[Ue];ne(a)||(Te+="\nnote: frequency/history disabled if no exec breakpoints");a.j("%s\n",Te);break;case "n":a.j(2199023255552,"msPerYield: %d\nnCyclesPerYield: %d\n",a.A.Ua,
a.A.Ba);default:a.j("unknown command: %s\n",b),d=!1}}}catch(qh){a.j("debugger error: %s\n",qh.stack||qh.message),d=!1}return d}function th(a,b,c){b=a.yb(b,c);for(var d in b)if(!di(a,b[+d]))return!1;return!0}
var Hi={"?":"help/print","a [#]":"assemble","b [#]":"breakpoint",c:"clear output","d [#]":"dump memory","e [#]":"edit memory",f:"frequencies","g [#]":"go [to #]",h:"halt","i [#]":"input port #","if":"eval expression","int [#]":"request interrupt",k:"stack trace",ln:"list nearest symbol(s)",m:"messages","o [#]":"output port #",p:"step over",print:"print expression",r:"dump/set registers",reset:"reset machine",s:"set options","t [#]":"trace","u [#]":"unassemble",v:"print version","var":"assign variable"},
Kg=8080,fi=8086,gi="NONE ACI ADC ADD ADI ANA ANI CALL CC CM CNC CNZ CP CPE CPO CZ CMA CMC CMP CPI DAA DAD DCR DCX DI EI HLT IN INR INX JMP JC JM JNC JNZ JP JPE JPO JZ LDA LDAX LHLD LXI MOV MVI NOP ORA ORI OUT PCHL POP PUSH RAL RAR RET RC RM RNC RNZ RP RPE RPO RZ RLC RRC RST SBB SBI SHLD SPHL STA STAX STC SUB SUI XCHG XRA XRI XTHL".split(" "),hi="NONE ADC ADC ADD ADD AND AND CALL CALLC CALLS CALLNC CALLNZ CALLNS CALLP CALLNP CALLZ NOT CMC CMP CMP DAA ADD DEC DEC CLI STI HLT IN INC INC JMP JC JS JNC JNZ JNS JP JNP JZ MOV MOV MOV MOV MOV MOV NOP OR OR OUT JMP POP PUSH RCL RCR RET RETC RETS RETNC RETNZ RETNS RETP RETNP RETZ ROL ROR RST SBB SBB MOV MOV MOV MOV STC SUB SUB XCHG XOR XOR XCHG".split(" "),
Gh=0,Hh=1,Ih=2,Jh=3,Kh=4,Lh=5,Mh=6,Fh=7,Nh=8,Oh=9,Ph=10,Qh=11,Rh=12,Sh=13,Th=14,Dh="B C D E H L M A BC DE HL SP PC PS PSW".split(" "),ki=15,ji=240,ti=3840,li=61440,ii=0,oi=1,pi=2,qi=3,si=16,Q=32,ri=64,ui=128,R=Fh<<8|si|oi,S=Gh<<8|si|oi,T=Hh<<8|si|oi,U=Ih<<8|si|oi,V=Jh<<8|si|oi,W=Kh<<8|si|oi,X=Lh<<8|si|oi,Z=Mh<<8|si|oi|ri,Ii=Nh<<8|si|qi,Ji=Oh<<8|si|qi,Ki=Ph<<8|si|qi,Li=Qh<<8|si|qi,Mi=Th<<8|si|qi,ni=4096,mi=8192,P=16384,vi=32768,uh=[[45],[42,Ii,Q],[71,Ii|ri,R|P],[29,Ii],[28,S],[22,S],[44,S,Q],[63],
[45,vi],[21,Ki|P,Ii],[40,R|P,Ii|ri],[23,Ii],[28,T],[22,T],[44,T,Q],[64],[45,vi],[42,Ji,Q],[71,Ji|ri,R|P],[29,Ji],[28,U],[22,U],[44,U,Q],[52],[45,vi],[21,Ki|P,Ji],[40,R|P,Ji|ri],[23,Ji],[28,V],[22,V],[44,V,Q],[53],[45,vi],[42,Ki,Q],[68,51|ri,Ki|P],[29,Ki],[28,W],[22,W],[44,W,Q],[20],[45,vi],[21,Ki|P,Ki],[41,Ki|P,51|ri],[23,Ki],[28,X],[22,X],[44,X,Q],[16,R|P],[45,vi],[42,Li,Q],[70,51|ri,R|P],[29,Li],[28,Z],[22,Z],[44,Z,Q],[72],[45,vi],[21,Ki|P,Li],[39,R|P,51|ri],[23,Li],[28,R],[22,R],[44,R,Q],[17],
[43,S,S],[43,S,T],[43,S,U],[43,S,V],[43,S,W],[43,S,X],[43,S,Z],[43,S,R],[43,T,S],[43,T,T],[43,T,U],[43,T,V],[43,T,W],[43,T,X],[43,T,Z],[43,T,R],[43,U,S],[43,U,T],[43,U,U],[43,U,V],[43,U,W],[43,U,X],[43,U,Z],[43,U,R],[43,V,S],[43,V,T],[43,V,U],[43,V,V],[43,V,W],[43,V,X],[43,V,Z],[43,V,R],[43,W,S],[43,W,T],[43,W,U],[43,W,V],[43,W,W],[43,W,X],[43,W,Z],[43,W,R],[43,X,S],[43,X,T],[43,X,U],[43,X,V],[43,X,W],[43,X,X],[43,X,Z],[43,X,R],[43,Z,S],[43,Z,T],[43,Z,U],[43,Z,V],[43,Z,W],[43,Z,X],[26],[43,Z,R],[43,
R,S],[43,R,T],[43,R,U],[43,R,V],[43,R,W],[43,R,X],[43,R,Z],[43,R,R],[3,R|P,S],[3,R|P,T],[3,R|P,U],[3,R|P,V],[3,R|P,W],[3,R|P,X],[3,R|P,Z],[3,R|P,R],[2,R|P,S],[2,R|P,T],[2,R|P,U],[2,R|P,V],[2,R|P,W],[2,R|P,X],[2,R|P,Z],[2,R|P,R],[73,R|P,S],[73,R|P,T],[73,R|P,U],[73,R|P,V],[73,R|P,W],[73,R|P,X],[73,R|P,Z],[73,R|P,R],[66,R|P,S],[66,R|P,T],[66,R|P,U],[66,R|P,V],[66,R|P,W],[66,R|P,X],[66,R|P,Z],[66,R|P,R],[5,R|P,S],[5,R|P,T],[5,R|P,U],[5,R|P,V],[5,R|P,W],[5,R|P,X],[5,R|P,Z],[5,R|P,R],[76,R|P,S],[76,R|
P,T],[76,R|P,U],[76,R|P,V],[76,R|P,W],[76,R|P,X],[76,R|P,Z],[76,R|P,R],[46,R|P,S],[46,R|P,T],[46,R|P,U],[46,R|P,V],[46,R|P,W],[46,R|P,X],[46,R|P,Z],[46,R|P,R],[18,R|P,S],[18,R|P,T],[18,R|P,U],[18,R|P,V],[18,R|P,W],[18,R|P,X],[18,R|P,Z],[18,R|P,R],[58],[50,Ii],[34,51],[30,51],[11,51],[51,Ii],[4,R|P,Q|oi],[65,ui],[62],[54],[38,51],[30,51|vi],[15,51],[7,51],[1,R|P,Q|oi],[65,ui],[57],[50,Ji],[33,51],[48,Q|oi,R|P],[10,51],[51,Ji],[74,R|P,Q|oi],[65,ui],[55],[54,vi],[31,51],[27,R|P,Q|oi],[8,51],[7,51|vi],
[67,R|P,Q|oi],[65,ui],[61],[50,Ki],[37,51],[78,Li|ri|P,Ki|P],[14,51],[51,Ki],[6,R|P,Q|oi],[65,ui],[60],[49,Ki],[36,51],[75,Ki|P,Ji|P],[13,51],[7,51|vi],[77,R|P,Q|oi],[65,ui],[59],[50,Mi],[35,51],[24],[12,51],[51,Mi],[47,R|P,Q|oi],[65,ui],[56],[69,Li|P,Ki|P],[32,51],[25],[9,51],[7,51|vi],[19,R|P,Q|oi],[65,ui]],Vh=1E3;zb(function(){for(var a=Pb("pcx80","debugger"),b=0;b<a.length;b++){var c=a[b],d=Qb(c);d=new Jg(d);Ob(d,c)}});
function Ni(a,b,c){y.call(this,"Computer",a,16384);this.flags.ca=!1;Oi(this,b);this.L=gd(this,"autoPower",a);this.u=0;this.X=a.busWidth||a.buswidth;this.g=Pi;this.H=null;this.F=this.U=!1;this.url=gd(this,"url")||"";(Math.random()+.1).toString(36);this.i=Qi(this);if(this.A=Tb("CPU",this.id)){this.K=Tb("Debugger",this.id);this.C=[];for(b=!1;b=nc(this,"Video",b);)this.C.push(b);this.J=new pc({id:this.Qa+".bus",busWidth:this.X},this.A,this.K);var d=Rb(this.id);if(this.D=(this.N=Tb("Panel",this.id))&&
this.N.R.print)for(b=0;b<d.length;b++){var e=d[b];e.print=this.N.print}this.j(0,"%s v%s\n%s\n%s\n","PCx80","2.21","Copyright \u00a9 2012-2025 Jeff Parsons <Jeff@pcjs.org>","License: MIT <https://www.pcjs.org/LICENSE.txt>");for(b=0;b<d.length;b++)e=d[b],e.Ca&&e.Ca(this,this.J,this.A,this.K);b=null;e=gd(this,"resume",a);e!==void 0&&(e.length>1?b=this.G=e:this.g=parseInt(e,10));e=!1;d=gd(this,"state");d||(e=!0,d=a.state);d&&(b=this.O=d,e||(this.F=!0,this.g=Pi),this.g&&(this.I=new Od(this,"2.21"),this.I.load()?
b=null:delete this.I));!b&&this.g&&(b=Ri(this))&&(this.F=!0);if(b){var f=this;cb(b,null,!0,function(g,h,k){k?(f.G=null,f.F=!1,f.j(274877906944,"Unable to load machine state from server (error %d%s)\n",k,h?": "+Ya(h):"")):(f.H=h,f.U=!0,f.j(2267742732288,"loaded state file %s\n",g.replace(f.i||"xxx","xxx")));$b(f)})}else $b(this);this.R.power||(this.L=!0);!c&&this.L&&this.wait(this.kb)}else kb("Unable to find CPU component")}pa(Ni,y);
function Oi(a,b){if(!b){var c,d=n.resources;if(typeof d=="object"&&(c=d.parms))try{b=eval("("+c+")")}catch(e){kb(e.message+" ("+c+")")}}a.V=b}function gd(a,b,c){var d=n.resources,e=b.toLowerCase();e=ub(b)||ub(e);e===void 0&&a.V&&(e=a.V[b]);e===void 0&&c&&(e=c[b]);e===void 0&&typeof d=="object"&&d[b]&&(e=b);return e}m=Ni.prototype;
m.wait=function(a,b){for(var c=this,d=Rb(this.id),e=0;e<=d.length;e++){var f=e<d.length?d[e]:this;if(!Zb(f)){Zb(f,function(){c.wait(a,b)});return}}this.j(2267742732288,"wait(ready)\n");a.call(this,b)};function Si(a,b){var c=new Od(a,"2.21",Ti);if(c.load()&&Ui(c)){var d=c.get(Vi),e=b?b.get(Vi):"unknown";d!=e?(a.j(274877906944,"Machine state may be out-of-date\n(%s vs. %s)\nCheck your browser's local storage limits\n",d,e),b||c.clear()):a.j(2267742732288,"last state: %s (validate: %s)\n",e,d)}}
m.kb=function(a){a===void 0&&(a=this.g||(this.H?Wi:Pi));this.j(2267742732288,"powerOn(%s)\n",a==Xi?"repower":a?"resume":"");if(!this.u){this.u++;var b=!1,c=!1;this.T=!1;var d=this.I||new Od(this,"2.21");if(a==Xi)b=!0;else if(a>Pi){if(d.load(this.H)){this.B=new Od(this,"2.21",Yi);this.B.load()&&(Zi(),a=$i,aj(this.B));this.B.set(Vi,Xa("%T",new Date));this.B.store();var e=this.g&&!this.F;if(a==Wi||Nb("Click OK to restore the previous PCx80 machine state, or CANCEL to reset the machine.")){if(c=Ui(d)){var f=
d.get("code"),g=d.get("data");f&&(f=="ok"?d.load(g):(f=="error"&&g!="no machine state"?(this.j(274877906944,"Error: %s\n",g),g=="unable to verify user"&&(qb(bj,""),this.i=null)):this.j("%s: %s\n",f,g),aj(d),d.load()?(c=Ui(d),e=!0):c=!1))}e&&Si(this,c?d:null)}else a==$i&&d.clear()}else Si(this);delete this.H;delete this.I}e=Rb(this.id);for(f=0;f<e.length;f++)g=e[f],g!==this&&g!=this.A&&(c=cj(this,g,d,b,c));b=[d,a,c];a!=Xi?this.wait(this.Ec,b):this.Ec(b)}};
function cj(a,b,c,d,e){if(!b.flags.ca){b.flags.ca=!0;if(b.va){var f=null;e&&((f=c.get(b.id))||(f=c.get(b.id.replace(/-[0-9]+\./i,"."))));typeof f==="string"&&(f=null);!b.va(f,d)&&f&&(kb("Unable to restore state for "+b.type),a.O&&!a.U?(c.clear(),a.g=Pi,n.location&&n.location.reload()):a.T=!0,b.va(null),e=!1)}if(!d&&b.yc)for(a=b.yc.split("|"),c=0;c<a.length;c++)b.j(137438953472,"%s\n",a[c])}return e}
m.Ec=function(a){var b=a[0],c=a[1]<0;a=a[2];this.j(2267742732288,"donePowerOn(%s)\n",this.flags.ca?"redundant":"");this.P=!0;this.flags.ca=!0;var d=this.R.power;d&&(d.textContent="Shutdown");this.A&&(cj(this,this.A,b,c,a),this.A.hb());this.T&&(Zi(),b.clear());!c&&this.B&&(this.B.clear(),delete this.B);this.u=0};function Zi(){Bb("There may be a problem with your PCx80 machine.")}
function Gi(a,b,c){var d="none";a.j(2267742732288,"powerOff(%s%s)\n",b?"save":"nosave",c?",shutdown":"");if(a.u)return null;a.u--;var e=new Od(a,"2.21"),f=new Od(a,"2.21",Ti),g=Xa("%T",new Date);f.set(Vi,g);e.set(Vi,g);e.set(dj,"2.21");e.set(ej,n.location?n.location.href:null);e.set(fj,lb());if(a.A&&a.A.ua){c&&md(a.A);var h=a.A.ua(b,c);typeof h==="object"&&e.set(a.A.id,h);c&&(a.A.flags.ca=!1,h===!1&&(d=null))}g=Rb(a.id);for(var k=0;k<g.length;k++){var l=g[k];l.flags.ca&&(l.ua&&(h=l.ua(b,c),typeof h===
"object"&&e.set(l.id,h)),c&&(l.flags.ca=!1,h===!1&&(d=null)))}d&&(c?(g=h=!1,b?(a.i&&gj(a,a.i,e.toString()),f.store()&&e.store()||(d=null,h=g=!0)):a.g&&(h=!0,g=a.g==hj),h&&e.clear(g)):d=e.toString());c&&(a.flags.ca=!1,b=a.R.power)&&(b.textContent="Power");a.u=0;return d}m.reset=function(){this.J&&this.J.reset&&(this.j("Resetting %s\n",this.J.type),this.J.reset());for(var a=Rb(this.id),b=0;b<a.length;b++){var c=a[b];c!==this&&c!==this.J&&c.reset&&(this.j("Resetting %s\n",c.type),c.reset())}};
m.start=function(a,b){for(var c=Rb(this.id),d=0;d<c.length;d++){var e=c[d];e.type!="CPU"&&e!==this&&e.start&&e.start(a,b)}};m.stop=function(a,b){for(var c=Rb(this.id),d=0;d<c.length;d++){var e=c[d];e.type!="CPU"&&e!==this&&e.stop&&e.stop(a,b)}};
m.ea=function(a,b,c){var d=this;switch(b){case "power":return this.R[b]=c,c.onclick=function(){d.u||(d.flags.ca?Gi(d,!1,!0):d.wait(d.kb))},!0;case "reset":return this.R[b]=c,c.onclick=function(){if(d.flags.ca&&!d.u)if(d.g&&!d.G){var e=Nb("Click OK to save changes to this PCx80 machine.\n\nWARNING: If you CANCEL, all disk changes will be discarded.");Gi(d,e,!0);!e&&d.O?n.location&&n.location.reload():d.kb(Pi)}else d.reset(),d.A&&d.A.hb()},!0;case "save":if(Ta())this.j(2267742732288,"Remote user API not available\n"),
c.parentNode.removeChild(c);else return this.R[b]=c,c.onclick=function(){var e=Qi(d,!0);if(e){var f=!!(d.g&&!d.G||d.O),g=Gi(d,f);f?gj(d,e,g):d.j(274877906944,"Resume disabled, machine state not saved\n")}},!0}return!1};
function Qi(a,b){var c=a.i;c||((c=pb(bj),c!==void 0)?!c&&b&&(b=null,n.prompt&&(b=n.prompt("Saving machine states on the pcjs.org server is currently unsupported.\n\nIf you're running your own server, enter your user ID below.","")),c=b)&&((c=wj(a,c))||a.j(274877906944,"The user ID is invalid.\n")):b&&a.j(274877906944,"Browser local storage is not available\n"));return c}
function wj(a,b){a.i=null;b=cb(ib()+"/api/v1/user?req=verify&user="+b);var c=b[1];if(!b[0]&&c)try{b=eval("("+c+")"),b.code&&b.code=="ok"&&(qb(bj,b.data),a.i=b.data)}catch(d){kb(d.message+" ("+c+")")}return a.i}function Ri(a){var b=null;a.i?(a.j(2267742732288,"%s for load: %s\n",bj,a.i),b=ib()+"/api/v1/user?req=load&user="+a.i+"&state="+xj(a,"2.21")):a.j(2267742732288,"%s unavailable\n",bj);return b}
function gj(a,b,c){if(c){a.j(2267742732288,"size of server state: %d bytes\n",c.length);a.j(2267742732288,"%s for store: %s\n",bj,b);var d={req:"store"};d.user=b;d.state=xj(a,"2.21");d.data=c;b=cb(ib()+"/api/v1/user",d);d=b[0];if(b[1]){if(d){var e=d.indexOf("\n");e>0&&(d=d.substr(0,e));d.indexOf("Error: ")||(d=d.substr(7))}d='{"code":'+b[1]+',"data":"'+d+'"}'}a.j(2267742732288,"%s\n",d);b=JSON.parse(d);b&&b.code=="ok"?a.j(274877906944,"Machine state saved to server\n"):c&&(c=b&&b.data||"unable to save machine state",
c=b.code=="error"?"Error: "+c:"Error "+b.code+": "+c,a.j(274877906944,"%s\n",c),qb(bj,""),a.i=null)}else a.j(2267742732288,"no state to store\n")}function nc(a,b,c){c=c===void 0?null:c;a=Rb(a.id);for(var d=0;d<a.length;d++){var e=a[d];if(c)c==e&&(c=null);else if(e.type==b)return e}return null}m.Ya=function(a){if(this.C.length){var b=0,c=0;!a&&xa&&(b=n.scrollX,c=n.scrollY);var d=this.C[0];d.W&&d.W.focus();!a&&n.scrollTo&&n.scrollTo(b,c)}};
function Ed(a,b){a.A&&(a=a.A,a.fb&&(b||!a.flags.ma||a.flags.Dc)&&(me(a,"A",a.i),me(a,"B",a.B),me(a,"C",a.C),me(a,"BC",Pd(a),4),me(a,"D",a.D),me(a,"E",a.F),me(a,"DE",Rd(a),4),me(a,"H",a.G),me(a,"L",a.H),me(a,"HL",D(a),4),me(a,"SP",a.N,4),me(a,"PC",a.u,4),b=Nd(a),me(a,"PS",b,4),me(a,"IF",b&512?1:0,1),me(a,"SF",b&128?1:0,1),me(a,"ZF",b&64?1:0,1),me(a,"AF",b&16?1:0,1),me(a,"PF",b&4?1:0,1),me(a,"CF",b&1?1:0,1)),b=a.R.speed)&&(b.textContent=a.flags.ma&&a.Z?a.Z.toFixed(2)+"Mhz":"Stopped")}
var Yi="failsafe",Ti="validate",Vi="timestamp",dj="version",ej="url",fj="browser",bj="user",Xi=-1,Pi=0,Wi=1,$i=2,hj=3;zb(function(){for(var a=Pb("pcx80","machine"),b=0;b<a.length;b++){var c=a[b],d=Qb(c);c=Pb("pcx80","computer",c);for(var e=0;e<c.length;e++){var f=c[e],g=Qb(f);g=new Ni(g,d,!0);g.j(2267742732288,"onInit(%b)\n",g.flags.ca);Ob(g,f);g.L&&g.wait(g.kb)}}});
Ab.show.push(function(){for(var a=Pb("pcx80","computer"),b=0;b<a.length;b++){var c=Qb(a[b]);if(c=Tb("Computer",c.id))c.flags.Mc=!1,c.j(2267742732288,"show(%b,%b)\n",c.P,c.flags.ca),c.P&&!c.flags.ca&&c.kb(Xi)}});Ab.exit.push(function(){for(var a=Pb("pcx80","computer"),b=0;b<a.length;b++){var c=Qb(a[b]);if(c=Tb("Computer",c.id))c.flags.Mc=!0,c.j(2267742732288,"onExit(%b)\n",c.flags.ca),c.flags.ca&&Gi(c,!(!c.g||c.G),!0)}});
function Od(a,b,c){this.id=a.id;this.K=a.K;this.i="";this.g={};this.A=this.J=!1;this.key=xj(a,b,c);aj(this,a.Cd)}m=Od.prototype;m.set=function(a,b){try{this.g[a]=b}catch(c){x(1099511627776,c.message)}};m.get=function(a){return this.g[a]||null};m.data=function(){return this.g};m.load=function(a){return a?(this.i=a,this.A=!0,this.J=!1,!0):this.A?!0:mb()&&(a=pb(this.key))?(this.i=a,this.A=!0,x(2199023255552,"localStorage(%s): %d bytes loaded\n",this.key,a.length),!0):!1};
function Ui(a){var b=!0;if(!a.J)try{a.g=JSON.parse(a.i),a.J=!0}catch(c){kb(c.message||c),b=!1}return b}m.store=function(){var a=!0;if(mb()){var b=JSON.stringify(this.g);qb(this.key,b)?x(2199023255552,"localStorage(%s): %d bytes stored\n",this.key,b.length):(x(1099511627776,"Unable to store %d bytes in browser local storage\n",b.length),a=!1)}return a};m.toString=function(){return this.g?JSON.stringify(this.g):this.i};function aj(a,b){a.i="";a.g={};a.A=a.J=!1;b&&a.set("parms",b)}
m.clear=function(a){aj(this);var b=[];if(mb())try{for(var c=0,d=n.localStorage.length;c<d;c++)b.push(n.localStorage.key(c))}catch(f){ob(f)}for(c=0;c<b.length;c++)if((d=b[c])&&(a||d.substr(0,this.key.length)==this.key)){var e=d;if(mb())try{n.localStorage.removeItem(e)}catch(f){ob(f)}x(2199023255552,"localStorage(%s) removed\n",d);b.splice(c,1);c=0}};function xj(a,b,c){a=a.id;if(b){var d=b.indexOf(".");d>0&&(a+=".v"+b.substr(0,d))}c&&(a+="."+c);return a}var yj=0;
function zj(a,b,c,d,e,f,g,h,k){h("Loading "+a+"...");cb(a,null,!0,function(l,r,u){u?(r||(r="unable to load "+a+" ("+u+")"),k(l,r,null)):Aj(r,a,b,c,d,e,f,g,h,k)})}
function Aj(a,b,c,d,e,f,g,h,k,l){function r(u,q,p){if(p)l(u,p,null);else{c&&(Lb(c,b,q),(p=b)&&p.indexOf("/")<0&&window.location.pathname.slice(-1)=="/"&&(p=window.location.pathname+p),f?f.slice(-1)=="}"?(f=f.slice(0,-1),f.length>1&&(f+=",")):f='{state:"'+f+'",':f="{",f+='url:"'+p+'"}',typeof resources=="object"&&(p=null),f=f.replace(/\$/g,"$$$$").replace(/'/g,"&apos;"),g&&(u=q.match(/(<machine[^>]*\sclass=)(['"])(.*?)(\2[^>]*>)/))&&(q=q.replace(u[0],u[1]+u[2]+g+u[4]),g=""),(u=q.match(/(<machine[^>]*\sdebugger=)(['"])(available)(\2[^>]*>)/))&&
(q=q.replace(u[0],u[1]+u[2]+"optional"+u[4])),q=q.replace(/(<machine[^>]*\sid=)(['"]).*?\2/,"$1$2"+c+"$2"+(g?' class="'+g+'"':"")+(f?" parms='"+f+"'":"")+(p?' url="'+p+'"':"")));h||(q=q.replace(/(<xsl:variable name="APPNAME">).*?(<\/xsl:variable>)/,"$1"+d+"$2"),q=q.replace(/(<xsl:variable name="APPCLASS">).*?(<\/xsl:variable>)/,"$1"+e+"$2"),q=q.replace(/<xsl:variable name="APPVERSION"(\/>|>[^<]*<\/xsl:variable>)/,'<xsl:variable name="APPVERSION">2.21</xsl:variable>'));u=null;if(q.charAt(0)=="<")try{h||
(q=q.replace(/<!DOCTYPE(.|[\r\n])*]>\s*/g,"")),window.ActiveXObject||"ActiveXObject"in window?(u=new window.ActiveXObject("Microsoft.XMLDOM"),u.async=!1,u.loadXML(q)):u=(new window.DOMParser).parseFromString(q,"text/xml")}catch(A){u=null,q=A.message}else q="unrecognized XML: "+(q.length>255?q.substr(0,255)+"...":q);l(b,q,u)}}a?h?Bj(b,a,k,r):r(b,a,""):l(b,"no data",null)}
function Bj(a,b,c,d){var e;if(e=/<([a-z]+)\s+ref="(.*?)"(.*?)\/>/g.exec(b)){var f=e[2];c("Loading "+f+"...");cb(f,null,!0,function(g,h,k){if(k||!h)d(g,b,"unable to resolve XML reference: "+e[0]+" ("+k+")");else{if(k=e[3]){var l=h.match(new RegExp("<"+e[1]+"[^>]*>"));if(l){for(var r=l[0],u,q=/( [a-z]+=)(['"])(.*?)\2/gi;u=q.exec(k);)r=r.toLowerCase().indexOf(u[1].toLowerCase())<0?r.replace(">",u[0]+">"):r.replace(new RegExp(u[1]+"(['\"])(.*?)\\1"),u[0]);l[0]!=r&&(h=h.replace(l[0],r))}else{d(g,b,"missing <"+
e[1]+"> in "+f);return}}h=h.replace(/<\?xml[^>]*>[\r\n]*/,"");b=b.replace(e[0],h);Bj(g,b,c,d)}})}else d(a,b,"")}
function Cj(a,b,c,d,e,f,g){function h(G){if(u===void 0){var z=r&&Pb("machine-warning","",r);u=z&&z[0]||r}u&&(u.innerHTML=Ua(G))}function k(G,z){if(typeof z=="string"&&z.indexOf("<!DOCTYPE html>")>=0){var fa=z.match(/<title>(?:PCjs: |)(.*?)<\/title>/);fa&&(z=fa[1])}x(1099511627776,"%s\n",z);h("Error: "+z+(G?" ("+G+")":""));q&&l();q=!1}function l(){--yj||Hb(!0)}var r,u,q=!0;yj++;Aa.machines[c]={};if(!d)return f&&Lb(c,"parms",f),l(),q;ub("debugger")=="true"&&d.indexOf("/debugger")<0&&(d=d.replace("/machine.xml",
"/debugger/machine.xml"));try{if(r=document.getElementById(c)){var p,A=n.resources;if(typeof A=="object"&&(p=A.css)){var E=document.head||document.getElementsByTagName("head")[0],F=document.createElement("style");F.type="text/css";F.styleSheet?F.styleSheet.cssText=p:F.appendChild(document.createTextNode(p));E.appendChild(F)}e||(e="/machines/"+b+"/xsl/components.xsl");b=b.split("/").pop();p=function(G,z,fa){fa?zj(e||"","",a,b,"","",!1,h,function(Y,ha,ma){if(ma)if(Lb(c,e||"",ha),h("Processing "+d+"..."),
window.ActiveXObject||"ActiveXObject"in window)(ma=fa.transformNode(ma))?(r.outerHTML=ma,l()):k(Y,"transformNodeToObject failed");else if(document.implementation&&document.implementation.createDocument)if(ha=new XSLTProcessor,ha.importStylesheet(ma),ma=ha.transformToFragment(fa,document))if(ha=r.parentNode){var Qa=Y=0,ia=r.getBoundingClientRect();ia.bottom<0&&(Y=window.scrollX,Qa=window.scrollY);ha.replaceChild(ma,r);(r=document.getElementById(c))&&ia.bottom<0&&(ma=r.getBoundingClientRect(),Qa=window.performance&&
window.performance.navigation.type==window.performance.navigation.TYPE_RELOAD?0:Qa+Math.ceil(ma.height-ia.height),window.scrollTo(Y,Qa));l()}else k(Y,"invalid machine element: "+c);else k(Y,"transformToFragment failed");else k(Y,"unable to transform XML: unsupported browser");else k(Y,ha)}):k(G,z)};d.charAt(0)!="<"?zj(d,c,a,b,f||"",g||"",!0,h,p):Aj(d,"",c,a,b,f||"",g||"",!1,h,p)}else k(d,"missing machine element: "+c)}catch(G){k(d,G.message)}return q}
function Dj(a,b,c,d,e){Hb(!1);return Cj("PCx86","pcx86",a,b,c,d,e)}n.embedC1P=function(a,b,c,d,e){Hb(!1);return Cj("C1Pjs","osi/c1p",a,b,c,void 0,e)};n.embedPC=Dj;n.embedPCx86=Dj;n.embedPCx80=function(a,b,c,d,e){Hb(!1);return Cj("PCx80","pcx80",a,b,c,d,e)};n.embedPDP10=function(a,b,c,d,e){Hb(!1);return Cj("PDPjs","dec/pdp10",a,b,c,d,e)};n.embedPDP11=function(a,b,c,d,e){Hb(!1);return Cj("PDPjs","dec/pdp11",a,b,c,d,e)};
n.commandMachine=function(a,b,c,d,e,f){if(e=="script"){d=!1;e=Aa.commands;c+=".machine";if(!f)delete e[c],d=!0;else if(typeof f=="string"&&!e[c]){d=!0;for(var g=c,h=f.length,k=[],l=[],r="",u=null,q=0;q<h;q++){var p=f[q];if(p=='"'||p=="'")u&&p!=u?r+=p:(u?u=null:u=p,r&&(l.push(r),r=""));else{if(!u){if(p=="\r"||p=="\n")p=";";if(p==" "||p=="\t"||p==";"){r&&(l.push(r),r="");p==";"&&l.length&&(k.push(l),l=[]);continue}}r+=p}}r&&l.push(r);l.length&&k.push(l);e[g]=k;Ub(c)||(d=!1)}return d?(b&&(a.disabled=
!0),!0):!1}if(d&&(g=Tb(d,c+".machine"))&&(h=g.exports)&&(h=h[e]))return h.call(g,f)?(b&&(a.disabled=!0),!0):!1;console.log("unimplemented: commandMachine('"+c+"','"+d+"','"+e+"','"+f+"')");return!1};n.enableEvents=Hb;n.sendEvent=Cb;})()

//# sourceMappingURL=pcx80.js.map
