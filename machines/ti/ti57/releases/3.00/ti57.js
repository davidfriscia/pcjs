(function(){/*
 https://www.pcjs.org/machines/modules/v3/defines.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/message.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v2/format.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/stdlib.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/stdio.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/webio.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/device.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/input.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/led.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/time.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/bus.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/memory.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/rom.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/cpu.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/ti/modules/v3/cpu1500.js (C) 2012-2026 Jeff Parsons
 https://www.pcjs.org/machines/modules/v3/machine.js (C) 2012-2026 Jeff Parsons
*/
var p,aa=typeof Object.create=="function"?Object.create:function(a){function b(){}b.prototype=a;return new b},ba=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function ca(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var da=ca(this),ea="Int8 Uint8 Uint8Clamped Int16 Uint16 Int32 Uint32 Float32 Float64".split(" ");da.BigInt64Array&&(ea.push("BigInt64"),ea.push("BigUint64"));
function fa(a,b){if(b)for(var c=0;c<ea.length;c++)ha(ea[c]+"Array.prototype."+a,b)}function q(a,b){b&&ha(a,b)}function ha(a,b){var c=da;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&b!=null&&ba(c,a,{configurable:!0,writable:!0,value:b})}var ia;
if(typeof Object.setPrototypeOf=="function")ia=Object.setPrototypeOf;else{var ja;a:{var ka={a:!0},la={};try{la.__proto__=ka;ja=la.a;break a}catch(a){}ja=!1}ia=ja?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ma=ia;
function u(a,b){a.prototype=aa(b.prototype);a.prototype.constructor=a;if(ma)ma(a,b);else for(var c in b)if(c!="prototype")if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.ve=b.prototype}function na(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}
function y(a){if(!(a instanceof Array)){var b=typeof Symbol!="undefined"&&Symbol.iterator&&a[Symbol.iterator];if(b)a=b.call(a);else if(typeof a.length=="number")a={next:na(a)};else throw Error(String(a)+" is not an iterable or ArrayLike");for(var c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a}function oa(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b}
q("String.prototype.replaceAll",function(a){return a?a:function(b,c){if(b instanceof RegExp&&!b.global)throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument.");return b instanceof RegExp?this.replace(b,c):this.replace(new RegExp(String(b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"g"),c)}});
q("Math.trunc",function(a){return a?a:function(b){b=Number(b);if(isNaN(b)||b===Infinity||b===-Infinity||b===0)return b;var c=Math.floor(Math.abs(b));return b<0?-c:c}});q("String.prototype.repeat",function(a){return a?a:function(b){if(this==null)throw new TypeError("The 'this' value for String.prototype.repeat must not be null or undefined");var c=this;if(b<0||b>1342177279)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}});
q("Number.isNaN",function(a){return a?a:function(b){return typeof b==="number"&&isNaN(b)}});q("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}});
q("Symbol",function(a){function b(f){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(f||"")+"_"+e++,f)}function c(f,g){this.g=f;ba(this,"description",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.g};var d="jscomp_symbol_"+(Math.random()*1E9>>>0)+"_",e=0;return b});
q("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");ba(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return pa(na(this))}});return a});function pa(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}function qa(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}
q("Array.prototype.keys",function(a){return a?a:function(){return qa(this,function(b){return b})}});q("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;c<0&&(c=Math.max(0,e+c));if(d==null||d>e)d=e;d=Number(d);d<0&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}});fa("fill",function(a){return a?a:Array.prototype.fill});q("Number.parseInt",function(a){return a||parseInt});
q("Array.prototype.values",function(a){return a?a:function(){return qa(this,function(b,c){return c})}});function ra(){this.U=""}var sa=new ArrayBuffer(2);(new DataView(sa)).setUint16(0,256,!0);new Uint16Array(sa);var z={ie:typeof window!="undefined",node:typeof window!="undefined"?{}:global,process:typeof process!="undefined"?process:{},window:typeof window!="undefined"?window:global,document:typeof document!="undefined"?document:{},Oa:{machines:{},components:[],commands:{},files:null}};
z.window.PCjs?z.Oa=z.window.PCjs:z.window.PCjs=z.Oa;var ta=z.process,C=z.Oa.machines,ua=z.Oa.components,D={};D.Defines=ra;var va={all:0xffffffffffff,addr:1,bus:2,fault:4,memory:8,ports:16,chips:32,kbd:64,serial:128,misc:256,cpu:512,mmu:2048,"int":1024,trap:4096,video:8192,monitor:16384,screen:32768,disk:131072,file:65536,time:262144,timer:524288,event:1048576,input:2097152,key:4194304,mouse:8388608,touch:16777216,info:274877906944,warn:549755813888,error:1099511627776,halt:70368744177664,buffer:0x800000000000};
function wa(){this.g={};for(var a=0;a<23;a++)this.g["ACDFGHMNSTWYBbdfjcsoXx%"[a]]=null}function xa(){var a=oa.apply(0,arguments);if(a[0]===void 0)a=new Date(Date.now());else if(typeof a[0]==="string"){var b=a[0];b.indexOf(":")<0?b+=" "+(a[1]||"00:00:00 UTC"):b.match(/^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9] [0-9][0-9]:[0-9][0-9]:[0-9][0-9]$/)&&(a[1]||(b+=" UTC"));a=new Date(b)}else a=a[1]===void 0?new Date(a[0]):new Date(Date.UTC.apply(Date,y(a)));return a}
wa.prototype.L=function(a){var b=oa.apply(1,arguments);if(!b||!b.length)return a;var c="",d=a.split(/%([-+ 0#]*)([0-9]*|\*)(\.[0-9]+|)([bwhlL]?)([A-Za-z%])/),e=0,f;for(f=0;f<d.length-6;f+=6){c+=d[f];var g=d[f+5];if(this.g[g]===void 0)c+="%"+d[f+1]+d[f+2]+d[f+3]+d[f+4]+g;else{if(e<b.length){var h=b[e];g!="%"&&e++}else h=b[b.length-1];var k=!1,m=d[f+1],n=m.indexOf("#")>=0,r=m.indexOf("0")>=0,l=d[f+2];l=="*"?(l=h,h=e<b.length?b[e++]:b[b.length-1]):l=+l||0;var t=d[f+3];t=t?+t.substr(1):-1;var v=d[f+4],
w=null,A=0,x="",B="ACDFGHMNSTWY".indexOf(g)>=0&&typeof h!="object"?xa(h):h;switch(g){case "C":c+=isNaN(B.getTime())?void 0:this.L("%#W, %#F %#D, %#Y".replaceAll("#",n?"#":""),B);continue;case "D":h=n?B.getUTCDate():B.getDate();g="d";break;case "A":case "G":case "H":h=n?B.getUTCHours():B.getHours();g=="A"?(h=h<12?"am":"pm",g="s"):(g=="G"&&(h=h?h>12?h-12:h:12),g="d");break;case "F":case "M":h=n?B.getUTCMonth():B.getMonth();g=="F"?(h=ya[h],g="s"):(h++,g="d");break;case "N":h=n?B.getUTCMinutes():B.getMinutes();
g="d";break;case "S":h=n?B.getUTCSeconds():B.getSeconds();g="d";break;case "T":c+=isNaN(B.getTime())?void 0:this.L("%#Y-%#02M-%#02D %#02H:%#02N:%#02S".replaceAll("#",n?"#":""),B);continue;case "W":h=za[n?B.getUTCDay():B.getDay()];g="s";break;case "Y":h=n?B.getUTCFullYear():B.getFullYear(),t>0&&(h%=Math.pow(10,t)),g="d"}switch(g){case "b":c+=h?"true":"false";break;case "d":h=Math.trunc(h),t>=0&&(r=!0,l<t&&(l=t),t=-1);case "f":h=+h;g=h+"";t>=0&&(g=h.toFixed(t));g.length<l&&(r?(h<0&&(l--,g=g.substr(1)),
g=("0".repeat(l)+g).slice(-l),h<0&&(g="-"+g)):g=(" ".repeat(l)+g).slice(-l));c+=g;break;case "j":c+=JSON.stringify(h,null,l||void 0);break;case "c":h=typeof h=="string"?h[0]:String.fromCharCode(h);case "s":if(h!=void 0)for(typeof h!="string"&&(h=h.toString()),t>=0&&(h=h.substr(0,t));h.length<l;)h=m.indexOf("-")>=0?h+" ":" "+h;c+=h;break;case "B":A=2,n&&(x="0b");case "o":A||(A=8),!x&&n&&(x="0o");case "X":w=Aa;case "x":g="";A||(A=16);!x&&n&&(x="0x");w||(w=Ba);typeof h=="string"&&h[0]=="-"&&(k=!0,h=
h.slice(1));h=Math.trunc(h);k&&(h=-h);h<0&&((h|0)==h?h>>>=0:Math.abs(h)<=9007199254740992&&(h+=9007199254740992));t>=0&&(r=!0,l<t&&(l=t));r&&!l&&(v=="b"?l=2:v=="h"||v=="w"?l=4:v=="l"?l=8:(l=Math.abs(h),l=l<=255?2:l<=65535?4:l<=4294967295?8:9),l+=x.length);l-=x.length;do k=16,Number.isNaN(h)||(k=h&A-1,h=Math.trunc(h/A)),r||!g||k||h?g=w[k]+g:(x&&(g=x+g,x=""),l>0&&(g=" "+g));while(--l>0||h);c+=x+g;break;case "%":c+="%";break;default:c=this.g[g]?c+this.g[g](g,m,l,t,h):c+("(unimplemented sprintf type: %"+
g+")")}}}return c+=d[f]};var za="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),ya="January February March April May June July August September October November December".split(" "),Ba="0123456789abcdef?",Aa="0123456789ABCDEF?";function Ca(){ra.apply(this,arguments)}u(Ca,ra);function Da(a,b){var c=a/E|0,d=b/E|0;return(a&b)==(b|0)&&(c&d)==d}var E=4294967296;D.StdLib=Ca;function F(){Ca.call(this);this.format=new wa;this.X=this.format.L.bind(this.format)}u(F,Ca);
F.prototype.flush=function(){var a=Ea;Ea="";this.ua(a)};function Fa(a){var b=a,c=a.lastIndexOf("/");c>=0&&(b=a.substr(c+1));c=b.indexOf("&");c>0&&(b=b.substr(0,c));c=b.lastIndexOf(".");c>0&&(b=b.substring(0,c));return b}F.prototype.ua=function(a,b){var c=a.length,d=a.lastIndexOf("\n");b?d>=0&&(b=Date.now(),Ga||(Ga=b),a=((b-Ga)/1E3).toFixed(3)+": "+a,c=a.length):this.U=="node"?(ta.ue.write(a),a=""):(d>=0&&(console.log(Ea+a.slice(0,d)),Ea="",a=a.slice(d+1)),Ga=null);Ea+=a;return c};
F.prototype.u=function(a){return this.ua(this.X.apply(this,[a].concat(y(oa.apply(1,arguments)))))};var Ea="",Ga=null;D.StdIO=F;function G(a){F.call(this);this.S={};this.ga=0;this.L=this;a&&(this.L.ga=0,this.L.ta=[],this.L.ja=0,this.L.Ga={},this.L.ee=!1)}var Ha;u(G,F);p=G.prototype;
p.ya=function(a,b){var c=this,d=this;this.S[a]=b;switch(a){case Ia.Vb:b.onclick=function(){var e=c.Aa(Ia.Va,!0);e&&(e.value="")};break;case Ia.Va:Ja(b),b.addEventListener("keydown",function(e){Ka(d,e,!0)}),b.addEventListener("keypress",function(e){Ka(d,e)})}};
function La(a,b){b=b===void 0?{}:b;if(typeof document!="undefined"){a.config.S||(a.config.S=b);var c=Array.isArray(b);c?b.indexOf("container")<0&&b.push("container"):b.container||(b.container=a.U);for(var d in b){var e=b[d];if(c)d=e;else if(e.match(/^[0-9]+$/)){var f=+e;a.S[d]=[];do{e=d+f++;e=document.getElementById(e);if(!e)break;a.S[d].push(e)}while(1);continue}(f=document.getElementById(e))&&a.ya(d,f)}}}
function Ja(a){a.setAttribute("autocapitalize","off");a.setAttribute("autocomplete","off");a.setAttribute("autocorrect","off");a.setAttribute("spellcheck","false");a.value=""}p.error=function(a,b){b=this.X.apply(this,[a].concat(y(b)));var c="%s";a=!1;typeof c=="boolean"&&(a=c,c=b.shift());if(b=this.X.apply(this,[c].concat(y(b))))this.u("%s\n",b),a||alert(b)};p.Aa=function(a){return this.S[a]};
function Ma(a){var b=window;if(b){do{for(var c=0;c<Na.length;c++){var d=Na[c];d=d?d+a[0].toUpperCase():a[0];d+=a.substr(1);if(d in b)return d}if(a.indexOf("screen")<0)break;a=a.replace("screen","Screen")}while(1)}return null}function Oa(a,b){return a.config.bindings&&a.config.bindings[b]}function Pa(a){if(a=a.S[Qa])var b=a.textContent;return b}function Ra(a,b,c){a=+a||0;a<b&&(a=b);a>c&&(a=c);return a}
function H(a,b,c,d){a=a.config[b];a===void 0?a=c:(d&&d[a]!==void 0&&(a=d[a]),d=typeof c,typeof a!=d&&(d=="boolean"?a=!!a:typeof c=="number"&&(a=+a)));return a}
function Sa(a,b){var c=0,d=null,e=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){e.readyState!==4?b(a,d,e.readyState,c):(d=e.responseText,e.status==200||!e.status&&d.length&&(window?window.location.protocol:"file:")=="file:"||(c=e.status||-1),b(a,d,e.readyState,c))};e.open("GET",a,!0);e.send()}
function Ta(a){if(I.Ta===void 0){var b=!1;if(window)try{window.localStorage.setItem(I.xa,I.xa),b=window.localStorage.getItem(I.xa)==I.xa,window.localStorage.removeItem(I.xa)}catch(c){a.u("%s\n",c.message),b=!1}I.Ta=b}return!!I.Ta}function J(a,b){b=b===void 0?0:b;b>1&&b%2&&b--;b=b||a.ga;return(b|1)==-1||Da(a.L.ga,b)?!0:!1}
function Ua(a){if(window){var b=window.navigator.userAgent;return a=="iOS"&&(!!b.match(/(iPod|iPhone|iPad)/)||window.navigator.platform==="MacIntel"&&window.navigator.maxTouchPoints>1)||a=="MSIE"&&!!b.match(/(MSIE|Trident)/)||b.indexOf(a)>=0}return!1}function Va(a){var b=null;if(Ta(a)){var c;if(window)try{(c=window.localStorage.getItem(a.M))&&(b=JSON.parse(c))}catch(d){a.u("%s\n",d.message)}}return b}
function Ka(a,b,c){b=b||window.event;var d=b.which||b.keyCode;if(d){var e=a.L,f=b.target;if(c){a=!1;var g;c=f.value;var h=c.lastIndexOf("\n");d==K.bb&&f.selectionStart<=h+1&&(a=!0);d==K.Cc?(a=!0,e.ja>0&&(g=e.ta[--e.ja])):d==K.Yb&&(a=!0,e.ja<e.ta.length&&(g=e.ta[++e.ja]||""));a&&b.preventDefault();g!=void 0&&(f.value=c.substr(0,h+1)+g)}else d=String.fromCharCode(d),g=f.value,c=g.lastIndexOf("\n"),f.selectionStart<=c&&f.setSelectionRange(g.length,g.length),b.stopPropagation(),d=="@"&&e.ja>0&&c+1==g.length&&
(f.value+=e.ta[--e.ja],d="\r"),d=="\r"&&(b.preventDefault(),g=f.value+="\n",f.blur(),f.focus(),(b=Wa(a,g.slice(g.lastIndexOf("\n",g.length-2)+1,-1)||""))&&a.u("%s\n",b.replace(/\n$/,"")))}}
function Xa(a,b){if(b!=void 0){var c=a.L;try{if(b=b.trim())c.ja<c.ta.length&&b==c.ta[c.ja]?c.ja++:(c.ta.push(b),c.ja=c.ta.length);var d=b.split(" "),e=d[0],f=a.L.Ga[Ya.fb];switch(e[0]){case "m":if(e[1]=="?"){var g="";Za.forEach(function(r){g+=r+"\n"});g&&(g="message commands:\n"+g);break}g="";var h=void 0;e=d[d.length-1].toLowerCase();var k=e=="true"||e=="on"?!0:e=="false"||e=="off"?!1:void 0;k!=void 0&&d.pop();d.length<=1&&(k!=void 0&&(h=k,k=void 0),d[1]="all");d[1]=="all"&&(d=Object.keys(va));for(f=
1;f<d.length;f++){e=d[f];var m=va[e];if(!m){g+="unrecognized message: "+e+"\n";break}k!=void 0&&$a(a,m,k);if(h==void 0||h==J(a,m))g+=a.X("%8s: %b\n",e,J(a,m))}J(a,0x800000000000)&&(g+="all messages will be buffered until buffer is turned off\n");g||(g="no messages\n");break;case "?":g="",ab.forEach(function(r){g+=r+"\n"}),g&&(g="default commands:\n"+g);default:if(d.unshift(b),f)for(a=0;a<f.length;a++){var n=f[a](d);if(n!=void 0){g=g?g+n:n;break}}}}catch(r){g="error: "+r.message+"\n"}}return g}
function Wa(a,b){b=b===void 0?"?":b;if(b){var c="";b=b.split(/(?:\n|;\s*)/);for(var d=0;d<b.length;d++)c+=Xa(a,b[d])}return c}
p.ua=function(a,b){b==void 0&&(b=J(this,0x800000000000));if(!b){var c=this.Aa(Ia.Va,!0);if(c){b=c.selectionStart;for(var d=a.split(/([\n\r\b])/),e=0;e<d.length;e++){var f=d[e];if(f)if(f=="\b"||f=="\r")for(;b>0&&c.value.slice(b-1,b)!="\n"&&(b--,f!="\b"););else if(f=="\n"){for(f="";b<c.value.length&&(f=c.value[b],b++,f!="\n"););f!="\n"&&(c.value+="\r\n",b=c.value.length)}else c.value=c.value.slice(0,b)+f+c.value.slice(b+f.length),b+=f.length}c.focus();c.setSelectionRange(b,b);c.value.length>=8192&&
(c.value=c.value.slice(c.value.length-8192+4096));c.scrollTop=c.scrollHeight;return a.length}}return F.prototype.ua.call(this,a,b)};p.u=function(a){var b=oa.apply(1,arguments),c=0;typeof a=="number"&&(c=a,a=b.shift());return J(this,c)?(Da(c,1099511627776)&&(a="error: "+a),Da(c,549755813888)&&(a="warning: "+a),F.prototype.u.call.apply(F.prototype.u,[this,a].concat(y(b)))):0};function bb(a,b){if(Ta(a)){b=JSON.stringify(b);try{window.localStorage.setItem(a.M,b)}catch(c){a.u("%s\n",c.message)}}}
function L(a,b,c){(a=a.S[b])&&a.textContent!=c&&(a.textContent=c)}function $a(a,b,c){var d=!1;c?(c=a.L.ga,a.L.ga=(c|b)+(c/E|0|b/E|0)*E):(d=Da(a.L.ga,0x800000000000)&&Da(b,0x800000000000),c=a.L.ga,a.L.ga=(c&~b)+((c/E|0)&~(b/E|0))*E);d&&a.flush()}
var Ia={Vb:"clear",Va:"print"},ab=["\u2191 \u2193\t\trecall commands","@\t\trepeat last command","m?\t\tmessage commands"],Za=["m\t\tdisplay all messages","m on\t\tdisplay all active messages","m off\t\tdisplay all inactive messages","m all [on|off]\tturn all messages on or off","m ... [on|off]\tturn selected messages on or off"],Ya={fb:"command"},cb={gb:13,Sa:65,ab:66,cb:67,hb:68,E:69,ib:70,jb:71,kb:72,lb:73,mb:74,ob:75,qb:76,sb:77,ub:78,xb:79,zb:80,Q:81,Ab:82,Cb:83,Db:84,Eb:85,Fb:86,Gb:87,Hb:88,
Ib:89,Xa:90,a:97,b:98,c:99,d:100,e:101,f:102,ne:103,oe:104,pe:105,qe:106,k:107,re:108,se:109,n:110,te:111,p:112,q:113,r:114,s:115,t:116,we:117,xe:118,w:119,x:120,y:121,z:122},K={bb:8,yc:9,kc:10,gb:13,uc:16,Wb:17,Ub:18,Vd:19,Ua:20,Wc:27,wc:32,Yd:33,Xd:34,Vc:35,rd:36,rb:37,Cc:38,Wa:39,od:39,Yb:40,ld:44,Zd:44,sd:45,Uc:46,nd:46,qd:47,ZERO:48,ONE:49,Ac:50,zc:51,fc:52,ec:53,vc:54,tc:55,Zb:56,lc:57,dc:59,cc:61,Sa:65,ab:66,cb:67,hb:68,E:69,ib:70,jb:71,kb:72,lb:73,mb:74,ob:75,qb:76,sb:77,ub:78,xb:79,zb:80,
Q:81,Ab:82,Cb:83,Db:84,Eb:85,Fb:86,Gb:87,Hb:88,Ib:89,Xa:90,eb:91,md:91,kd:92,be:93,pd:93,wd:96,Nd:96,jd:96,xd:97,Ld:97,yd:98,Kd:98,zd:99,Qd:99,Ad:100,Od:100,Bd:101,Hd:101,Cd:102,Sd:102,Dd:103,Md:103,Ed:104,Ud:104,Fd:105,Rd:105,Pd:106,Gd:107,Td:109,Id:110,Jd:111,Xc:112,ad:113,bd:114,cd:115,dd:116,ed:117,fd:118,gd:119,hd:120,Yc:121,Zc:122,$c:123,mc:144,rc:145,bc:173,sc:186,$b:187,Tc:188,Xb:189,Wd:190,de:191,Rc:192,td:219,Sc:220,ae:221,$d:222,ac:224,ud:901,fe:1E3},db={},eb=(db[K.dc]=K.sc,db[K.cc]=K.$b,
db[K.bc]=K.Xb,db[K.ac]=K.eb,db),fb={rb:1,Wa:2,vd:3},M={},gb=(M[K.bb]="\b",M[K.yc]="\t",M[K.kc]="\n",M[K.gb]="\r",M[K.wc]=" ",M[K.ZERO]="0",M[K.ONE]="1",M[K.Ac]="2",M[K.zc]="3",M[K.fc]="4",M[K.ec]="5",M[K.vc]="6",M[K.tc]="7",M[K.Zb]="8",M[K.lc]="9",M[K.Sa]="A",M[K.ab]="B",M[K.cb]="C",M[K.hb]="D",M[K.E]="E",M[K.ib]="F",M[K.jb]="G",M[K.kb]="H",M[K.lb]="I",M[K.mb]="J",M[K.ob]="K",M[K.qb]="L",M[K.sb]="M",M[K.ub]="N",M[K.xb]="O",M[K.zb]="P",M[K.Q]="Q",M[K.Ab]="R",M[K.Cb]="S",M[K.Db]="T",M[K.Eb]="U",M[K.Fb]=
"V",M[K.Gb]="W",M[K.Hb]="X",M[K.Ib]="Y",M[K.Xa]="Z",M[K.rb]="Left",M[K.Wa]="Right",M),Na=["","moz","ms","webkit"],hb={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",
darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",
fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",
lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",
navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",
seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},I={Ta:void 0,xa:"PCjs.localStorage"};D.WebIO=G;
function N(a,b,c,d){a=a===void 0?"default":a;b=b===void 0?a:b;c=c===void 0?{}:c;d=d===void 0?[]:d;G.call(this,a==b);this.M=a;this.U=b;C[this.M]||(C[this.M]={});C[this.M][this.U]&&this.u("warning: machine configuration contains multiple '%s' devices\n",this.U);C[this.M][this.U]=this;this.id=this.M==this.U?this.M:this.M+"."+this.U;ua.push(this);this.L=O(this,this.M);this.ready=!0;ib(this,c,d);this.xc={};this.pb=[]}u(N,G);
function ib(a,b,c){c=b.overrides||c;if(c.length){var d,e=Ha;if(!e){e={};if(window){d||(d=window.location.search.slice(1));for(var f,g=/\+/g,h=/([^&=]+)=?([^&]*)/g;f=h.exec(d);)e[decodeURIComponent(f[1].replace(g," ")).trim()]=decodeURIComponent(f[2].replace(g," ")).trim()}Ha=e}d=e;for(var k in d)if(c.indexOf(k)>=0){e=d[k];f=void 0;var m;g=void 0;h=e;var n=10;if(h){n||(n=10);var r=h.indexOf(",")>0;r&&(h=h.replace(/,/g,""));var l=m=h.charAt(0);m=="#"?(n=8,m=""):m=="$"&&(n=16,m="");l!=m?h=h.substr(1):
(l=m=h.substr(0,2),m=="0b"&&r||m=="^B"?(n=2,m=""):m=="0o"||m=="^O"?(n=8,m=""):m=="^D"?(n=10,m=""):m=="0x"&&(n=16,m=""),l!=m&&(h=h.substr(2)));l=m=h.slice(-1);m=="Y"||m=="y"?(n=2,m=""):m=="."?(n=10,m=""):m=="H"||m=="h"?(n=16,m=""):m=="K"?m="000":m=="M"?m="000000":m=="G"&&(m="000000000");l!=m&&(h=h.slice(0,-1)+m);l=0;n<=10&&(m=h.match(/(-?[0-9]+)B([0-9]*)$/))&&(h=m[1],l=35-((m[2]||35)&255));(n&&n!=10?n==16?h.match(/^-?[0-9a-f]+$/i)===null:n==8?h.match(/^-?[0-7]+$/)===null:n!=2||h.match(/^-?[01]+$/)===
null:h.match(/^[+-]?[0-9]+$/)===null)||isNaN(f=parseInt(h,n))||(l&&(f<0&&(f+=68719476736),f=l>0?f*Math.pow(2,l):Math.trunc(f/Math.pow(2,-l))),g=f)}f=g;f==void 0&&(e=="true"?f=!0:e=="false"?f=!1:(f=e,e='"'+e+'"'));b[k]=f;a.u("overriding %s property '%s' with %s\n",a.U,k,e)}}a.config=b;La(a,b.bindings);b=b===void 0?{}:b;a.version=3;if(a.version){c="";var t;a.M!=a.U&&(t=O(a,a.M).version)&&t!=a.version&&(c="Machine");c||(t=b.version)&&t>a.version&&(c="Config");c&&(t=a.X("%s Device version (%3.2f) incompatible with %s version (%3.2f)",
b.je,a.version,c,t),a.error("%s\n\nClearing your browser's cache may resolve the issue.",t))}}function jb(a,b){var c;try{var d=C[a.M];if(d)for(c in d){var e=d[c];if(e.U!=e.M&&!b(e))return!1}return!0}catch(f){a.u("error while enumerating device '%s': %s\n",c,f.message)}return!1}N.prototype.Aa=function(a,b){b=b===void 0?!1:b;if(a){var c=G.prototype.Aa.call(this,a,b);if(c===void 0&&b){b=C[this.M];for(var d in b)if(c=b[d].S[a])break;c||(c=null);this.S[a]=c}}return c};
function O(a,b,c){var d=b,e=a.M,f=e.indexOf(".");f>0&&(e=e.substr(0,f),b=b.substr(f+1));b=(f=C[e])&&f[b]||null;if(!b){for(f=0;f<ua.length;f++)if(ua[f].id===d){b=ua[f];break}if(!b&&(c===void 0||c))throw Error(a.X('no "%s" device',d));}return b}function P(a,b,c){var d=null,e=C[a.M];if(e)for(var f in e)if(e[f].config["class"]==b){if(d){d=null;break}d=e[f]}if(!d&&(c===void 0||c))throw Error(a.X("no %s device",b));return d}function Q(a){return a==a.L&&a.ready?jb(a,function(b){return Q(b)}):a.ready}
function kb(a,b){b=b===void 0?a.ready:b;a.ready=b;if(Q(a)){for(;b=a.pb.pop();)b();a!=a.L&&kb(a.L)}}function lb(a,b){if(Q(a))return b(),!0;a.pb.push(b);return!1}
N.prototype.u=function(a){var b=oa.apply(1,arguments);return typeof a=="number"&&J(this,a)&&(this.fa===void 0&&(this.fa=P(this,"Debugger",!1)),this.L.ga&1&&(this.da===void 0&&(this.da=P(this,"CPU")),this.da))?(a=b.shift(),G.prototype.u.call(this,"%#06x: %s.%s\n",this.da.Pa,this.U,this.X.apply(this,[a].concat(y(b))).trim())):G.prototype.u.call.apply(G.prototype.u,[this,a].concat(y(b)))};function mb(a,b){(a=C[a.M])&&delete a[b]}N.prototype.Pb=function(a,b){(a=this.xc[a])&&a.set&&a.set(b)};
D.Device=N;
function nb(a,b,c){N.call(this,a,b,c);this.ga=2097152;this.K=this.O=null;this.time=P(this,"Time");this.L=P(this,"Machine");this.ba=H(this,"drag",!1);this.Y=H(this,"scroll",!1);this.aa=H(this,"hexagonal",!1);this.v=H(this,"releaseDelay",0);this.H=!1;a=this.config.map;this.h=this.j=null;if(a)if(a.length)this.h=a;else{this.j={};b=Object.keys(a);for(var d=0;d<b.length;d++){var e=[],f=b[d],g=a[f];typeof g=="string"?g=[g]:g.length==void 0&&(e=g.grid,g=g.keys,typeof g=="string"&&(g=[g]));this.j[f]={keys:g,
grid:e,state:0}}}this.R=[];this.T=[];this.m=this.V=null;(a=this.S[ob])&&pb(this,a,this.Aa(c.focusBinding,!0),this.config.location);this.qa()}u(nb,N);function qb(a,b){a.O=b}function rb(a,b,c){for(var d=0;d<a.R.length;d++){var e=a.R[d];e.id===b&&e.Nb(b,c)}}
function pb(a,b,c,d){d=d===void 0?[]:d;if(d.length||a.h||a.j){var e={};e.Pc=d[0]||0;e.Qc=d[1]||0;e.za=d[2]||b.clientWidth;e.Ka=d[3]||b.clientHeight;e.La=d[4]||1;e.Qa=d[5]||1;e.Gc=d[6]||b.naturalWidth||e.za;e.Ic=d[7]||b.naturalHeight||e.Ka;e.Sb=d[8]||0;e.Tb=d[9]||0;e.Fc=d[10]||0;e.Hc=d[11]||0;a.h?(e.Na=a.h.length,e.Ba=a.h[0].length):(e.Ba=e.La,e.Na=e.Qa,e.La=e.Qa=0);e.Jb=e.za/(e.Ba+e.Ba*e.La)|0;e.Kb=e.Ka/(e.Na+e.Na*e.Qa)|0;e.Ec=e.Jb*e.La|0;e.Lb=e.Kb*e.Qa|0;e.Fa=e.Ra=-1;sb(a,b,e);tb(a,b,e);a.time&&
a.v&&(a.$=ub(a.time,"timerInputRelease",function(){e.Fa<0&&e.Ra<0&&vb(a,-1,-1)}))}if(a.h||a.j)a.time&&a.v&&(a.ca=ub(a.time,"timerKeyRelease",function(){wb(a)})),a.I=0,a.N="",a.J=[],d=b,c&&(d=c,a.m||c.nodeName!="BUTTON"||(d=document,a.m=c,xb(a,b),a.V=b)),xb(a,d),a.m||(a.m=d)}function yb(a){a.v?zb(a.time,a.ca,a.v):wb(a)}
function xb(a,b){function c(e,f,g){var h=document.activeElement;a.u(5242880,"%s.onKey%s(%d): %5.2f (%s)\n",h.id||h.nodeName,e,f,Date.now()/1E3%60,g!=void 0?g?"used":"unused":"ignored")}function d(e,f){e=document.activeElement;return a.m&&e!=a.m&&e!=a.V?null:f||window.event}b.addEventListener("keydown",function(e){if(e=d(this,e)){var f=e.which||e.keyCode,g=Ab(a,f,!0,e);c("Down",f,g);g&&e.preventDefault()}});b.addEventListener("keypress",function(e){if(e=d(this,e)){var f=e.which||e.charCode,g=Ab(a,
f);c("Press",f,g);g&&e.preventDefault()}});b.addEventListener("keyup",function(e){if(e=d(this,e)){var f=e.which||e.keyCode,g=Ab(a,f,!1,e);c("Up",f);g&&e.preventDefault();b.nodeName=="TEXTAREA"&&(b.value="")}})}
function sb(a,b,c){b.addEventListener("mousedown",function(d){if(!a.H){var e=a.m;if(e){var f=window.scrollX,g=window.scrollY;e.focus();window.scrollTo(f,g)}d.button||R(a,b,Bb,d,c)}});b.addEventListener("mousemove",function(d){a.H||R(a,b,Cb,d,c)});b.addEventListener("mouseup",function(d){a.H||d.button||R(a,b,S,d,c)});b.addEventListener("mouseout",function(d){a.H||(c.Fa<0?R(a,b,Cb,d,c):R(a,b,S,d,c))})}
function tb(a,b,c){b.addEventListener("touchstart",function(d){a.Y&&(a.H=!0);R(a,b,Bb,d,c)});b.addEventListener("touchmove",function(d){R(a,b,Cb,d,c)});b.addEventListener("touchend",function(d){R(a,b,S,d,c)})}
function Ab(a,b,c,d){if(c!=void 0){var e=eb[b]||b;var f=gb[b];var g=Db[e];d=d&&d.location==fb.Wa;g&Eb&&d&&(g>>=1);g&&(g&Fb&&(c=!(a.g&g)),a.g=c?a.g|g:a.g&~g,rb(a,e,c))}else f=String.fromCharCode(b).toUpperCase(),b>=cb.Sa&&b<=cb.Xa?a.g&(Gb|Hb)||(a.g|=Hb,rb(a,K.Ua,!0)):b>=cb.a&&b<=cb.z&&a.g&Hb&&(a.g&=~Hb,rb(a,K.Ua,!1));if(a.h){if(c!=void 0)return!1;for(e=0;e<a.h.length;e++)for(g=a.h[e],d=0;d<g.length;d++)if(g[d].split("|").indexOf(f)>=0)return a.I?a.J.length<16&&a.J.push(b):(a.I=1,a.N=f,vb(a,d,e),rb(a,
f,!0),yb(a)),!0}if(a.j){if(c==void 0)return!0;b=Object.keys(a.j);for(e=0;e<b.length;e++)if(g=b[e],a.j[g].keys.indexOf(f)>=0)return rb(a,g,c),a.j[g].state=c?1:0,!0}return!1}function wb(a){a.I==1?(a.I++,rb(a,a.N,!1),a.N="",vb(a,-1,-1),yb(a)):(a.I=0,a.J.length&&Ab(a,a.J.shift()))}nb.prototype.qa=function(){this.g=0;this.W=this.Z=-1};
function R(a,b,c,d,e){var f=-1,g=-1,h=!1,k=-1,m=-1;if(c<S){d=d||window.event;d.targetTouches&&d.targetTouches.length?(k=d.targetTouches[0].clientX,m=d.targetTouches[0].clientY,h=d.targetTouches.length>1):(k=d.clientX,m=d.clientY);var n=d.target.getBoundingClientRect();k-=n.left;m-=n.top;k=e.Gc/b.offsetWidth*k|0;m=e.Ic/b.offsetHeight*m|0;var r=k-e.Pc;var l=m-e.Qc;var t=n=!1;var v=k>=e.Sb&&k<e.Sb+e.Fc&&m>=e.Tb&&m<e.Tb+e.Hc;if(r>=0&&r<e.za&&l+e.Lb>=0||v)if(h||a.Y||d.preventDefault(),r>=0&&r<e.za&&l>=
0&&l<e.Ka){t=!0;d=e.za/e.Ba|0;var w=e.Ka/e.Na|0,A=r/d|0,x=l/w|0;!a.aa||x&1||(r-=d>>1,A=r/d|0,A==e.Ba-1&&(r=-1));w=x*w+(e.Lb>>1);r-=A*d+(e.Ec>>1);l-=w;r>=0&&r<e.Jb&&l>=0&&l<e.Kb&&(f=A,g=x,n=!0)}}r=r||0;l=l||0;d=b.offsetWidth;b=b.offsetHeight;if(c==Bb||c==S)for(A=0;A<a.T.length;A++)x=a.T[A],c==S?x.Nb(x.id,!1):(w=l/(b/x.le|0)|0,(r/(d/x.ke|0)|0)==x.ye&&w==x.ze&&x.Nb(x.id,!0));if(!h)if(c==Bb)e.Fa=k,e.Ra=m,t?(vb(a,f,g),n&&a.v&&zb(a.time,a.$,a.v,!0)):v&&a.L.ia();else if(c==Cb)e.Fa>=0&&e.Ra>=0&&a.ba?vb(a,
f,g):a.O&&a.O(f,g);else if(c==S){if(c=a.v)c=a.time,f=a.$,c=c.g&&f>0&&f<=c.h.length?c.h[f-1].ha>=0:!1;c||vb(a,-1,-1);e.Fa=e.Ra=-1}else a.u("unrecognized action: %d\n",c)}function vb(a,b,c){if(b!=a.W||c!=a.Z)a.W=b,a.Z=c,a.K&&a.K(b,c)}var Bb=1,Cb=2,S=3,ob="surface",Gb=3,Eb=170,Hb=512,Fb=3584,T={},Db=(T[K.uc]=2,T[K.Wb]=8,T[K.Ub]=32,T[K.eb]=128,T[K.Ua]=Hb,T[K.mc]=1024,T[K.rc]=2048,T);D.Input=nb;
function Ib(a,b,c){N.call(this,a,b,c,["color","backgroundColor"]);a=this.S[Jb];if(!a)throw Error("LED "+this.config.S[Jb]+" binding for '"+Jb+"' missing");b=document.createElement("canvas");if(!b||!b.getContext)throw a.innerHTML="LED device requires HTML5 canvas support",Error("LED device requires HTML5 canvas support");this.sa=Oa(this,Jb)+".canvas";b.setAttribute("id",this.sa);this.type=Ra(H(this,"type",Kb,Lb),Mb,Nb);this.j=Ob[this.type][0];this.I=Ob[this.type][1];this.width=H(this,"width",this.j);
this.height=H(this,"height",this.I);this.m=H(this,"cols",1);this.O=this.m+H(this,"colsExtra",0);this.aa=H(this,"rows",1);this.V=this.aa+H(this,"rowsExtra",0);this.ca=this.width*this.m;this.Y=this.height*this.aa;this.H=Pb("black",0);this.h=Qb(this.config.color)||this.H;this.ma=Pb(this.h,1,.25);this.la=Pb(this.h,1,2);this.v=Qb(this.config.backgroundColor);this.na=H(this,"fixed",!1);this.na||(b.style.width="100%",b.style.height="auto");this.ka=H(this,"hexagonal",!1);this.oa=H(this,"highlight",!0);this.W=
H(this,"persistent",this.type<Nb);b.setAttribute("width",this.ca.toString());b.setAttribute("height",this.Y.toString());b.style.backgroundColor=this.H;a.appendChild(b);this.ea=b.getContext("2d");if(this.J=document.createElement("canvas"))this.J.width=this.ba=this.j*this.m,this.J.height=this.K=this.I*this.aa,this.g=this.J.getContext("2d");this.va=(this.V+1)*this.O*4;this.buffer=Array(this.va);this.Ha=this.m<this.O?(this.O-this.m)*4:0;this.R=this.T=!1;this.N=this.$=0;this.Z=-1;var d=this;this.time=
P(this,"Time");Rb(this.time,function(e,f){Sb(d,!1,e,f)});Tb(d)}u(Ib,N);function Tb(a){for(var b=a.buffer,c=0;c<b.length;c+=4){var d=a,e=b,f=c;e[f]=d.type<Nb?Ub:" ";e[f+1]=d.h==d.H?null:d.h;e[f+2]=0;e[f+3]=Vb}a.R=a.T=!0;Sb(a,!0)}function Wb(a){a.v?(a.g.fillStyle=a.v,a.g.fillRect(0,0,a.ba,a.K)):a.g.clearRect(0,0,a.ba,a.K)}
function Sb(a,b,c,d){b=b===void 0?!1:b;c=c===void 0?0:c;d=d===void 0?60:d;if(a.R||b){if(a.type<Nb){d=0;if(!a.W||b)Wb(a);else if(a.N){d=a.m-a.N;var e=a.j*d;a.g.drawImage(a.J,a.j*a.N,0,e,a.K,0,0,e,a.K)}for(var f=e=0;f<a.V;f++){for(var g=0;g<a.m;g++){var h=a.buffer[e],k=a.buffer[e+1]||a.H,m=a.oa&&e==a.Z;if(a.buffer[e+3]&Vb||m||b){if(g>=d)a:{var n=a,r=h;h=k;var l=g;k=f;var t=m;l=l===void 0?0:l;k=k===void 0?0:k;t=t===void 0?!1:t;var v=0;if(n.ka&&!(k&1)&&(v=n.j>>1,l==n.m-1))break a;if(h&&h!=n.h){t=t?Pb(h,
1,2):h;var w=Pb(h,1,.25)}else t=t?n.la:n.h,w=n.ma;h=!1;r=r?t:w;t==n.H&&(r=n.v,h=!0);t=l*n.j+v;w=k*n.I;n.W&&(l=l*n.j+v,k*=n.I,n.v?(n.g.fillStyle=n.v,n.g.fillRect(l,k,n.j,n.I)):n.g.clearRect(l,k,n.j,n.I));n.g.fillStyle=r;k=Xb[n.type];k.length==3?(n.g.beginPath(),n.g.arc(t+k[0],w+k[1],k[2],0,Math.PI*2),h?(n.g.globalCompositeOperation="destination-out",n.g.fill(),n.g.globalCompositeOperation="source-over"):n.g.fill()):n.g.fillRect(t+k[0],w+k[1],k[2],k[3])}a.buffer[e+3]=m?a.buffer[e+3]|Vb:a.buffer[e+3]&
~Vb}e+=4}e+=a.Ha}a.N=0}else{b="";for(d=0;d<a.buffer.length;d+=4)b+=a.buffer[d]||" ",a.buffer[d+3]&Yb&&(b+=".");Wb(a);for(f=e=d=0;d<b.length;d++){m=b[d];m=="."&&e&&e--;g=a;k=m;m=e;n=f;m=m===void 0?0:m;n=n===void 0?0:n;if(k=Zb[k])for(h=0;h<k.length;h++)if(l=g,v=$b[k[h]]){r=(m===void 0?0:m)*l.j;t=(n===void 0?0:n)*l.I;l.g.fillStyle=l.h;l.g.beginPath();if(v.length==3)l.g.arc(r+v[0],t+v[1],v[2],0,Math.PI*2);else for(w=0;w<v.length;w+=2)w?l.g.lineTo(r+v[w],t+v[w+1]):l.g.moveTo(r+v[w],t+v[w+1]);l.g.closePath();
l.g.fill()}if(++e==a.m&&(e=0,++f==a.V))break}}a.ea.globalCompositeOperation=a.v&&a.h!=a.H?"source-over":"copy";a.ea.drawImage(a.J,0,0,a.ba,a.K,0,0,a.ca,a.Y);a.R=!1;a.Z=-1}else a.W||a.T||(!c||!a.$||c-a.$>=(1E3/d|0))&&Tb(a);a.T=!1;c&&(a.$=c)}function Qb(a){return(a=a||void 0)&&hb[a]||a}
function Pb(a,b,c){b=b===void 0?1:b;c=c===void 0?1:c;if(a){var d=[];a=hb[a]||a;var e=a;var f=16;var g=e.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);g||(f=10,g=e.match(/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,?\s*(\d+|)\)$/i));if(g){for(e=1;e<g.length;e++)d[e-1]=Number.parseInt(g[e],f);d.length=e-1;f=!0}else f=!1;if(f){a="rgba(";for(f=0;f<3;f++)g=Math.round(d[f]*c),g=g<0?0:g>255?255:g,a+=g+",";a+=(f<d.length?d[f]:b)+")"}}return a}
Ib.prototype.pa=function(a){var b=a.shift(),c=a.shift();a=a.shift();if(b==this.h&&c==this.v&&a&&a.length==this.buffer.length){this.buffer=a;for(b=0;b<=this.buffer.length-4;b+=4)this.buffer[b+1]==this.H&&(this.buffer[b+1]=null);Sb(this,!0);return!0}return!1};Ib.prototype.ra=function(a){this.buffer&&(a.push(this.h),a.push(this.v),a.push(this.buffer))};
function ac(a,b,c,d,e){var f=!1;e=(e===void 0?0:e)&bc;b=(c*a.O+b)*4;if(b<=a.buffer.length-4){if(a.buffer[b]!==d||(a.buffer[b+3]&bc)!==e)a.buffer[b]=d,a.buffer[b+3]=a.buffer[b+3]&~bc|e|Vb,a.R=f=!0;a.Z=b;a.T=!0;a.N=0}return f}
var Mb=0,Kb=1,Nb=3,Lb={small:Mb,round:Kb,square:2,digit:Nb},Jb="container",Ub=0,bc=129,Yb=1,Vb=128,cc={},Xb=(cc[Mb]=[4,4,4],cc[Kb]=[16,16,14],cc[2]=[2,2,28,28],cc),Ob=[[8,8],[32,32],[32,32],[96,128]],$b={A:[30,8,79,8,67,19,37,19],B:[83,10,77,52,67,46,70,22],C:[77,59,71,100,61,89,64,64],D:[28,91,58,91,69,104,15,104],E:[18,59,28,64,25,88,12,100],F:[24,10,34,21,31,47,18,52],G:[24,56,34,50,60,50,71,56,61,61,33,61],P:[80,102,8]},Zb={" ":[],0:"ABCDEF".split(""),1:["B","C"],2:["A","B","D","E","G"],3:["A",
"B","C","D","G"],4:["B","C","F","G"],5:["A","C","D","F","G"],6:"ACDEFG".split(""),7:["A","B","C"],8:"ABCDEFG".split(""),9:"ABCDFG".split(""),A:"ABCEFG".split(""),B:["C","D","E","F","G"],C:["A","D","E","F"],D:["B","C","D","E","G"],E:["A","D","E","F","G"],F:["A","E","F","G"],"-":["G"],".":["P"]};D.LED=Ib;
function dc(a,b,c){N.call(this,a,b,c);this.oa=H(this,"cyclesMinimum",1E5);this.wb=H(this,"cyclesMaximum",1E9);this.sa=Ra(H(this,"cyclesPerSecond",1E6),this.oa,this.wb);this.ba=60;this.W=0;this.Y=1E3/this.ba;this.qc=H(this,"updatesPerSecond",2)||2;this.oc=1E3/this.qc;this.tb=0;this.Bc=H(this,"timeLock",!0);this.ma=this.R=0;this.la=this.I=1;this.Ha=this.K=this.sa/1E4/100;this.ea=[];this.N=[];this.h=[];this.ka=[];this.va=this.g=this.ca=this.J=!1;this.O=this.m=0;a=Ma("requestAnimationFrame");if(!a){a=
"setTimeout";var d=this.Y}this.yb=window[a].bind(window,this.Mc.bind(this),d);this.nc=window[Ma("cancelAnimationFrame")||"clearTimeout"].bind(window);this.aa=this.$=this.v=this.j=this.na=0;ec(this)||fc(this,this.la)}u(dc,N);function Rb(a,b){a.ea.push(b)}p=dc.prototype;
p.ya=function(a,b){var c=this;switch(a){case hc:b.onclick=function(){ic(c)&&(c.g?U(c):c.start())};break;case jc:b.onclick=function(){fc(c,c.I<<1);kc(c,lc(c.K))};break;case mc:b.onclick=function(){nc(c)};break;case oc:b.addEventListener("mousedown",function(){c.J=!0}),b.addEventListener("mouseup",function(){ec(c);c.J=!1}),b.addEventListener("mousemove",function(){c.J&&ec(c)}),b.addEventListener("change",function(){c.J=!0;ec(c);c.J=!1})}N.prototype.ya.call(this,a,b)};
function ub(a,b,c){var d=d===void 0?-1:d;var e=a.h.length+1;a.h.push({id:b,Dc:c,Ma:d,ha:-1});d>=0&&zb(a,e,d);return e}
function pc(a,b,c,d){var e=0,f=a.K,g=f*1E6;b&&c&&(f=b/(c*10)/100,a.u(262144,"calcSpeed(%d cycles, %5.3fms): %5.3fMhz\n",b,c,f),d>a.Y&&(a.I>1&&(a.I>>=1,a.u(549755813888,"frame time (%5.3fms) exceeded maximum (%5.3fms), target multiplier now %d\n",d,a.Y,a.I)),e=d));a.R=f;a.ma=f/a.Ha;b=a.ma/a.I;a.na=g/b/a.ba+1E-8;a.u(262144,"nCyclesDepositPerFrame(%5.3f) = nCyclesPerSecond(%d) / nDivisor(%5.3f) / nFramesPerSecond(%d)\n",a.na,g,b,a.ba);return e}
function qc(a,b){a.$=a.v=b;if(!a.N.length)return a.v=0,a.$;for(var c=0;a.v>0;){if(c<a.N.length){var d=a.N[c++];b=d.Nc.call(d,b)||1}else c=b=0;a.v-=b}return a.$-a.v}function rc(a,b){var c=Date.now();b()&&(a.Z+=Date.now()-c)}function sc(a,b){b=b===void 0?a.$-a.v:b;if(!a.g){if(a.j)for(var c=0;c<a.N.length;c++){var d=a.N[c];d.Qb.call(d)}a.j=b}a.j-=b;a.j<1&&(a.ca=!0);a.aa+=b;a.$=a.v=0;a.g||(a.aa=0);return b}
function tc(a,b){b=b===void 0?0:b;if(b){var c=b;a.j+=b}else for(c=a.j,c<1&&(c=a.j+=a.na),c<0&&(a.u(262144,"warning: cycle count dropped below zero: %f\n",c),c=a.j=0),c|=0,b=a.h.length;b>0;b--){var d=a.h[b-1];!(d.ha<0)&&c>d.ha&&(c=d.ha)}return c}function lc(a){a>=1?a=a.toFixed(2)+"Mhz":(a=Math.round(a*1E6),a=a<=999?a+"Hz":Math.ceil(a/1E3)+"Khz");return a}function ic(a){return a.va?!0:(a.u("not powered\n"),!1)}
function uc(a,b){if(b>=1)for(var c=a.h.length;c>0;c--){var d=a.h[c-1];d.ha<0||(d.ha-=b,d.ha<=0&&(d.ha=-1,d.Dc(),d.Ma>=0&&zb(a,c,d.Ma)))}}p.ia=function(a){this.va=a;this.fa===void 0&&(this.fa=P(this,"Debugger",!1))};function nc(a,b){ic(a)&&(a.g?a.u("already running\n"):a.m?U(a):vc(a,b))}
p.Mc=function(a){a=a===void 0?Date.now():a;this.O=0;if(this.g){if(this.W){var b=a-this.W;b<1&&(b=16.67);this.ba=1E3/b}this.W=a;a=Date.now();this.T&&(b=a-this.V-this.Y,b>this.Y&&(this.H+=b,this.u(549755813888,"browser throttling detected, compensating by %5.3fms\n",b)));this.V=a;this.H||(this.H=a);this.Z=0;try{this.ca=!1;do uc(this,sc(this,qc(this,tc(this))));while(this.g&&!this.ca)}catch(c){this.u("%s\n",c.message),U(this)}this.T=Date.now();this.Z&&(this.H+=this.Z,this.V+=this.Z);this.V+=pc(this,
this.aa,this.T-this.H,this.T-this.V);this.T-this.tb>=this.oc&&this.update();for(a=0;a<this.ea.length;a++)this.ea[a](this.W,this.ba);this.O=this.yb()}};function fc(a,b){if(b!==void 0){if(b<1||!a.J&&a.R>0&&a.R<a.K*.9)b=a.la;a.I=b;b=a.Ha*a.I;a.K!=b&&(a.K=b,kc(a,lc(a.K)))}a.H=a.T=0;a.j=a.aa=0;pc(a);for(b=a.h.length;b>0;b--){var c=a.h[b-1];c.Ma>=0&&zb(a,b,c.Ma,!0)}}function ec(a){var b=a.S[oc];return b?(fc(a,Math.floor((b.value-b.min)/(b.max-b.min)*(a.wb-a.oa)+a.oa)/a.sa|0),!0):!1}
function zb(a,b,c,d){b>0&&b<=a.h.length&&(b=a.h[b-1],d||b.ha<0)&&(c=Math.ceil(a.sa*(a.Bc?a.la:a.ma)/1E3*(c===void 0?1E3:c)),a.g&&(c+=sc(a)),b.ha=c)}p.start=function(){if(this.g||this.m)return!1;this.g=!0;this.H=this.T=this.W=0;this.update(!0);this.O=this.yb();return!0};function vc(a,b){b=b===void 0?1:b;a.g||(b&&!a.m&&(a.m=b),a.m&&(a.m--,uc(a,sc(a,qc(a,tc(a,1)))),a.update(!1),a.m&&setTimeout(function(){vc(a,0)},0)))}
function U(a){return a.g?(a.g=!1,sc(a),a.O&&(a.nc(a.O),a.O=0),a.update(!0),!0):a.m?(a.m=0,a.update(!0),!0):!1}p.update=function(a){a&&this.u(this.g?"started with %s target\n":"stopped\n",lc(this.K));L(this,hc,this.g?"Halt":"Run");L(this,mc,this.m?"Stop":"Step");this.J||(this.u(262144,"getSpeedCurrent(%5.3fhz)\n",this.R*1E6),kc(this,this.g&&this.R?lc(this.R):"Stopped"));for(var b=0;b<this.ka.length;b++){var c=this.ka[b];c.Kc.call(c,a!=void 0)}this.tb=Date.now();this.ca=!0};
function kc(a,b){L(a,wc,b);L(a,jc,b)}var hc="run",jc="setSpeed",wc="speed",mc="step",oc="throttle";D.Time=dc;
function xc(a,b,c){N.call(this,a,b,c);this.type=this.config.type=="static"?yc:zc;this.H=this.config.addrWidth||16;this.j=Math.pow(2,this.H);this.J=this.j-1|0;this.blockSize=this.config.blockSize||(this.H>16?4096:1024);this.blockSize>this.j&&(this.blockSize=this.j);this.K=this.j/this.blockSize|0;this.h=Math.log2(this.blockSize)|0;this.m=(1<<this.h)-1;this.I=this.config.dataWidth||8;this.g=Array(this.K);this.v=0;a=new V(a,b+"[NONE]",{size:this.blockSize,bus:this.U});for(b=0;b<this.j;b+=this.blockSize)Ac(this,
b,this.blockSize,W.NONE,a);a=this.v;this.v+=this.type;a&&this.v||(this.Ca=this.hc,this.Da=this.Ea)}u(xc,N);
function Ac(a,b,c,d,e){for(var f=b>>>a.h;c>0&&f<a.g.length;){var g=f*a.blockSize,h=a.blockSize-(b-g);h>c&&(h=c);var k=a.g[f];if(b!=g||h!=a.blockSize||k&&k.type!=W.NONE)break;var m=k=void 0,n=a,r=b,l=a.H,t=16;l=l===void 0?0:l;k=k===void 0?0:k;var v="",w="",A=-1;t||(t=n.ge||10);l&&(A=Math.ceil(l/Math.log2(t)));if(m==void 0)switch(t){case 8:m="0o";break;case 16:m="0x";break;case 10:w=".";default:m=""}isNaN(r)||typeof r!="number"?(r=void 0,m=w=""):(r<0&&r>-1&&(r=-1),l&&(r<0&&(r+=Math.pow(2,l)),r>=Math.pow(2,
l)&&(A=Math.ceil(Math.log(r)/Math.log(t)))));for(n=k||-1;A--;){n||(v=","+v,n=k);if(r==void 0){if(v="?"+v,A<0)break}else if(l=r%t,r=Math.trunc(r/t),l+=l>=0&&l<=9?48:55,v=String.fromCharCode(l)+v,!r&&A<0)break;n--}k=a.U+"["+(m+v+w)+"]";b=e?e.size==a.blockSize?e:new V(a.M,k,{type:d,Ja:b,size:h,bus:a.U}):new V(a.M,k,{type:d,Ja:b,size:h,bus:a.U});a.g[f]=b;b=g+a.blockSize;c-=h;f++}}p=xc.prototype;p.me=function(a,b){this.fa&&this.fa.u(4,"bus fault (%d) at %n\n",b,a)};
p.ia=function(){this.fa===void 0&&(this.fa=P(this,"Debugger",!1))};p.qa=function(){};p.Ya=function(a){return a&&this.pa(a)?!0:!1};p.Za=function(a){this.ra(a)};p.pa=function(a){for(var b=0;b<this.g.length;b++){var c=this.g[b];if((this.type==zc||c.type&W.Ia)&&c.pa){var d=a.shift();if(!c.pa(d))return!1}}return!0};p.ra=function(a){for(var b=0;b<this.g.length;b++){var c=this.g[b];if((this.type==zc||c.type&W.Ia)&&c.ra){var d=[];c.ra(d);a.push(d)}}};p.wa=function(a){return this.g[a>>>this.h].wa(a&this.m)};
p.hc=function(a){return this.g[a>>>this.h].Ca(a&this.m)};p.$a=function(a,b){this.g[a>>>this.h].$a(a&this.m,b)};p.Ea=function(a,b){this.g[a>>>this.h].Da(a&this.m,b)};var yc=0,zc=1;D.Bus=xc;
function V(a,b,c){N.call(this,a,b,c);this.Ja=this.config.addr;this.size=this.config.size;this.type=this.config.type||W.NONE;this.j=(a=this.config.bus)?O(this,a):P(this,a="Bus");if(!this.j)throw Error(this.X("unable to find bus '%s'",a));this.v=this.j.I;this.J=Math.pow(2,this.v)-1;this.m=this.I=!1;this.values=this.buffer=null;a=this.nb;b=this.Ea;if(this.j.type==yc){b=this.Oc;if(c=this.v==8)c=O(this,this.M),c=(c&&c.config&&c.config.ArrayBuffer||this.config.ArrayBuffer)!==!1;c&&(this.I=!0)}switch(this.type){case W.NONE:this.Ca=
this.Lc;this.Da=this.Rb;break;case W.Bb:this.Ca=a;this.Da=this.Rb;break;case W.Ia:this.Ca=a,this.Da=b}Bc(this,this.config.values);Cc(this)}u(V,N);function Bc(a,b){typeof b=="string"?(kb(a,!1),Sa(b,function(c,d,e,f){if(e==4)if(!f&&d){try{var g=JSON.parse(d);Bc(a,g.values)}catch(h){a.u("error (%s) parsing resource: %s\n",h.message,c)}kb(a,!0)}else a.u("error (%d) loading resource: %s\n",f,c)})):a.config.values=b}
function Cc(a,b){if(a.type>W.NONE&&(a.I?(a.buffer=new ArrayBuffer(a.size),new DataView(a.buffer,0,a.size),a.values=new Uint8Array(a.buffer,0,a.size),new Uint16Array(a.buffer,0,a.size>>1),new Int32Array(a.buffer,0,a.size>>2)):a.values=Array(a.size).fill(0),b))for(var c=0;c<b.length;c++)a.values[c]=b[c]}p=V.prototype;
p.qa=function(){if(this.config.values)a:{var a=this.j,b=this.Ja,c=this.size,d=this.config.values,e=0,f=b&a.m;b>>>=a.h;c>d.length&&(c=d.length);for(;c>0&&b<a.g.length;){var g=a.g[b++];if(!g)break a;for(;c>0&&f<g.size;)g.Ea(f++,d[e++]),c--;f=0}}else this.type&W.Ia&&this.values&&this.values.fill(0)};p.Lc=function(){return this.J};p.wa=function(a){return this.values?this.values[a]:0};p.nb=function(a){return this.values[a]};p.Rb=function(){};p.$a=function(a,b){this.values&&(this.values[a]=b)};
p.Ea=function(a,b){this.values[a]=b};p.Oc=function(a,b){this.values[a]=b;this.m=!0;this.Da=this.Ea};p.pa=function(a){if(a){var b=a.shift();if(this.U==b){this.m=a.shift();a.shift();if(a=a.shift()){var c=this.size;c=c===void 0?0:c;if(a.length!=c){b=0;c=c?Array(c):[];for(var d=0;d<a.length-1;)for(var e=a[d++],f=a[d++];e--;)c[b++]=f;a=c}Cc(this,a)}return!0}}return!1};
p.ra=function(a){a.push(this.U);a.push(this.m);a.push(!1);if(this.values){var b=this.values;for(var c=0,d=0,e=[];c<b.length;){for(var f=b[c],g=c+1;g<b.length&&b[g]===f;)g++;e[d++]=g-c;e[d++]=f;c=g}b=e.length>=b.length?b:e}else b=this.values;a.push(b)};var W={NONE:1,Bb:2,Ia:4,ce:14,he:12};D.Memory=V;
function Dc(a,b,c){c.type=W.Bb;V.call(this,a,b,c);Ac(this.j,this.config.addr,this.config.size,this.config.type,this);lb(this,this.qa.bind(this));this.da=this.fa=void 0;if(D.LED&&this.S[Ec]){var d=this;this.h=Math.pow(2,Math.ceil(Math.log2(this.values.length)/2));this.H=this.values.length/this.h|0;this.g=new Ib(a,b+"LEDs",{"class":"LED",bindings:{container:Oa(this,Ec)},type:Kb,cols:this.h,rows:this.H,color:H(this,"colorROM","green"),backgroundColor:H(this,"backgroundColorROM","black"),persistent:!0}),
Tb(this.g);this.K=new nb(a,b+"Input",{"class":"Input",location:[0,0,this.g.ca,this.g.Y,this.h,this.H],bindings:{surface:Oa(this,Ec)}});this.N=Pa(this)||"";qb(this.K,function(e,f){if(d.da){var g=d.N;e>=0&&f>=0&&(e=f*d.h+e,g=Fc(d.da,d.Ja+e,d.values[e]));L(d,Qa,g)}})}}u(Dc,V);
Dc.prototype.pa=function(a){var b=!0,c=a.shift();if(c&&this.g){var d=c.length;this.g.buffer.length==d?(this.g.buffer=c,Sb(this.g,!0)):(this.u("inconsistent saved LED state (%d), unable to load\n",d),b=!1)}a.length&&(d=(a=a.shift())&&a.length||-1,this.values.length==d?this.values=a:(this.u("inconsistent saved ROM state (%d), unable to load\n",d),b=!1));return b};Dc.prototype.ia=function(){this.da===void 0&&(this.da=P(this,"CPU"));this.fa===void 0&&(this.fa=P(this,"Debugger",!1))};
Dc.prototype.nb=function(a){this.g&&ac(this.g,a%this.h,a/this.h|0,1,Vb);return this.values[a]};Dc.prototype.ra=function(a){this.g&&(a.push(this.g.buffer),a.push(this.values))};var Ec="array",Qa="cellDesc";D.ROM=Dc;function Gc(a,b,c){c["class"]="CPU";N.call(this,a,b,c);this.fa=void 0;this.h=this.Pa=0;this.time=P(this,"Time");this.time.N.push(this);this.time.ka.push(this);this.Z=this.H=0}u(Gc,N);p=Gc.prototype;p.abort=function(a){this.h=this.Pa;this.u("%s\n",a.message);U(this.time)};p.Mb=function(){};
p.Nc=function(a){this.Z=this.H=a=a===void 0?0:a;try{this.Mb(a)}catch(b){this.abort(b)}return this.Ob()};p.Qb=function(){this.Z-=this.H;this.H=0};p.Ob=function(){return this.Z-this.H};function X(a,b,c){N.call(this,a.M,b);this.da=a;this.name=b;this.l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];if(!c){b=[];c="reg"+this.name;b.push(c);a.na[c]=[this,-1];for(var d=0;d<this.l.length;d++)c=this.X("reg%s-%02d",this.name,d),b.push(c),a.na[c]=[this,d];La(a,b)}}u(X,N);p=X.prototype;
p.add=function(a,b,c,d){for(var e=0,f=c[0],g=c[1];f<=g;f++)this.l[f]=a.l[f]+b.l[f]+e,e=0,this.l[f]>=d&&(this.l[f]-=d,e=1);e&&(this.da.I=!0);Hc(this,c)};p.get=function(){return this.l};p.init=function(a,b){b=b===void 0?[0,15]:b;for(var c=0;c<this.l.length;c++)this.l[c]=0;c=b[0];for(b=b[1];c<=b;c++)this.l[c]=a&15,a>>>=4;return this};p.move=function(a,b,c){for(var d=0,e=b[0],f=b[1];e<=f;e++)this.l[e]=a.l[e]+d,d=0,this.l[e]>=c&&(this.l[e]-=c,d=1);Hc(a,b)};
p.set=function(a){if(a&&a.length==this.l.length)for(var b=0;b<this.l.length;b++)this.l[b]=a[b]};p.store=function(a){for(var b=0,c=this.l.length;b<c;b++)this.l[b]=a.l[b]};p.sub=function(a,b,c,d){for(var e=0,f=c[0],g=c[1];f<=g;f++)this.l[f]=a.l[f]-b.l[f]-e,e=0,this.l[f]<0&&(this.l[f]+=d,e=1);e&&(this.da.I=!0);Hc(this,c)};p.toString=function(a){a=a===void 0?!1:a;var b=this.U+"=";a&&b.length<3&&(b+=" ");for(var c=this.l.length-1;c>=0;c--)b=a?b+Aa[this.l[c]]:b+(Ba[this.l[c]]+(c%4?"":" "));return b};
function Hc(a,b){a.da.v=a.l[b[0]];b[0]<b[1]&&(a.da.v|=a.l[b[0]+1]<<4)}
function Ic(a,b,c){Gc.call(this,a,b,c);this.type=Number.parseInt(H(this,"type","1501").slice(-4),10);this.na={};this.g=Array(4);for(a=0;a<4;a++)this.g[a]=new X(this,String.fromCharCode(65+a));this.V=this.g[0];this.$=this.g[1];this.sa=this.g[2];this.va=this.g[3];this.R=Array(8);for(a=0;a<8;a++)this.R[a]=new X(this,"X"+a);this.W=Array(8);for(a=0;a<8;a++)this.W[a]=new X(this,"Y"+a);this.oa=new X(this,"Supp",!0);this.ba=new X(this,"Temp",!0);this.O=10;this.I=!1;this.aa=this.v=this.K=0;this.m=[-1,-1,-1];
this.input=O(this,this.config.input);this.input.K=this.jc.bind(this);this.j=O(this,this.config.output,!1);this.N=P(this,"Bus");this.J=P(this,"ROM");this.la=this.ma=this.Y=void 0;this.ka=this.ca=-1;this.T={};this.ea=Jc;a=this.Jc.bind(this);b=Ya.fb;this.L.Ga[b]||(this.L.Ga[b]=[]);this.L.Ga[b].push(a)}u(Ic,Gc);function Kc(a,b){a.T[b]&&(a.T[b]=!1,a.u("break on %s\n",Lc[b]),U(a.time))}function Mc(a){a.j&&Tb(a.j);if(a.J){var b=a.J;b.g&&Tb(b.g)}Nc(a,!1)}p=Ic.prototype;
p.Mb=function(a){for(;this.H>0;){if(this.ka==this.h){this.ka=-1;this.u("break\n");U(this.time);break}var b=this.N.Ca(this.h);this.h=(this.Pa=this.h)+1&this.N.J;if(b==void 0||!Oc(this,b)){this.h=this.Pa;this.u("unimplemented opcode\n");U(this.time);break}this.H-=Pc}if(a<=0){var c=this;rc(this.time,function(){var d=c.J;d.g&&Sb(d.g);c.ua(c.toString())})}};p.Qb=function(){this.H=0};p.Ob=function(){return this.Z-this.H};
function Oc(a,b){if(b&4096)return b&2048?!!(b&1024)==a.I&&(a.h=a.h&1024|b&1023):(a.push(a.h),a.h=b&2047),a.I=!1,!0;var c;var d=b&Qc;switch(d){case Rc:case Sc:case Tc:case Uc:case Vc:case Wc:case Xc:case Yc:case Zc:case $c:case ad:case bd:d=cd[d];var e=(b&dd)>>ed;var f=(b&fd)>>gd;var g=(b&hd)>>id;var h=(c=b&jd)?kd:ld;b=b>=Yc?16:a.O;switch(f){case 0:case 1:case 2:case 3:var k=a.g[f];break;case 4:k=a.ba.init(1,d);break;case 5:h=c?md:nd;break;case 6:k=a.ba.init(a.v&15,d);break;case 7:k=a.ba.init(a.v&
255,d)}switch(g){case 0:var m=a.g[e];break;case 1:m=f<4?a.g[f]:void 0;break;case 2:m=f<5?a.oa:f==5?a.g[e]:void 0;break;case 3:if(c)a.g[e].move(k,d,b);else{a=a.V;e=k;b=d[0];for(k=d[1];b<=k;b++)m=a.l[b],a.l[b]=e.l[b],e.l[b]=m;Hc(e,d)}return!0}if(!m)break;switch(h){case ld:m.add(a.g[e],k,d,b);break;case kd:m.sub(a.g[e],k,d,b);break;case nd:b=m;a=a.g[e];e=d[1];for(k=d[0];e>k;e--)b.l[e]=a.l[e-1];b.l[e]=0;Hc(b,d);break;case md:b=m;a=a.g[e];e=d[0];for(k=d[1];e<k;e++)b.l[e]=a.l[e+1];b.l[e]=0;Hc(b,d)}return!0;
case od:e=(b&pd)>>qd;d=(b&rd)>>sd;k=1<<((b&td)>>ud);if(!d)break;d+=12;switch(b&vd){case wd:a.g[e].l[d]|=k;break;case xd:a.g[e].l[d]&=~k;break;case yd:a.g[e].l[d]&k&&(a.I=!0);break;case zd:a.g[e].l[d]^=k}return!0;case Ad:switch(b&Bd){case Cd:a.V.store(a.W[a.K]);break;case Dd:a.K=b>>4&7;break;case Ed:a.h=a.v;break;case Fd:a.I=!1;d=a.m[0];e=0;for(b=a.m.length-1;e<b;)a.m[e]=a.m[++e];a.m[e]=-1;a.h=d;break;case Gd:a.R[a.K].store(a.V);break;case Hd:a.V.store(a.R[a.K]);break;case Id:a.W[a.K].store(a.V);break;
case Jd:Kc(a,"o");if(a.j){d=0;for(e=11;e>=0;d++,e--)b=void 0,a.$.l[e]&8?b=" ":a.$.l[e]&1?b="-":b=Aa[a.V.l[e]],ac(a.j,d,0,b,a.$.l[e]&2?Yb:0)&&Kc(a,"om");Nc(a)}a.H-=Pc*31;a.aa&&(a.v=a.aa,a.I=!0,Kc(a,"i"));break;case Kd:a.O=10;break;case Ld:a.O=16;break;case Md:a.K=a.v&7;break;default:return!1}return!0}return!1}
p.pa=function(a){var b=a.stateCPU||a[0];if(!b||!b.length)return this.u("invalid saved state\n"),!1;var c=b.shift();if((c|0)!==3)return this.u("saved state version mismatch: %3.2f\n",c),!1;try{this.g.forEach(function(d){return d.set(b.shift())}),this.R.forEach(function(d){return d.set(b.shift())}),this.W.forEach(function(d){return d.set(b.shift())}),this.oa.set(b.shift()),this.ba.set(b.shift()),this.O=b.shift(),this.I=b.shift(),this.K=b.shift(),this.v=b.shift(),this.h=b.shift(),this.m=b.shift(),this.aa=
b.shift()}catch(d){return this.u("CPU state error: %s\n",d.message),!1}return(a=a.stateROM||a[1])&&this.J&&!this.J.pa(a)?!1:!0};
p.Jc=function(a){var b="";var c=0;var d=[],e=a[1];var f=Number.parseInt(a[2],16);isNaN(f)&&(f=-1);for(var g=Number.parseInt(a[3],10)||8,h=3;h<a.length;h++)d.push(Number.parseInt(a[h],16));this.ea=Jc;switch(e[0]){case "b":f=e.substr(1);if(f=="l"){for(f in Lc)c=Lc[f],b+="break on "+c+" (b"+f+"): "+(this.T[f]||!1)+"\n";break}(c=Lc[f])?(this.T[f]=!this.T[f],b="break on "+c+" (b"+f+"): "+this.T[f]):f&&(b="unrecognized break option '"+f+"'");break;case "e":for(g=0;g<d.length;g++){a=this.N.wa(f);if(a==void 0)break;
this.N.$a(f,d[g]);b+=this.X("%#06x: %#06x changed to %#06x\n",f,a,d[g]);c++;f++}b+=this.X("%d locations updated\n",c);break;case "g":this.time.start()?this.ka=f:b="already started\n";break;case "h":U(this.time)||(b="already stopped\n");break;case "t":e[1]=="c"&&(this.ea=Nd);g=Number.parseInt(a[2],10)||1;nc(this.time,g);break;case "r":e[1]=="c"&&(this.ea=Nd);this.Pb(e.substr(1),f);b+=this.toString(e[1]);break;case "u":for(f=f>=0?f:this.ca>=0?this.ca:this.h;g--;){c=this.J&&this.N.wa(f);if(c==void 0)break;
b+=Fc(this,f++,c)}this.ca=f;break;case "?":b="additional commands:\n";Od.forEach(function(k){b+=k+"\n"});break;default:a[0]&&(b="unrecognized command '"+a[0]+"' (try '?')\n")}return b};p.jc=function(a,b){var c=0;a>=0&&b>=0&&(c=b|a+1<<4);this.aa=c};p.Ya=function(a){return a&&this.pa(a)?!0:!1};p.ia=function(a){a?this.time.start():(U(this.time),Mc(this))};p.qa=function(){this.u("reset\n");this.h=0;Mc(this);this.time.g||this.ua(this.toString())};p.Za=function(a){this.ra(a)};
p.Kc=function(a){for(var b in this.S){var c=this.na[b];if(c){var d=c[0];c=c[1];L(this,b,c<0?d.toString():Aa[d.l[c]])}}a&&!this.time.g&&(a=this.J,a.g&&Sb(a.g),this.ua(this.toString()))};p.push=function(a){for(var b=this.m.length-1;b>0;)this.m[b]=this.m[--b];this.m[0]=a};
p.ra=function(a){var b=[],c=[];b.push(3);this.g.forEach(function(d){return b.push(d.get())});this.R.forEach(function(d){return b.push(d.get())});this.W.forEach(function(d){return b.push(d.get())});b.push(this.oa.get());b.push(this.ba.get());b.push(this.O);b.push(this.I);b.push(this.K);b.push(this.v);b.push(this.h);b.push(this.m);b.push(this.aa);this.J&&this.J.ra(c);a.push(b);a.push(c)};p.Pb=function(a,b){if(a&&b>=0)switch(a){case "pc":this.h=b;break;default:this.u("unrecognized register: %s\n",a)}};
function Fc(a,b,c,d){d=d===void 0?!1:d;var e="???",f="";if(c&4096)c&2048?(e="BR",e=c&1024?e+"C":e+"NC",f=b&1024|c&1023):(e="CALL",f=c&2047),f=a.X("%#06x",f);else if(c>=0){var g=c&Qc;var h;switch(g){case Rc:case Sc:case Tc:case Uc:case Vc:case Wc:case Xc:case Yc:case Zc:case $c:case ad:case bd:f="";e=cd[g];for(g=0;g<16;g++)g%4||(f=" "+f),f=(e?g>=e[0]&&g<=e[1]?"F":"0":"?")+f;g=(c&dd)>>ed;var k=(c&fd)>>gd;var m=(c&hd)>>id;var n=c&jd;e="LOAD";var r=h="?";var l=n?k==5?">>":"-":k==5?"<<":"+";switch(m){case 0:h=
Y[g];break;case 1:k<4&&(h=Y[k]);break;case 2:k<5?h="NUL":k==5&&(h=Y[g]);break;case 3:n?(e="MOVE",h=Y[g],r=Y[k]):(e="XCHG",g||(h="A"),k<4&&(r=Y[k])),k=-1}switch(k){case 0:case 1:case 2:case 3:r=Y[g]+l+Y[k];break;case 4:case 5:r=Y[g]+l+"1";break;case 6:r=Y[g]+l+"R5L";break;case 7:r=Y[g]+l+"R5"}f=h+","+r+","+f;break;case od:switch(c&vd){case wd:e="SET";break;case xd:e="CLR";break;case yd:e="TST";break;case zd:e="NOT"}f=a.g[(c&pd)>>qd].name;g=(c&rd)>>sd;f+="["+(g?g+12:"?")+":"+((c&td)>>ud)+"]";break;
case Ad:switch(c&Bd){case Cd:e="STORE";f="A,Y[RAB]";break;case Dd:e="STORE";f="RAB,"+((c&112)>>4);break;case Ed:e="BR";f="R5";break;case Fd:e="RET";break;case Gd:e="STORE";f="X[RAB],A";break;case Hd:e="STORE";f="A,X[RAB]";break;case Id:e="STORE";f="Y[RAB],A";break;case Jd:e="DISP";break;case Kd:e="BCDS";break;case Ld:e="BCDR";break;case Md:e="STORE",f="RAB,R5L"}}}return a.X(d?"%03X %04X\n":"%#06x: %#06x  %-8s%s\n",b,c,e,f)}
p.toString=function(a,b){var c=this;a=a===void 0?"":a;b=b===void 0?null:b;var d="";if(this.ea){this.J&&(d+=Fc(this,this.h,this.N.wa(this.h),!0));d+="  ";b=0;for(a=this.g.length;b<a;b++)d+=this.g[b].toString()+" ";d+="\n ";d+=" COND="+(this.I?1:0);d+=" BASE="+this.O;d+=" R5="+this.X("%02X",this.v);d+=" RAB="+this.K+" ST=";this.m.forEach(function(f){d+=c.X("%03X ",f<0?0:f&4095)});return d.trim()}if(b){a=0;for(var e=b.length>>1;a<e;a++)d+=b[a].toString(!0)+"  "+b[a+e].toString(!0)+"\n";return d}d+=this.toString(a,
this.g);a.indexOf("a")>=0&&(d+=this.toString(a,this.R),d+=this.toString(a,this.W));d+="COND="+(this.I?1:0);d+=" BASE="+this.O;d+=" R5="+this.X("%#04x",this.v);d+=" RAB="+this.K+" ";this.m.forEach(function(f,g){d+=c.X("ST%d=%#06x ",g,f&65535)});this.J&&(d+="\n"+Fc(this,this.h,this.N.wa(this.h)));this.ca=this.h;return d};
function Nc(a,b){b=b===void 0?!0:b;var c,d=b&&(a.type==Pd?!!(a.sa.l[14]&8):!!(a.$.l[15]&4));if(a.la!==d){if(c=a.S["2nd"])c.style.opacity=d?"1":"0",a.la===void 0&&a.j&&(c.style.color=a.j.color);a.la=d}d=b&&(a.type==Pd?!!(a.$.l[15]&4):!!(a.va.l[15]&8));if(a.ma!==d){if(c=a.S.INV)c.style.opacity=d?"1":"0",a.ma===void 0&&a.j&&(c.style.color=a.j.color);a.ma=d}c=a.type==Pd?a.R[4].l[15]>>2:a.sa.l[15]&3;b=b?c?c==1?Qd:Rd:Sd:Td;if(a.Y!==b){if(c=a.S.Deg)c.style.opacity=b==Sd?"1":"0",a.Y===void 0&&a.j&&(c.style.color=
a.j.color);if(c=a.S.Rad)c.style.opacity=b==Qd?"1":"0",a.Y===void 0&&a.j&&(c.style.color=a.j.color);if(c=a.S.Grad)c.style.opacity=b==Rd?"1":"0",a.Y===void 0&&a.j&&(c.style.color=a.j.color);a.Y=b}}
var Qc=3840,Rc=0,Sc=256,Tc=512,Uc=768,Vc=1024,Wc=1280,Xc=1792,Yc=2048,Zc=2304,$c=2560,od=3072,ad=3328,Ad=3584,bd=3840,dd=192,ed=6,fd=56,gd=3,hd=6,id=1,jd=1,vd=3,wd=0,xd=1,yd=2,zd=3,pd=192,qd=6,rd=48,sd=4,td=12,ud=2,Bd=15,Cd=0,Dd=1,Ed=2,Fd=3,Gd=4,Hd=5,Id=6,Jd=7,Kd=8,Ld=9,Md=10,Z={},cd=(Z[Rc]=[12,12],Z[Sc]=[0,15],Z[Tc]=[2,12],Z[Uc]=[0,12],Z[Vc]=[2,2],Z[Wc]=[0,1],Z[Xc]=[0,13],Z[Yc]=[14,14],Z[Zc]=[13,15],Z[$c]=[14,15],Z[ad]=[13,13],Z[bd]=[15,15],Z),Pc=128,ld=0,kd=1,nd=2,md=3,Pd=1501,Td=0,Sd=1,Qd=2,Rd=
3,Lc={i:"input",o:"output",om:"output modification"},Jc=0,Nd=1,Y="A B C D 1 ? R5L R5".split(" "),Od="b[c]\t\tbreak on condition c;bl\t\tlist break conditions;e [addr] ...\tedit ROM locations;g [addr]\trun (to addr);h\t\thalt;r[a]\t\tdump (all) registers;t [n]\t\tstep (n instructions);u [addr] [n]\tunassemble (at addr)".split(";");D.CPU1500=Ic;
function Ud(a,b,c){N.call(this,a,a);var d=this;this.j=!1;this.I=c;this.h="";this.H=this.v=!1;kb(this,!1);this.ga=0;b=b.trim();b[0]=="{"?Vd(this,b):(this.h=b,Sa(this.h,function(e,f,g,h){g==4&&(!h&&f?(Vd(d,f),Wd(d)):d.u("error (%d) loading configuration: %s\n",h,e))}));window.addEventListener("load",function(){d.H=!0;Wd(d)});window.addEventListener(Ua("iOS")?"pagehide":Ua("Opera")?"unload":"beforeunload",function(){Xd(d)});window.addEventListener("pageshow",function(){d.j||d.ia(!0)})}u(Ud,N);
Ud.prototype.ya=function(a,b){var c=this;switch(a){case Yd:b.onclick=function(){c.ia()};break;case Zd:b.onclick=function(){c.qa()}}N.prototype.ya.call(this,a,b)};
function Wd(a){var b=!0;if(a.v&&a.H){for(var c in a.g){var d=void 0,e=a.g[c];try{d=e["class"],D[d]?d=="Machine"?(a.u("PCjs %s v%3.2f\n%s\n",e.name,3,"Copyright \u00a9 2012-2026 Jeff Parsons <Jeff@pcjs.org>"),a.h&&a.u("Configuration: %s\n",a.h)):new D[d](a.M,c,e):a.u('unrecognized %s device "%s"\n',d,c)}catch(g){e.optional||(a.u('error initializing %s device "%s": %s\n',d,c,g.message),b=!1),mb(a,c)}}if(a.m){var f=Va(a);jb(a,function(g){return g.Ya&&!g.Ya(f)?(g.u('unable to restore state for device "%s"\n',
g.U),!1):!0})}kb(a,!0);lb(a,a.ia.bind(a,b))||a.u("machine %s not ready to power, waiting for device(s)\n",a.M)}}
function Vd(a,b){try{a.g=JSON.parse(b);var c=a.g[a.M];if(!c){c=a.g[Fa(a.h)];if(!c)throw Error("configuration missing machine ID");a.g[a.M]=c}ib(a,c,["autoSave","autoStart"]);a.m=a.config.autoSave!==!1;a.J=a.config.autoStart!==!1;if(a.I){var d=eval("("+a.I+")"),e;for(e in d)a.config[e]=d[e]}a.v=!0}catch(f){c=f.message,(d=c.match(/position ([0-9]+)/))&&(c+=" ('"+b.substr(+d[1],40).replace(/\s+/g," ")+"...')"),a.u("machine '%s' initialization error: %s\n",a.M,c)}}
Ud.prototype.ia=function(a){a=a===void 0?!this.j:a;if(Q(this)){var b=this;a&&this.u("power on\n");jb(this,function(c){c.ia&&c!=b&&(c.config["class"]!="CPU"||b.J&&Q(b)?c.ia(a):c.time.update(!0));return!0});(this.j=a)||this.u("power off\n")}};Ud.prototype.qa=function(){if(Q(this)){var a=this;jb(this,function(b){b.qa&&b!=a&&b.qa();return!0});this.u("reset\n")}};function Xd(a){if(a.m){var b=[];jb(a,function(c){c.Za&&c.Za(b);return!0});bb(a,b)}a.ia(!1)}var Yd="power",Zd="reset";
window.TMS1500=function(a,b,c){var d=new Ud(a,b,c);window.command=function(e){return Wa(d,e)};return d};D.Machine=Ud;})()

//# sourceMappingURL=ti57.js.map
